"use strict";(self.webpackChunkmy_doc=self.webpackChunkmy_doc||[]).push([["4520"],{38621:function(e,s,n){n.r(s),n.d(s,{default:function(){return l}});var r=n(85893),a=n(50065);function c(e){let s=Object.assign({h1:"h1",a:"a",p:"p",code:"code",pre:"pre"},(0,a.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.h1,{id:"节点notready",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#节点notready",children:"#"}),"节点notReady"]}),"\n",(0,r.jsxs)(s.p,{children:["今天查看节点状态，发现",(0,r.jsx)(s.code,{children:"master"}),"节点状态为",(0,r.jsx)(s.code,{children:"NotReady"}),"。排查步骤如下："]}),"\n",(0,r.jsxs)(s.h1,{id:"1查看master-kubelet状态",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#1查看master-kubelet状态",children:"#"}),"1.查看master kubelet状态"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",meta:"",children:"systemctl status kubelet\n"})}),"\n",(0,r.jsx)(s.p,{children:"如果状态正常，继续按照如下步骤排查。"}),"\n",(0,r.jsxs)(s.p,{children:["我这里在该步骤就不正常了，提示",(0,r.jsx)(s.code,{children:"找不到节点“master”"}),"。我本来设置的",(0,r.jsx)(s.code,{children:"master"}),"节点的",(0,r.jsx)(s.code,{children:"hostname"}),"为",(0,r.jsx)(s.code,{children:"bdmaster"}),"，因此我又查看了下该服务器的",(0,r.jsx)(s.code,{children:"hostname"}),"，发现该服务器的hostname变成了",(0,r.jsx)(s.code,{children:"master"}),"。修改",(0,r.jsx)(s.code,{children:"hostname"}),"后重启服务器，发现master节点正常了。"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",meta:"",children:"# 查看hostname\r\nhostname\r\n\r\n# 修改hostname\r\nhostnamectl set-hostname bdmaster\n"})}),"\n",(0,r.jsxs)(s.h1,{id:"2查看master-kube-proxy状态",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#2查看master-kube-proxy状态",children:"#"}),"2.查看master kube-proxy状态"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",meta:"",children:"systemctl status kube-proxy  \n"})}),"\n",(0,r.jsxs)(s.h1,{id:"3查看master-kube-apiserver状态",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#3查看master-kube-apiserver状态",children:"#"}),"3.查看master kube-apiserver状态"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",meta:"",children:"systemctl status kube-apiserver\n"})}),"\n",(0,r.jsxs)(s.h1,{id:"4查看master-kube-scheduler状态",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#4查看master-kube-scheduler状态",children:"#"}),"4.查看master kube-scheduler状态"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",meta:"",children:"systemctl status kube-scheduler \n"})}),"\n",(0,r.jsxs)(s.h1,{id:"5查看master-etcd状态",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#5查看master-etcd状态",children:"#"}),"5.查看master etcd状态"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",meta:"",children:"systemctl status etcd \n"})}),"\n",(0,r.jsxs)(s.h1,{id:"6查看flannel状态",children:[(0,r.jsx)(s.a,{className:"header-anchor","aria-hidden":"true",href:"#6查看flannel状态",children:"#"}),"6.查看flannel状态"]}),"\n",(0,r.jsx)(s.p,{children:"在kubernetes-dashboard上看到flannel挂掉了，查看日志如下"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.code,{children:'Failed create pod sandbox: rpc error: code = Unknown desc = failed to start sandbox container for pod "kube-flannel-ds-amd64-sc7sr": Error response from daemon: OCI runtime create failed: container_linux.go:348: starting container process caused "process_linux.go:301: running exec setns process for init caused \\"signal: broken pipe\\"": unknown'})}),"\n",(0,r.jsx)(s.p,{children:"而这个问题，通过分析应该是flannel在网络比较大的情况下，内存资源不足了，所以修改flannel的配置，将内存扩大即可。"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",meta:"",children:'"resources": {\r\n    "limits": {\r\n        "cpu": "300m",\r\n        "memory": "200Mi"\r\n    },\r\n	"requests": {\r\n        "cpu": "300m",\r\n        "memory": "200Mi"\r\n	}\r\n},\n'})}),"\n",(0,r.jsx)(s.p,{children:"修改完成之后，需要重启docker，在删除原来的flannel pod，这样问题就解决拉。"})]})}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,a.ah)(),e.components);return s?(0,r.jsx)(s,Object.assign({},e,{children:(0,r.jsx)(c,e)})):c(e)}let l=d;d.__RSPRESS_PAGE_META={},d.__RSPRESS_PAGE_META["tang%2Fk8s%2F%E9%94%99%E8%AF%AF%E9%9B%86%E9%94%A6%2F4.md"]={toc:[],title:"节点notReady",headingTitle:"节点notReady",frontmatter:{}}}}]);