"use strict";(self.webpackChunkmy_doc=self.webpackChunkmy_doc||[]).push([["5004"],{64822:function(r,e,n){n.r(e),n.d(e,{default:()=>o});var t=n("85893"),a=n("50065");let s=n.p+"static/image/spring_data_home.d4e93430.png",i=n.p+"static/image/spring_data_version.7732e603.png",d=n.p+"static/image/create_project_application.2f495e27.png";function c(r){let e=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",img:"img",h3:"h3",pre:"pre",code:"code",blockquote:"blockquote",strong:"strong",ul:"ul",li:"li",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td"},(0,a.ah)(),r.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(e.h1,{id:"8-spring-data-elasticsearch",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#8-spring-data-elasticsearch",children:"#"}),"8 Spring Data Elasticsearch"]}),"\n",(0,t.jsxs)(e.h2,{id:"81-spring-data-框架介绍",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#81-spring-data-框架介绍",children:"#"}),"8.1 Spring Data 框架介绍"]}),"\n",(0,t.jsx)(e.p,{children:"Spring Data是一个用于简化数据库、非关系型数据库、索引库访问，并支持云服务的开源框架。其主要目标是使得对数据的访问变得更加便捷。\r\nSpring Data可以极大简化JPA（Elasticsearch）的写法，可以在几乎不用写实现的情况下，实现对数据库的访问和操作。\r\n除了CRUD(Create 新增、Retrieve 检索、Update 更新、 Delete 删除)外，还包括分页、排序等一些常用功能。"}),"\n",(0,t.jsxs)(e.p,{children:["Spring Data官网：",(0,t.jsx)(e.a,{href:"https://spring.io/projects/spring-data",rel:"noopener noreferrer",target:"_blank",children:"https://spring.io/projects/spring-data"})]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:s})}),"\n",(0,t.jsxs)(e.h2,{id:"82-spring-data-elasticsearch-介绍",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#82-spring-data-elasticsearch-介绍",children:"#"}),"8.2 Spring Data Elasticsearch 介绍"]}),"\n",(0,t.jsx)(e.p,{children:"Spring Data Elasticsearch基于Spring Data API简化Elasticsearch操作，将原始操作Elasticsearch的客户端API进行封装。\r\nSpring Data Elasticsearch的关键功能领域是一个以POJO为中心的模型，用于和Elasticsearch文档进行交互，并轻松编写Repository风格的数据库访问。"}),"\n",(0,t.jsxs)(e.h2,{id:"83-spring-data-elasticsearch-版本",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#83-spring-data-elasticsearch-版本",children:"#"}),"8.3 Spring Data Elasticsearch 版本"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:i})}),"\n",(0,t.jsx)(e.p,{children:"因本教程使用的Elasticsearch版本号是7.8，但是上图中没有刚好对应的版本号，基于向下兼容的想法，\r\n考虑使用7.6.2版本的Elasticsearch对应的Spring Data Elasticsearch、Spring Framework、 Spring Boot"}),"\n",(0,t.jsxs)(e.h2,{id:"84-spring-data-elasticsearch-使用",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#84-spring-data-elasticsearch-使用",children:"#"}),"8.4 Spring Data Elasticsearch 使用"]}),"\n",(0,t.jsxs)(e.h3,{id:"841-创建maven项目",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#841-创建maven项目",children:"#"}),"8.4.1 创建maven项目"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAR0AAAA+CAIAAACZR1gAAAAACXBIWXMAABYlAAAWJQFJUiTwAAAGP0lEQVR42u2d327bNhTG/Vq529P4HTasA7YBw7ALAwO6Yje72OU2YAkQRKiBXKwFknZYE6cJNjfe4KZwEsx2libOH6eOnY42JYqHPJRkWXJt5/tgBCJNkRTJH88hFcmF9xAEZa0CmgCCwBUEgSsIAlcQBM0NV7+Wf1Ofx0+evW4cp8+rVloqCBW99Fl4xUlzmKzyS6VaXgVkdmmjjPKuaI75zxlXm5uby5xEfEKu5OdV/c00uRqdpHoRXGUw7mmTgqvJuOp0OisrKwZUIkbEj8WV65MTV7PSi7lzNT17MmGTgitTOzs7BlciJrkfOCZXcgIuhJ1AuPID+vf0pGE6LSTPMyZ1mpqLYKrBFi3jit4oNZeX4iqIdo4sow7BiV5QKmmNoMQ1cmnB0LXLUnX3T7SuicQzV2o1qaMj+DnRKtfVy2HlR9FMo+kV+RAOSIZc3dzcrK6uKqjEsYjJhyvSfbQHrVGrIvUujueK5qCGPsmRq0ZE0UtLsoZrrsz9BO7RYNeBxoSjiy9R58ouy7ycYKAmjA9b0BXhGOJJy9XmEa3y5EJcFZ4htNLsW9RqNcWVOB5r32IMrvRBotx5hx8Yzn+ch8HNjhodemb26Ww12Mz9ugXf25mTBPJrbna360CvOjzTKJGZMnSbo836xPBExjvq5XLknA5edLkRvRzMKXogZJk29ux4lmm46vf75XJZQCX+iuOcuGLm6NCe2H4gN42RRmcGX+BGOaZVHZZCtAXRkgbZMZnT9ZV7jWFdAj0xDJllcH4gLctY4jni9RDbyEbl+TTupaV5BXwvEwjJnGImmb2la8p99sPDQ8GV+DvuPnvyXQq+pTSudONhjlE1MkOz5OSKcR+009lq8EVzXDH2Kp4r6xK42YSbGJJy5bR8fDzTyPpxVEcks7h8L0dyZbgDH26TN+v7V3t7eynuXxlcfeQdGB+3R246AtZUR1a3/GIodn0Vt5qIKpof5a5pOM5lcq/6zNYYhyualVy1uOwya0+srYtg6om2V84lYtRKNZKrxVtfjau0XBmdYXKl7xCVihxXtp9iT3R6EQZXvJvjLtr2/IzMU3BF/cBSkd+BHIMrUnfPrpAVz10p36RWGsd1meW6ejmGq8XaD5wqV1Cuqwd/WM7WiLyn96+yFbiaOlem+7TId2fB1T3mir0/NiWucjNVCS4KXIErCJonriAIXEEQBK4gCFxBELiCIAhcQRC4ep/tWzEgaPG42tjYiH5QP5arSd+KAUGLx5V8B0alUol9sjiaq/RvxYCgheRKPbS/v78/GAzAFQSuMuNKqlwuNxqN/LjSHjsIHwSkryqx3wMDQXPOldTu7m4uXEmIGNDIC5iAEwR7leItTjo4FDXxPaiCsL5Ktb4y33wCrqAF5Gp6+4G1UskzzJThGg4NmnqQuwTEoDnlKqv7VwntFX1LDLfkCnc28Ag6NLdcpRP22SFwBUEQuIIgcAVB4AqCwBUEQeAKgsAVBIErCILAFQSBq3sor4h/lQJXs6Yf/z77+EXzkxfN+kXvh9rbT7ea3+ye1DvvxFfbJ91H1dMvKu2Hf512egNwBYGrpPrqZVtwJXB6sNUSB/Ij0Prl9bkKis/60SW4gsBVIp33+hIbYa9+qp8vH3QUSF+/bJePLr/98z8Z9BoX4AoCV4lUPXsnsfm9fS1jvtwZmq/PtlvX/aHjt9G8kgm2TrraedrbLMxHQdifzRw95+j5T47QH/W0f6tb+zVOP2n0ueAKXM2Y1o8vJTbNbl8Er24HMvhd9VQmWHnjW7Dj61tz/JNfoA1/bzdEhcaTn9LVXzZjWZ9hwvCJ49hzwRW4mslNC2Gd7kbB+kVPUiRwkgkeVU9Hq6/W7d2dZa+soPn4vUqmf+E6NixebHp1DK7A1UxuWijrtBl4fX+0h16fIEkgJ4JilUXPS86VGvrgCrofXKlNi+XAOi0HXt/R1dDra3ZvZfDn+rnNlRrMWsDyA0NfLpKNYRYkqRUBrqA54ap6diOxed7yNy2+fzX0+h5stfojp2/7pCsTPP33irFXRW7bImLfIgFXGpeKVnAFzRVX60f+psXBZU96fZ9XWrpbuNa4kAn+Gd0mdvuBEASuMhC4gsAVuILAFQRB4AqCwBUEgSsIglz6H8u+BlPoC1aXAAAAAElFTkSuQmCC"})}),"\n",(0,t.jsxs)(e.h3,{id:"842-引入依赖",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#842-引入依赖",children:"#"}),"8.4.2 引入依赖"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-xml",meta:"",children:'<?xml version="1.0" encoding="UTF-8"?>\r\n<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\r\n	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">\r\n	<modelVersion>4.0.0</modelVersion>\r\n	<parent>\r\n		<groupId>org.springframework.boot</groupId>\r\n		<artifactId>spring-boot-starter-parent</artifactId>\r\n		<version>2.4.4</version>\r\n		<relativePath/> \x3c!-- lookup parent from repository --\x3e\r\n	</parent>\r\n	<groupId>com.tth.learn</groupId>\r\n	<artifactId>elasticsearch_demo</artifactId>\r\n	<version>0.0.1-SNAPSHOT</version>\r\n	<name>elasticsearch_demo</name>\r\n	<description>Elasticsearch Demo project for Spring Boot</description>\r\n	<properties>\r\n		<java.version>8</java.version>\r\n		<fastjson.version>1.2.83</fastjson.version>\r\n	</properties>\r\n	<dependencies>\r\n\r\n		\x3c!--elasticsearch依赖--\x3e\r\n		<dependency>\r\n			<groupId>org.springframework.boot</groupId>\r\n			<artifactId>spring-boot-starter-data-elasticsearch</artifactId>\r\n		</dependency>\r\n\r\n		\x3c!--测试依赖--\x3e\r\n		<dependency>\r\n			<groupId>org.springframework.boot</groupId>\r\n			<artifactId>spring-boot-starter-test</artifactId>\r\n			<scope>test</scope>\r\n		</dependency>\r\n\r\n		\x3c!--配置注解执行器：当执行类中已经定义了对象和该对象的字段后，在配置文件中对该类赋值时，便会非常方便的弹出提示信息--\x3e\r\n		<dependency>\r\n			<groupId>org.springframework.boot</groupId>\r\n			<artifactId>spring-boot-configuration-processor</artifactId>\r\n		</dependency>\r\n\r\n		<dependency>\r\n			<groupId>com.alibaba</groupId>\r\n			<artifactId>fastjson</artifactId>\r\n			<version>${fastjson.version}</version>\r\n		</dependency>\r\n\r\n		<dependency>\r\n			<groupId>org.projectlombok</groupId>\r\n			<artifactId>lombok</artifactId>\r\n		</dependency>\r\n	</dependencies>\r\n\r\n	<build>\r\n		<plugins>\r\n			<plugin>\r\n				<groupId>org.springframework.boot</groupId>\r\n				<artifactId>spring-boot-maven-plugin</artifactId>\r\n			</plugin>\r\n		</plugins>\r\n	</build>\r\n\r\n</project>\n'})}),"\n",(0,t.jsxs)(e.h3,{id:"843-创建配置文件",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#843-创建配置文件",children:"#"}),"8.4.3 创建配置文件"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-properties",meta:"",children:"elasticsearch.host=localhost\r\nelasticsearch.port=9200\r\nelasticsearch.scheme=http\r\n# 配置日志级别\r\nlogging.level.com.tth.learn=debug\n"})}),"\n",(0,t.jsxs)(e.h3,{id:"844-创建启动类和主目录",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#844-创建启动类和主目录",children:"#"}),"8.4.4 创建启动类和主目录"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.img,{src:d})}),"\n",(0,t.jsxs)(e.h3,{id:"845-创建配置类",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#845-创建配置类",children:"#"}),"8.4.5 创建配置类"]}),"\n",(0,t.jsx)(e.p,{children:"ElasticsearchRestTemplate是Spring Data Elasticsearch中的一个类，和其他spring项目中的Template类似。\r\nElasticsearchRestTemplate是基于RestHighLevelClient客户端的，需要继承AbstractElasticsearchConfiguration，并实现elasticsearchClient()抽象方法，创建RestHighLevelClient客户端。"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",meta:"",children:'/**\r\n * Elasticsearch配置类\r\n * @Author tth\r\n * @Date 2023/5/11 11:50\r\n */\r\n@ConfigurationProperties(prefix = "elasticsearch")\r\n@Configuration\r\n@Data\r\npublic class ElasticsearchConfig extends AbstractElasticsearchConfiguration {\r\n\r\n    private String host;\r\n    private Integer port;\r\n\r\n    @Override\r\n    public RestHighLevelClient elasticsearchClient() {\r\n        RestClientBuilder builder = RestClient.builder(new HttpHost(host, port));\r\n        RestHighLevelClient client = new RestHighLevelClient(builder);\r\n        return client;\r\n    }\r\n}\n'})}),"\n",(0,t.jsxs)(e.h3,{id:"846-添加document映射实体",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#846-添加document映射实体",children:"#"}),"8.4.6 添加document映射实体"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",meta:"",children:'/**\r\n * 产品映射\r\n * @Author tth\r\n * @Date 2023/5/11 13:40\r\n */\r\n@Data\r\n@Document(indexName = "product", shards = 1, replicas = 1)\r\npublic class Product {\r\n    @Id\r\n    private Long id;\r\n\r\n    @Field(type = FieldType.Text, analyzer = "ik_max_word")\r\n    private String productName;\r\n\r\n    @Field(type = FieldType.Integer)\r\n    private Integer store;\r\n\r\n    @Field(type = FieldType.Double, index = true, store = false)\r\n    private double price;\r\n}\n'})}),"\n",(0,t.jsxs)(e.h3,{id:"847-创建dao层数据访问",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#847-创建dao层数据访问",children:"#"}),"8.4.7 创建Dao层数据访问"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",meta:"",children:"/**\r\n * Procuct dao层接口\r\n * @author tth\r\n * @description \r\n * @date 2023/5/11 13:45\r\n */\r\n@Repository\r\npublic interface ProductDao extends ElasticsearchRepository<Product, Long> {\r\n}\n"})}),"\n",(0,t.jsxs)(e.h3,{id:"848-创建测试类进行测试",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#848-创建测试类进行测试",children:"#"}),"8.4.8 创建测试类，进行测试"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",meta:"",children:'/**\r\n * @RunWith(SpringRunner.class): 让测试运行于Spring测试环境\r\n * @SpringBootTest(classes = ElasticsearchSpringdataApplication.class)：使用class属性指定启动类，使JUnit单元测试运行在Springboot环境中\r\n */\r\n@RunWith(SpringRunner.class)\r\n@SpringBootTest(classes = ElasticsearchSpringdataApplication.class)\r\npublic class ElasticsearchTest {\r\n    @Autowired\r\n    private ProductDao productDao;\r\n\r\n\r\n    /**\r\n     * 添加数据\r\n     */\r\n    @Test\r\n    public void saveProductTest() {\r\n        Product product = new Product();\r\n        product.setId(1L);\r\n        product.setProductName("华为手机");\r\n        product.setStore(100);\r\n        product.setPrice(5000.00);\r\n        productDao.save(product);\r\n        System.out.println("添加成功");\r\n    }\r\n\r\n    /**\r\n     * 根据id查询\r\n     */\r\n    @Test\r\n    public void findById() {\r\n        Optional<Product> optional = productDao.findById(1L);\r\n        Product product = optional.get();\r\n        System.out.println(product);\r\n    }\r\n\r\n    /**\r\n     * 查询全部，并按照价格倒序排序\r\n     */\r\n    @Test\r\n    public void findAll() {\r\n        Iterable<Product> products = productDao.findAll(Sort.by(Sort.Direction.DESC, "price"));\r\n        products.forEach(p -> System.out.println(p));\r\n    }\r\n}\n'})}),"\n",(0,t.jsxs)(e.h3,{id:"849-使用spring-data查询方法命名规范自定义查询方法",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#849-使用spring-data查询方法命名规范自定义查询方法",children:"#"}),"8.4.9 使用Spring Data查询方法命名规范自定义查询方法"]}),"\n",(0,t.jsx)(e.p,{children:"Spring Data强大的功能之一就是从存储库方法名称派生动态查询。\r\nSpring Data致力于减少数据访问层（DAO）的开发量。开发者唯一要做的，就只是声明持久层的接口，其他都交给Spring Data JPA 来完成！\r\n如果想要实现简单查询条件（即查询某一个实体类或是集合），只要在Dao层接口中按照Spring Data JPA规范对方法进行命名，就可以不用写实现方法，Spring Data会将结果直接返回。"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Spring Data Repository 查询方法命名规范"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"只能用于实现简单查询条件，即查询某一个实体类或是集合。"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"查询方法以 find | read | get 开头"}),"\n",(0,t.jsx)(e.li,{children:"涉及条件查询时，条件的属性用条件关键字连接"}),"\n",(0,t.jsx)(e.li,{children:"条件的属性首字母大写"}),"\n",(0,t.jsx)(e.li,{children:"支持属性的级联查询。若当前类有符合条件的属性，则优先使用，而不使用级联属性。若需要使用级联属性，则属性之间使用_连接"}),"\n"]}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"Spring Data 查询命名规则"}),"\n"]}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"关键字"}),(0,t.jsx)(e.th,{children:"例子"}),(0,t.jsx)(e.th,{children:"JPA查询语句（JPQL）"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"And"}),(0,t.jsx)(e.td,{children:"findByLastnameAndFirstName(String lastname, String firstname)"}),(0,t.jsx)(e.td,{children:"where x.lastname = ?0 and x.firstname= ?1"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Or"}),(0,t.jsx)(e.td,{children:"findByLastnameOrFirstName(String lastname, String firstname)"}),(0,t.jsx)(e.td,{children:"where x.lastname = ?0 or x.firstname= ?1"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Between"}),(0,t.jsx)(e.td,{children:"findByPriceBetween(double lowerPrice, double higherPrice)"}),(0,t.jsx)(e.td,{children:"where x.price between ?0 and ?1"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"LessThan"}),(0,t.jsx)(e.td,{children:"findByPriceLessThan(double price)"}),(0,t.jsx)(e.td,{children:"where x.price < ?0"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"GreaterThan"}),(0,t.jsx)(e.td,{children:"findByPriceGreaterThan(double price)"}),(0,t.jsx)(e.td,{children:"where x.price > ?0"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"After"}),(0,t.jsx)(e.td,{children:"findCreateTimeAfter(Date date)"}),(0,t.jsx)(e.td,{children:"where x.createTime > ?0"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Before"}),(0,t.jsx)(e.td,{children:"findCreateTimeBefore(Date date)"}),(0,t.jsx)(e.td,{children:"where x.createTime < ?0"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"IsNull"}),(0,t.jsx)(e.td,{children:"findByAddressIsNull(String address)"}),(0,t.jsx)(e.td,{children:"where x.address is null"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"IsNotNull,NotNull"}),(0,t.jsx)(e.td,{children:"findByAddress(Is)NotNull(String address)"}),(0,t.jsx)(e.td,{children:"where x.address is not null"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Like"}),(0,t.jsx)(e.td,{children:"findByLastnameLike(String lastname)"}),(0,t.jsxs)(e.td,{children:["where x.lastname like ?0 ","(参数需要手动添加%)"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"NotLike"}),(0,t.jsx)(e.td,{children:"findByLastnameNotLike(String lastname)"}),(0,t.jsxs)(e.td,{children:["where x.lastname not like ?0 ","(参数需要手动添加%)"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"StartingWith"}),(0,t.jsx)(e.td,{children:"findByLastnameStartingWith(String prefix)"}),(0,t.jsxs)(e.td,{children:["where x.lastname like ?0 ","(参数不需手动添加%，Spring Data会在JPQL语句中自动将%添加到字段的最前面)"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"EndingWith"}),(0,t.jsx)(e.td,{children:"findByLastnameEndingWith(String postfix)"}),(0,t.jsxs)(e.td,{children:["where x.lastname like ?0 ","(参数不需手动添加%，Spring Data会在JPQL语句中自动将%添加到字段的最后面)"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Containing"}),(0,t.jsx)(e.td,{children:"findByLastnameContaining(String centerStr)"}),(0,t.jsxs)(e.td,{children:["where  x.lastname like ?0 ","(Spring Data会在JPQL语句中自动将%添加到字段的最前边和最后面)"]})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"OrderBy"}),(0,t.jsx)(e.td,{children:"findByLastnameLikeOrderByAgeDesc(String lastname)"}),(0,t.jsx)(e.td,{children:"where x.lastname like ?0 order by x.age desc"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Not"}),(0,t.jsx)(e.td,{children:"findByLastnameNot(String lastname)"}),(0,t.jsx)(e.td,{children:"where x.lastname <> ?0"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"In"}),(0,t.jsx)(e.td,{children:"findByAgeIn(Collection ages)"}),(0,t.jsx)(e.td,{children:"where x.age in ?0"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"NotIn"}),(0,t.jsx)(e.td,{children:"findByAgeNotIn(Collection ages)"}),(0,t.jsx)(e.td,{children:"where x.age not in ?0"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"True"}),(0,t.jsx)(e.td,{children:"findByActiveTrue()"}),(0,t.jsx)(e.td,{children:"where x.active = true"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"False"}),(0,t.jsx)(e.td,{children:"findByActiveFalse()"}),(0,t.jsx)(e.td,{children:"where x.active = false"})]})]})]}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"自定义方法举例"}),"\n"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"在Dao层类中按照Spring Data Repository 查询方法命名规范定义方法"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",meta:"",children:"@Repository\r\npublic interface ProductDao extends ElasticsearchRepository<Product, Long> {\r\n\r\n    /**\r\n     * 自定义方法--按照Spring Data JPA规范命名方法\r\n     * 按照产品名称查询，并按价格降序排序\r\n     * @param productName\r\n     * @return\r\n     */\r\n    List<Product> findByProductNameOrderByPriceDesc(String productName);\r\n}\n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"在测试方法中测试上述方法"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",meta:"",children:'/**\r\n * @RunWith(SpringRunner.class): 让测试运行于Spring测试环境\r\n * @SpringBootTest(classes = ElasticsearchSpringdataApplication.class)：使用class属性指定启动类，使JUnit单元测试运行在Springboot环境中\r\n */\r\n@RunWith(SpringRunner.class)\r\n@SpringBootTest(classes = ElasticsearchSpringdataApplication.class)\r\npublic class ElasticsearchTest {\r\n    @Autowired\r\n    private ProductDao productDao;\r\n\r\n    /**\r\n     * 自定义方法：按照商品名称查询，并按价格倒序排序\r\n     */\r\n    @Test\r\n    public void findByProductNameOrderByPriceDesc() {\r\n        List<Product> products = productDao.findByProductNameOrderByPriceDesc("华为");\r\n        products.forEach(p -> System.out.println(p));\r\n    }\r\n}\n'})}),"\n",(0,t.jsxs)(e.h3,{id:"8410-使用query自定义dsl查询语句",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#8410-使用query自定义dsl查询语句",children:"#"}),"8.4.10 使用@Query自定义DSL查询语句"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"在Dao层类中定义查询方法，并使用@Query注解"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",meta:"",children:'/**\r\n * Procuct dao层接口\r\n * @author tth\r\n * @description\r\n * @date 2023/5/11 13:45\r\n */\r\n@Repository\r\npublic interface ProductDao extends ElasticsearchRepository<Product, Long> {\r\n    /**\r\n     * 自定义方法，@Query自定义语句进行查询（分页的使用）\r\n     * @param productName\r\n     * @return\r\n     */\r\n    @Query("{\\"match\\":{\\"productName\\":\\"?0\\"}}")\r\n    Page<Product> getByProductName(String productName, Pageable pageable);\r\n}\n'})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"在测试方法中测试上述方法"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",meta:"",children:'/**\r\n * @RunWith(SpringRunner.class): 让测试运行于Spring测试环境\r\n * @SpringBootTest(classes = ElasticsearchSpringdataApplication.class)：使用class属性指定启动类，使JUnit单元测试运行在Springboot环境中\r\n */\r\n@RunWith(SpringRunner.class)\r\n@SpringBootTest(classes = ElasticsearchSpringdataApplication.class)\r\npublic class ElasticsearchTest {\r\n    @Autowired\r\n    private ProductDao productDao;\r\n\r\n    /**\r\n     * 使用@Query自定义DSL查询\r\n     */\r\n    @Test\r\n    public void getByProductName() {\r\n        PageRequest pageRequest = PageRequest.of(0, 2);\r\n        Page<Product> page = productDao.getByProductName("华为", pageRequest);\r\n        // 元素总个数\r\n        long totalElements = page.getTotalElements();\r\n        System.out.println(totalElements);\r\n        // 总页数\r\n        int totalPages = page.getTotalPages();\r\n        System.out.println(totalPages);\r\n        // 元素列表\r\n        List<Product> products = page.getContent();\r\n        products.forEach(p -> System.out.println(p));\r\n    }\r\n\r\n}\n'})}),"\n",(0,t.jsxs)(e.h3,{id:"8411-使用elasticsearchresttemplate进行查询",children:[(0,t.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#8411-使用elasticsearchresttemplate进行查询",children:"#"}),"8.4.11 使用ElasticsearchRestTemplate进行查询"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-java",meta:"",children:'/**\r\n * @RunWith(SpringRunner.class): 让测试运行于Spring测试环境\r\n * @SpringBootTest(classes = ElasticsearchSpringdataApplication.class)：使用class属性指定启动类，使JUnit单元测试运行在Springboot环境中\r\n */\r\n@RunWith(SpringRunner.class)\r\n@SpringBootTest(classes = ElasticsearchSpringdataApplication.class)\r\npublic class ElasticsearchTest {\r\n\r\n    @Autowired\r\n    private ElasticsearchRestTemplate template;\r\n\r\n    @Test\r\n    public void getByProductNameWithElasticsearchRestTemplate() {\r\n        Page<Product> page = pageAndSort("华为手机", 3900.00, 5900.00);\r\n        // 元素总个数\r\n        long totalElements = page.getTotalElements();\r\n        System.out.println(totalElements);\r\n        // 总页数\r\n        int totalPages = page.getTotalPages();\r\n        System.out.println(totalPages);\r\n        // 元素列表\r\n        List<Product> products = page.getContent();\r\n        products.forEach(p -> System.out.println(p));\r\n    }\r\n    \r\n    /**\r\n     * 使用ElasticsearchRestTemplate查询\r\n     * @param productName\r\n     * @param price1\r\n     * @param price2\r\n     * @return\r\n     */\r\n    private Page<Product> pageAndSort(String productName, double price1, double price2) {\r\n        PageRequest pageRequest = PageRequest.of(0, 2);\r\n\r\n        NativeSearchQueryBuilder query = new NativeSearchQueryBuilder();\r\n        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\r\n\r\n        if (StringUtils.isNotBlank(productName)) {\r\n            boolQueryBuilder.must(QueryBuilders.matchQuery("productName", productName));\r\n        }\r\n        boolQueryBuilder.must(QueryBuilders.rangeQuery("price").gte(price1).lte(price2));\r\n\r\n        query.withQuery(boolQueryBuilder);\r\n        query.withPageable(pageRequest);\r\n        query.withSort(SortBuilders.fieldSort("price").order(SortOrder.DESC));\r\n\r\n        SearchHits<Product> searchHits = template.search(query.build(), Product.class);\r\n\r\n        List<Product> Products = new ArrayList<>();\r\n        for (SearchHit<Product> searchHit : searchHits) {\r\n            Products.add(searchHit.getContent());\r\n        }\r\n\r\n        return new PageImpl<Product>(Products, pageRequest, searchHits.getTotalHits());\r\n    }\r\n}\n'})})]})}function l(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,a.ah)(),r.components);return e?(0,t.jsx)(e,Object.assign({},r,{children:(0,t.jsx)(c,r)})):c(r)}let o=l;l.__RSPRESS_PAGE_META={},l.__RSPRESS_PAGE_META["tang%2FElasticsearch%2F08_Spring%20Data%20Elasticsearch.md"]={toc:[{id:"81-spring-data-框架介绍",text:"8.1 Spring Data 框架介绍",depth:2},{id:"82-spring-data-elasticsearch-介绍",text:"8.2 Spring Data Elasticsearch 介绍",depth:2},{id:"83-spring-data-elasticsearch-版本",text:"8.3 Spring Data Elasticsearch 版本",depth:2},{id:"84-spring-data-elasticsearch-使用",text:"8.4 Spring Data Elasticsearch 使用",depth:2},{id:"841-创建maven项目",text:"8.4.1 创建maven项目",depth:3},{id:"842-引入依赖",text:"8.4.2 引入依赖",depth:3},{id:"843-创建配置文件",text:"8.4.3 创建配置文件",depth:3},{id:"844-创建启动类和主目录",text:"8.4.4 创建启动类和主目录",depth:3},{id:"845-创建配置类",text:"8.4.5 创建配置类",depth:3},{id:"846-添加document映射实体",text:"8.4.6 添加document映射实体",depth:3},{id:"847-创建dao层数据访问",text:"8.4.7 创建Dao层数据访问",depth:3},{id:"848-创建测试类进行测试",text:"8.4.8 创建测试类，进行测试",depth:3},{id:"849-使用spring-data查询方法命名规范自定义查询方法",text:"8.4.9 使用Spring Data查询方法命名规范自定义查询方法",depth:3},{id:"8410-使用query自定义dsl查询语句",text:"8.4.10 使用@Query自定义DSL查询语句",depth:3},{id:"8411-使用elasticsearchresttemplate进行查询",text:"8.4.11 使用ElasticsearchRestTemplate进行查询",depth:3}],title:"8 Spring Data Elasticsearch",headingTitle:"8 Spring Data Elasticsearch",frontmatter:{}}}}]);