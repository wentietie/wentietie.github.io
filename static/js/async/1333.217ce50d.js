"use strict";(self.webpackChunkmy_doc=self.webpackChunkmy_doc||[]).push([["1333"],{77315:function(e,n,i){i.r(n),i.d(n,{default:()=>A});var s=i("85893"),r=i("50065");let d=i.p+"static/image/k8s-jenkins-auto-python-1.0988f995.png",c=i.p+"static/image/k8s-jenkins-auto-python-2.76b27854.png",h=i.p+"static/image/k8s-jenkins-auto-python-10.a8c51de8.png",a=i.p+"static/image/k8s-jenkins-auto-python-11.dd0458b2.png",t=i.p+"static/image/k8s-jenkins-auto-python-12.89d81688.png",o=i.p+"static/image/k8s-jenkins-auto-python-13.15f7a93d.png",l=i.p+"static/image/k8s-jenkins-auto-python-14.1728d546.png",j=i.p+"static/image/k8s-jenkins-auto-python-15.3803b302.png",g=i.p+"static/image/k8s-jenkins-auto-python-3.ff3f1b6f.png",x=i.p+"static/image/k8s-jenkins-auto-python-4.e171fd5a.png",p=i.p+"static/image/k8s-jenkins-auto-python-5.9d141084.png",m=i.p+"static/image/k8s-jenkins-auto-python-6.681acc41.png",k=i.p+"static/image/k8s-jenkins-auto-python-8.e9143eea.png",u=i.p+"static/image/k8s-jenkins-auto-python-9.069176b7.png";function I(e){let n=Object.assign({h1:"h1",a:"a",p:"p",code:"code",img:"img",h2:"h2",h3:"h3",strong:"strong",pre:"pre"},(0,r.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"自动部署",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#自动部署",children:"#"}),"自动部署"]}),"\n",(0,s.jsxs)(n.h1,{id:"1插件准备",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1插件准备",children:"#"}),"1.插件准备"]}),"\n",(0,s.jsxs)(n.p,{children:["在jenkins管理界面，点击",(0,s.jsx)(n.code,{children:"Manage Jenkins"}),"，选择",(0,s.jsx)(n.code,{children:"Manage Plugins"}),"，点击",(0,s.jsx)(n.code,{children:"可选插件"}),"，搜索",(0,s.jsx)(n.code,{children:"GitLab Plugin"}),"、",(0,s.jsx)(n.code,{children:"Docker Plugin"}),"，直接安装。"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"1614741687301",src:d})}),"\n",(0,s.jsxs)(n.h1,{id:"2服务器环境配置",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2服务器环境配置",children:"#"}),"2.服务器环境配置"]}),"\n",(0,s.jsxs)(n.h2,{id:"21安装git",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#21安装git",children:"#"}),"2.1安装git"]}),"\n",(0,s.jsx)(n.p,{children:"因是每次git上项目有更新，都会自动制作镜像、升级服务镜像，故装有jenkins的服务器需要安装git用来下载gitlab上的项目。"}),"\n",(0,s.jsxs)(n.h2,{id:"22安装docker",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#22安装docker",children:"#"}),"2.2安装docker"]}),"\n",(0,s.jsx)(n.p,{children:"制作镜像的时候，需要用到docker，因此装有jenkins的服务器需要安装docker来实现镜像的制作与推送等操作。"}),"\n",(0,s.jsxs)(n.h1,{id:"3jenkins全局工具配置",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3jenkins全局工具配置",children:"#"}),"3.jenkins全局工具配置"]}),"\n",(0,s.jsxs)(n.p,{children:["在jenkins管理界面，点击",(0,s.jsx)(n.code,{children:"Manage Jenkins"}),"，选择",(0,s.jsx)(n.code,{children:"Global Tool Configuration"}),"，点击",(0,s.jsx)(n.code,{children:"可选插件"}),"，搜索",(0,s.jsx)(n.code,{children:"GitLab Plugin"}),"、",(0,s.jsx)(n.code,{children:"Docker Plugin"}),"，直接安装。"]}),"\n",(0,s.jsxs)(n.h2,{id:"31配置git",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#31配置git",children:"#"}),"3.1配置git"]}),"\n",(0,s.jsxs)(n.p,{children:["在jenkins管理界面，点击",(0,s.jsx)(n.code,{children:"Manage Jenkins"}),"，选择",(0,s.jsx)(n.code,{children:"Global Tool Configuration"}),"，找到",(0,s.jsx)(n.code,{children:"Git"}),"，点击",(0,s.jsx)(n.code,{children:"Add Git"}),"，对git进行配置。"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"1614743317137",src:c})}),"\n",(0,s.jsxs)(n.h2,{id:"32配置docker",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#32配置docker",children:"#"}),"3.2配置docker"]}),"\n",(0,s.jsxs)(n.h3,{id:"321docker基本配置",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#321docker基本配置",children:"#"}),"3.2.1docker基本配置"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"1614843920373",src:h})}),"\n",(0,s.jsxs)(n.h3,{id:"322docker配置失败的解决方法",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#322docker配置失败的解决方法",children:"#"}),"3.2.2docker配置失败的解决方法"]}),"\n",(0,s.jsx)(n.p,{children:"如果点击【Test Connection】按钮报如下错误，可按照以下步骤解决。"}),"\n",(0,s.jsx)(n.p,{children:"报错如下："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"1614844086777",src:a})}),"\n",(0,s.jsx)(n.p,{children:"解决步骤："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["Step1.输入",(0,s.jsx)(n.code,{children:"systemctl status docker"}),"查看docker端口号"]})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"1614844258679",src:t})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Step2. 修改docker tcp端口号"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",meta:"",children:"vim /usr/lib/systemd/system/docker.service\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"1614844441143",src:o})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Step3.重启docker"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",meta:"",children:"systemctl daemon-reload\r\nsystemctl restart docker\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"161484499599",src:l})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Step4.jenkins测试是否连接成功"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"1614844727424",src:j})}),"\n",(0,s.jsxs)(n.h1,{id:"4创建项目",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#4创建项目",children:"#"}),"4.创建项目"]}),"\n",(0,s.jsxs)(n.h2,{id:"41-新建item",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#41-新建item",children:"#"}),"4.1 新建Item"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"1614821818967",src:g})}),"\n",(0,s.jsxs)(n.h2,{id:"42项目源码设置",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#42项目源码设置",children:"#"}),"4.2项目源码设置"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"1614828619072",src:x})}),"\n",(0,s.jsxs)(n.h2,{id:"43-构建触发器",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#43-构建触发器",children:"#"}),"4.3 构建触发器"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"1614828848872",src:p})}),"\n",(0,s.jsxs)(n.h2,{id:"44编写构建脚本",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#44编写构建脚本",children:"#"}),"4.4编写构建脚本"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"1614829216956",src:m})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",meta:"",children:'#!/bin/bash\r\n\r\npro_version=$(git log | awk \'{print $1}\' | awk \'{print $2}\' | sort | uniq -c | sort -k1,1nr)\r\npro_image=10.1.93.164:5000/python-test:v${pro_version// /}\r\ndocker build -t ${pro_image} .\r\necho "-------------------------镜像build成功？" $?\r\nif [ $? = 0 ]\r\nthen\r\n    docker push ${pro_image}\r\n    echo "-------------------------镜像push成功？" $?\r\n    if [ $? = 0 ]\r\n    then\r\n        update_image_cmd="kubectl patch deployment test1 -n tth-test --patch \'{\\"spec\\": {\\"template\\": {\\"spec\\": {\\"containers\\": [{\\"name\\": \\"test1-c\\",\\"image\\":\\"${pro_image}\\"}]}}}}\'"\r\n        echo \r\n        ssh root@10.1.93.160 ${update_image_cmd}\r\n        echo "-------------------------服务升级成功？" $?\r\n    fi\r\nfi\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"45保存项目信息",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#45保存项目信息",children:"#"}),"4.5保存项目信息"]}),"\n",(0,s.jsx)(n.p,{children:"项目信息编写完成后，点击【保存】按钮即可。"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"1614829313001",src:"data:image/png;base64,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"})}),"\n",(0,s.jsxs)(n.h1,{id:"5部署项目",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#5部署项目",children:"#"}),"5.部署项目"]}),"\n",(0,s.jsxs)(n.h2,{id:"51-运行",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#51-运行",children:"#"}),"5.1 运行"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"1614829530686",src:k})}),"\n",(0,s.jsxs)(n.h2,{id:"52查看项目构建日志",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#52查看项目构建日志",children:"#"}),"5.2查看项目构建日志"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:u})})]})}function f(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(I,e)})):I(e)}let A=f;f.__RSPRESS_PAGE_META={},f.__RSPRESS_PAGE_META["tang%2Fk8s%2F%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99%2Fauto.md"]={toc:[{id:"21安装git",text:"2.1安装git",depth:2},{id:"22安装docker",text:"2.2安装docker",depth:2},{id:"31配置git",text:"3.1配置git",depth:2},{id:"32配置docker",text:"3.2配置docker",depth:2},{id:"321docker基本配置",text:"3.2.1docker基本配置",depth:3},{id:"322docker配置失败的解决方法",text:"3.2.2docker配置失败的解决方法",depth:3},{id:"41-新建item",text:"4.1 新建Item",depth:2},{id:"42项目源码设置",text:"4.2项目源码设置",depth:2},{id:"43-构建触发器",text:"4.3 构建触发器",depth:2},{id:"44编写构建脚本",text:"4.4编写构建脚本",depth:2},{id:"45保存项目信息",text:"4.5保存项目信息",depth:2},{id:"51-运行",text:"5.1 运行",depth:2},{id:"52查看项目构建日志",text:"5.2查看项目构建日志",depth:2}],title:"自动部署",headingTitle:"自动部署",frontmatter:{}}}}]);