<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Rspress v1.38.0">
  <title data-rh="true">13 Elasticsearch的优化建议 - wenatie</title>
<script>{;const saved = localStorage.getItem('rspress-theme-appearance');const preferDark = window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = !saved || saved === 'auto' ? preferDark : saved === 'dark';document.documentElement.classList.toggle('dark', isDark);document.documentElement.style.colorScheme = isDark ? 'dark' : 'light';}</script><link rel="icon" href="/rspress-icon.png"><script defer src="/static/js/styles.1737145b.js"></script><script defer src="/static/js/lib-react.bfe73f81.js"></script><script defer src="/static/js/lib-router.aa18f61d.js"></script><script defer src="/static/js/index.df03ac1d.js"></script><link href="/static/css/styles.c26b7a64.css" rel="stylesheet"></head>

<body >
  <div id="root"><div><div class="navContainer_f6cde rspress-nav px-6 " style="position:sticky"><div class="container_f6cde flex justify-between items-center h-full"><div class="navBarTitle_f6cde"><a class="link_03735 flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60 cursor-pointer" target="" href="/index.html"><span>wenatie</span></a></div><div class="flex flex-1 justify-end items-center"><div class="rightNav_f6cde"><div class="flex sm:flex-1 items-center sm:pl-4 sm:pr-2"><div class="rspress-nav-search-button navSearchButton_6e282"><button><svg width="18" height="18" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9Z"></path></svg><p class="searchWord_6e282">Search Docs</p><div style="opacity:0"><span></span><span>K</span></div></button></div><div class="mobileNavSearchButton_6e282"><svg width="24" height="24" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9Z"></path></svg></div></div><div class="rspress-nav-menu menu h-14"><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">小唐学习笔记</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/gitlab/gitlab-error.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>gitlab</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/java2/00_前言.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>java</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/mysql/01_MySQL概述.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>mysql</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/docker/Docker.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>docker</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/k8s/学习资料/command.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>k8s</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/Elasticsearch/01_Elasticsearch概述.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>Elasticsearch</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/Prometheus/1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>Prometheus</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/Python/1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>Python</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/Vue/1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>Vue</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/server/CentOS7root账号免密登录.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>服务器环境安装</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/mservice/2.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>微服务</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/项目上线/xiaochengxu.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>项目上线</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/IoTPlatform/jetlinks项目初体验.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>物联网项目</span></div></div></a></div></div></div></div></div></div><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">前端基础</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/es6/es6-1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>ES6入门</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/youdontknowjs/part1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>你不知道的Javascript</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/design/index.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>设计模式</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/typescript/ts-basic.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>typescript</span></div></div></a></div></div></div></div></div></div><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">框架</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/formwork/vue/vueyuanli.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>vue2</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/formwork/vue3/reactive/part1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>vue3</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/formwork/harmony/part1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>鸿蒙</span></div></div></a></div></div></div></div></div></div><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">计算机基础</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/end/c/data-contruction/part1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>数据结构（严蔚敏）</span></div></div></a></div></div></div></div></div></div><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">随笔笔记</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/notes/JS/hwdj.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>JS相关</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/notes/CSS/css-selector.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>CSS相关</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/notes/browser/xmlhttprequest.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>浏览器相关</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/notes/node/node.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>node相关</span></div></div></a></div></div></div></div></div></div></div><div class="flex-center flex-row"><div class="mx-2"><div class="md:mr-2 rspress-nav-appearance"><div class="p-1 border border-solid border-gray-300 text-gray-400  cursor-pointer rounded-md hover:border-gray-600 hover:text-gray-600 dark:hover:border-gray-200 dark:hover:text-gray-200 transition-all duration-300 w-7 h-7"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="dark:hidden" width="18" height="18" fill="currentColor"><path d="M12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm0-10c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zM12 4c-.6 0-1-.4-1-1V1c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1zM12 24c-.6 0-1-.4-1-1v-2c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1zM5.6 6.6c-.3 0-.5-.1-.7-.3L3.5 4.9c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.1.2-.4.3-.7.3zM19.8 20.8c-.3 0-.5-.1-.7-.3l-1.4-1.4c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.2.2-.5.3-.7.3zM3 13H1c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1zM23 13h-2c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1zM4.2 20.8c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.4.3-.7.3zM18.4 6.6c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.5.3-.7.3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="hidden dark:block" width="18" height="18" fill="currentColor"><path d="M12.1 22h-.9c-5.5-.5-9.5-5.4-9-10.9.4-4.8 4.2-8.6 9-9 .4 0 .8.2 1 .5.2.3.2.8-.1 1.1-2 2.7-1.4 6.4 1.3 8.4 2.1 1.6 5 1.6 7.1 0 .3-.2.7-.3 1.1-.1.3.2.5.6.5 1-.2 2.7-1.5 5.1-3.6 6.8-1.9 1.4-4.1 2.2-6.4 2.2zM9.3 4.4c-2.9 1-5 3.6-5.2 6.8-.4 4.4 2.8 8.3 7.2 8.7 2.1.2 4.2-.4 5.8-1.8 1.1-.9 1.9-2.1 2.4-3.4-2.5.9-5.3.5-7.5-1.1-2.8-2.2-3.9-5.9-2.7-9.2z"></path></svg></div></div></div></div></div><div class="mobileNavMenu_f6cde"><div class="navScreen_457e8 " id="navScreen"><div class="container_457e8"><div class="navMenu_457e8"><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">小唐学习笔记</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/gitlab/gitlab-error.html"><div><div class="flex justify-center"><span>gitlab</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/java2/00_前言.html"><div><div class="flex justify-center"><span>java</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/mysql/01_MySQL概述.html"><div><div class="flex justify-center"><span>mysql</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/docker/Docker.html"><div><div class="flex justify-center"><span>docker</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/k8s/学习资料/command.html"><div><div class="flex justify-center"><span>k8s</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/Elasticsearch/01_Elasticsearch概述.html"><div><div class="flex justify-center"><span>Elasticsearch</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/Prometheus/1.html"><div><div class="flex justify-center"><span>Prometheus</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/Python/1.html"><div><div class="flex justify-center"><span>Python</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/Vue/1.html"><div><div class="flex justify-center"><span>Vue</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/server/CentOS7root账号免密登录.html"><div><div class="flex justify-center"><span>服务器环境安装</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/mservice/2.html"><div><div class="flex justify-center"><span>微服务</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/项目上线/xiaochengxu.html"><div><div class="flex justify-center"><span>项目上线</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/IoTPlatform/jetlinks项目初体验.html"><div><div class="flex justify-center"><span>物联网项目</span></div></div></a></div></div></div></div></div></div></div><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">前端基础</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/es6/es6-1.html"><div><div class="flex justify-center"><span>ES6入门</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/youdontknowjs/part1.html"><div><div class="flex justify-center"><span>你不知道的Javascript</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/design/index.html"><div><div class="flex justify-center"><span>设计模式</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/typescript/ts-basic.html"><div><div class="flex justify-center"><span>typescript</span></div></div></a></div></div></div></div></div></div></div><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">框架</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/formwork/vue/vueyuanli.html"><div><div class="flex justify-center"><span>vue2</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/formwork/vue3/reactive/part1.html"><div><div class="flex justify-center"><span>vue3</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/formwork/harmony/part1.html"><div><div class="flex justify-center"><span>鸿蒙</span></div></div></a></div></div></div></div></div></div></div><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">计算机基础</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/end/c/data-contruction/part1.html"><div><div class="flex justify-center"><span>数据结构（严蔚敏）</span></div></div></a></div></div></div></div></div></div></div><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">随笔笔记</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/notes/JS/hwdj.html"><div><div class="flex justify-center"><span>JS相关</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/notes/CSS/css-selector.html"><div><div class="flex justify-center"><span>CSS相关</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/notes/browser/xmlhttprequest.html"><div><div class="flex justify-center"><span>浏览器相关</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/notes/node/node.html"><div><div class="flex justify-center"><span>node相关</span></div></div></a></div></div></div></div></div></div></div></div><div class="flex-center flex-col gap-2"><div class="mt-2 navAppearance_457e8 flex justify-center"></div></div></div></div><button aria-label="mobile hamburger" class=" navHamburger_e7b06 text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="currentColor"><circle cx="8" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="24" cy="16" r="2" fill="currentColor"></circle></svg></button></div></div></div></div><section><div class="docLayout_edeb4 pt-0"><div class="rspress-sidebar-menu"><button class="flex-center mr-auto"><div class="text-md mr-2"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M4 6h24v2H4zm0 18h24v2H4zm0-12h24v2H4zm0 6h24v2H4z"></path></svg></div><span class="text-sm">Menu</span></button><button class="flex-center ml-auto"><span class="text-sm">ON THIS PAGE</span><div class="text-md mr-2" style="transform:rotate(0deg);transition:transform 0.2s ease-out;margin-top:2px"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></button><div class="rspress-local-toc-container "><ul><li><a href="#131-硬件选择" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">13.1 硬件选择</span></a></li><li><a href="#132-分片策略" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">13.2 分片策略</span></a></li><li><a href="#1321-合理设置分片数" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">13.2.1 合理设置分片数</span></a></li><li><a href="#1322-推迟分片分配" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">13.2.2 推迟分片分配</span></a></li><li><a href="#133-路由选择" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">13.3 路由选择</span></a></li><li><a href="#134-写入速度优化" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">13.4 写入速度优化</span></a></li><li><a href="#1341-增大translog-flush间隔" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">13.4.1 增大Translog flush间隔</span></a></li><li><a href="#1342-增大index-refresh间隔" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">13.4.2 增大Index Refresh间隔</span></a></li><li><a href="#1343-段合并优化" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">13.4.3 段合并优化</span></a></li><li><a href="#1344-善用bulk请求" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">13.4.4 善用Bulk请求</span></a></li><li><a href="#1345-单节点磁盘间的任务均衡" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">13.4.5 单节点磁盘间的任务均衡</span></a></li><li><a href="#1346-节点间的任务均衡" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">13.4.6 节点间的任务均衡</span></a></li><li><a href="#1347-优化索引的建立" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">13.4.7 优化索引的建立</span></a></li></ul></div></div><aside class="sidebar_71eca rspress-sidebar "><div class="navTitleMask_71eca"><div class="navBarTitle_f6cde"><a class="link_03735 flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60 cursor-pointer" target="" href="/index.html"><span>wenatie</span></a></div></div><div class="rspress-scrollbar sidebarContent_71eca"><nav class="pb-2"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_71eca" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">Elasticsearch</span></h2><div class="collapseContainer_71eca p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(90deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:1;margin-left:12px"><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Elasticsearch/01_Elasticsearch概述.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>1 概述</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Elasticsearch/02_Elasticsearch相关工具的安装与使用.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>2 ES相关工具的安装与使用</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Elasticsearch/03_Elasticsearch核心概念.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>3 核心概念</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Elasticsearch/04_Elasticsearch基本操作.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>4 es基本操作</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Elasticsearch/05_Elasticsearch DSL高级查询.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>5 DSL高级查询</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Elasticsearch/06_Elasticsearch进阶查询.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>6 进阶查询</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Elasticsearch/07_Java API 操作 Elasticsearch.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>7 Java API 操作 es</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Elasticsearch/08_Spring Data Elasticsearch.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>8 Spring Data Elasticsearch</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Elasticsearch/09_Linux 安装 Elasticsearch.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>9 Linux安装ES相关工具</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Elasticsearch/10_CAP定理.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>10 CAP定理</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Elasticsearch/11_Elasticsearch集群.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>11 Elasticsearch集群</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Elasticsearch/12_Elasticsearch分片控制与原理.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>12 Elasticsearch分片控制与原理</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Elasticsearch/13_Elasticsearch的优化建议.html"><div class="menuItemActive_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>13 Elasticsearch的优化建议</span></div></a></div></div></div></section></nav></div></aside><div class="content_edeb4 rspress-doc-container flex flex-shrink-0 mx-auto"><div class="w-full flex-1"><div><div class="rspress-doc"><!--$--><h1 id="13-elasticsearch的优化建议" class="text-3xl mb-10 leading-10 tracking-tight title_3b154">13 Elasticsearch的优化建议<a class="link_3b154 header-anchor" aria-hidden="true" href="#13-elasticsearch的优化建议">#</a></h1>
<h2 id="131-硬件选择" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_3b154">13.1 硬件选择<a class="link_3b154 header-anchor" aria-hidden="true" href="#131-硬件选择">#</a></h2>
<p class="my-4 leading-7">Elasticsearch是基于Lucene的，所有的索引和文档数据都是存储在本地的磁盘中，具体路径可在ES配置文件<code>config/elasticsearch.yml</code>中配置，如下：</p>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-comment)"># 数据文件</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">path.data</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ./data
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 日志文件</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">path.logs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ./logs</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">磁盘在现代服务器上通常都是瓶颈。Elasticsearch重度使用磁盘，<strong class="font-semibold">磁盘的吞吐量越大，节点就越稳定。</strong></p>
<blockquote class="border-l-2 border-solid border-divider pl-4 my-6 transition-colors duration-500 blockquote_3b154">
<p class="my-4 leading-7">优化磁盘I/O的技巧</p>
</blockquote>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">使用SSD（固态硬盘）</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">使用RAID 0（一种硬盘阵列）：读写速度快，能够提高磁盘容量。但是当一快磁盘故障整个就故障了。不要使用镜像或者奇偶校验RAID，因为副本已经提供该功能。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">使用多块硬盘，并允许Elasticsearch通过多个<code>path.data</code>目录配置把数据条带化分配到它们上面。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">不要使用远程挂载的存储，如NFS或者SMB/CIFS</p>
</li>
</ul>
<h2 id="132-分片策略" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_3b154">13.2 分片策略<a class="link_3b154 header-anchor" aria-hidden="true" href="#132-分片策略">#</a></h2>
<h3 id="1321-合理设置分片数" class="mt-10 mb-2 leading-7 text-xl title_3b154">13.2.1 合理设置分片数<a class="link_3b154 header-anchor" aria-hidden="true" href="#1321-合理设置分片数">#</a></h3>
<blockquote class="border-l-2 border-solid border-divider pl-4 my-6 transition-colors duration-500 blockquote_3b154">
<p class="my-4 leading-7">分片的代价</p>
</blockquote>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">一个分片的底层即为一个Lucene索引，会消耗一定文件句柄、内存以及CPU运转</li>
<li class="[&amp;:not(:first-child)]:mt-2">每一个搜索请求都需要命中索引中的一个分片。如果多个分片处于同一个节点，这些分片就会竞争使用相同的资源</li>
<li class="[&amp;:not(:first-child)]:mt-2">用于计算相关度的词项统计信息是基于分片的。如果分片过多，就会导致很低的相关度</li>
</ul>
<blockquote class="border-l-2 border-solid border-divider pl-4 my-6 transition-colors duration-500 blockquote_3b154">
<p class="my-4 leading-7">分片遵循的原则</p>
</blockquote>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">控制每个分片占用的磁盘容量不超过ES的最大JVN堆栈空间设置（JVM一般不超过32M，参考下面JVM设置原则）。</p>
<p class="my-4 leading-7"><code>栗子</code> 假设索引的总容量在500G左右，那么分片大小在16个左右即可。当然，最好同时考虑原则2</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">分片数一般不要超过节点数的3倍。</p>
<p class="my-4 leading-7"><code>说明</code> 一般来书一个节点就是一台物理机。如果分片数打打超过节点数，就会造成一个节点上多个分片，处理在索引时会竞争资源外，一旦该节点故障，即使保持了1个以上的副本，同样有可能导致数据丢失，集群无法恢复。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">主分片、副本、节点最大数的计算公式如下：</p>
<p class="my-4 leading-7"><code>公式</code> 节点数 &lt;= 主分片数 * (副本数 + 1)</p>
</li>
</ul>
<h3 id="1322-推迟分片分配" class="mt-10 mb-2 leading-7 text-xl title_3b154">13.2.2 推迟分片分配<a class="link_3b154 header-anchor" aria-hidden="true" href="#1322-推迟分片分配">#</a></h3>
<p class="my-4 leading-7">对于节点瞬时中断的问题，默认情况下，集群会等待<strong class="font-semibold">1min</strong>来查看节点是否会重新加入。
如果这个节点在此瞬间重新加入，重新加入的节点会保持现有的分片数据，不会触发新的分片分配。
这样就可以减少Elasticsearch在自动再平衡可用分片时所带来的的极大开销。</p>
<blockquote class="border-l-2 border-solid border-divider pl-4 my-6 transition-colors duration-500 blockquote_3b154">
<p class="my-4 leading-7">延长再均衡时间</p>
</blockquote>
<p class="my-4 leading-7">通过修改参数<code>delayed_time</code>，延长再均衡时间。可以全局设置，也可以在索引级别修改</p>
<div class="language-text"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-text" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>PUT /_all/_settings 
</span></span><span style="display:block;padding:0 1.25rem">{
</span><span style="display:block;padding:0 1.25rem">  &quot;settings&quot;: {
</span><span style="display:block;padding:0 1.25rem">    &quot;index.unassigned.node_left.delayed_timeout&quot;: &quot;5m&quot; 
</span><span style="display:block;padding:0 1.25rem">  }
</span><span style="display:block;padding:0 1.25rem">}</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<h2 id="133-路由选择" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_3b154">13.3 路由选择<a class="link_3b154 header-anchor" aria-hidden="true" href="#133-路由选择">#</a></h2>
<p class="my-4 leading-7">当进行文档查询的时候，Elasticsearch是通过如下公式计算得到文档存放的分片：</p>
<p class="my-4 leading-7"><code>shard = hash(routing) % number_of_primary_shards</code>
其中，routing默认值是文档id，也可以采用自定义值。</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">不带routing查询</strong></p>
<p class="my-4 leading-7">在查询时，因为不知道要查询的数据具体在哪个分片上，所以整个过程分为2个步骤</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">分发： 请求到达协调节点后，协调节点将查询请求分发到每个分片上</li>
<li class="[&amp;:not(:first-child)]:mt-2">聚合： 协调节点搜集到每个分片上的查询结果，将查询结果进行排序，然后将结果返回给用户</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">带routing查询</strong></p>
<p class="my-4 leading-7">查询时，可以根据routing信息定位到某个分片查询，不需要查询所有分片。</p>
</li>
</ul>
<h2 id="134-写入速度优化" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_3b154">13.4 写入速度优化<a class="link_3b154 header-anchor" aria-hidden="true" href="#134-写入速度优化">#</a></h2>
<p class="my-4 leading-7">ES默认配置，是综合了数据可靠性、写入速度、搜索实时性等因素。
实际使用时，可以按照实际情况，进行偏向性的优化。</p>
<blockquote class="border-l-2 border-solid border-divider pl-4 my-6 transition-colors duration-500 blockquote_3b154">
<p class="my-4 leading-7">写入速度优化概述</p>
</blockquote>
<p class="my-4 leading-7">针对搜索性能要求不高，但对写入要求较高的场景，我们需要尽可能的选择恰当的写优化策略。
综合来说，可以考虑一下几个方面来提升索引的性能：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">在集群正常运行的前提下，如果是集群首次批量导入数据时，可以将副本数设置为0，导入完毕后再将副本数调整为正常值，这样副分片就只需要复制，节约了构建索引的时间</li>
<li class="[&amp;:not(:first-child)]:mt-2">增大Translog flush间隔，目的是降低Iops（即每秒的输入输出量(或读写次数)，是衡量磁盘性能的主要指标之一）、WriteBlock</li>
<li class="[&amp;:not(:first-child)]:mt-2">增大Index Refresh间隔，以减少I/O，更重要的是减少Segment Merge（段合并）的次数</li>
<li class="[&amp;:not(:first-child)]:mt-2">善用Bulk请求，调整Bulk线程池和队列</li>
<li class="[&amp;:not(:first-child)]:mt-2">优化磁盘的任务均匀情况，将shard尽量均匀分布到物理主机的各个磁盘</li>
<li class="[&amp;:not(:first-child)]:mt-2">优化节点见的任务分布，将任务尽量均匀的发到各个节点</li>
<li class="[&amp;:not(:first-child)]:mt-2">优化Lucene层的索引建立，以降低CPU和IO，如禁用<code>_all</code>字段</li>
</ul>
<blockquote class="border-l-2 border-solid border-divider pl-4 my-6 transition-colors duration-500 blockquote_3b154">
<p class="my-4 leading-7">重要概念</p>
</blockquote>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><code>flush</code>：是指触发lucene commit，也就是将缓存中的数据写入到磁盘，并清空translog日志文件</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>refresh</code>: 是指从内存到文件系统缓存的过程。此时该文档就可以被搜索到，但是该文档还没有存储到磁盘上，如果机器宕机了，数据就会丢失</li>
</ul>
<h3 id="1341-增大translog-flush间隔" class="mt-10 mb-2 leading-7 text-xl title_3b154">13.4.1 增大Translog flush间隔<a class="link_3b154 header-anchor" aria-hidden="true" href="#1341-增大translog-flush间隔">#</a></h3>
<p class="my-4 leading-7">默认情况下，translog的持久化策略为每个请求都flush。对应配置如下：</p>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">index.translog.durability</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> request</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这是写入速度的最大因素，但是也只有这样，写操作才有可能是可靠的。</p>
<p class="my-4 leading-7"><strong class="font-semibold">如果系统能够接受一定概率的数据的丢失</strong>（如，数据写入主分片成功，尚未复制到副本时，主机断电。由于数据既没有刷到Lucene，translog也没有刷入磁盘，恢复时，translog中没有这个数据，导致数据丢失），
则可以调整translog持久化策略为周期性和一定大小的时候flush。如：</p>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-comment)"># async表示translog的刷盘策略按sync_interval配置指定的时间周期进行</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">index.translog.durability</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> async
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># 加大translog刷盘间隔时间。默认为5s，不可低于10ms</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">index.translog.sync_interval</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 120s
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)"># （段合并的时候设置）设置当超过一定大小时进行flush。当超过这个大小会导致refresh操作，产生新的Lucene分段。默认值为 512MB</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">index.translog.flush_threshold_size</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 1024mb</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<h3 id="1342-增大index-refresh间隔" class="mt-10 mb-2 leading-7 text-xl title_3b154">13.4.2 增大Index Refresh间隔<a class="link_3b154 header-anchor" aria-hidden="true" href="#1342-增大index-refresh间隔">#</a></h3>
<p class="my-4 leading-7">默认情况下索引的refresh_interval为1s，这意味着数据每隔1s就会从es缓存中写入文件系统缓存中，以保证数据可以被搜索到。
每次索引的refresh会产生一个新的Lucene段（即segment），segment在符合一定条件后，会自动合并，因此这会导致频繁的segment merge行为。
如果不需要这么高的搜索实时性，应该降低索引refresh周期。</p>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">index.refresh_interval</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 120s</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<h3 id="1343-段合并优化" class="mt-10 mb-2 leading-7 text-xl title_3b154">13.4.3 段合并优化<a class="link_3b154 header-anchor" aria-hidden="true" href="#1343-段合并优化">#</a></h3>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">降低段产生的数量</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">增大Index Refresh间隔（见13.4.2小节）</li>
<li class="[&amp;:not(:first-child)]:mt-2">增大分片的indexing buffer<!-- -->
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">indexing buffer在为doc建立索引时使用，当缓冲满时会刷入磁盘， 生成一个新的segment，这是除refresh_interval刷新索引外，另一个生成新segment的机会。</li>
<li class="[&amp;:not(:first-child)]:mt-2">每个shard有自己的indexing buffer， 配置修改如下<!-- -->
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">indices.memory.index_buffer_size</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 15% </span><span class="token" style="color:var(--code-token-comment)"># 默认为10%，可以适当增大该值</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">尽量减少文档的更新操作</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">降低最大段的大小，避免较大的段继续参与merge，节省系统资源，但是最终会有多个段</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">增大<code>index.merge.policy.segments_per_tier</code>，默认为10，值越小表示需要越多的merge。</p>
<p class="my-4 leading-7">另：该值需要大于等于<code>index.merge.policy.max_merge_at_once</code>(表示默认一次最多归并segment的个数，默认为10)</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">减小<code>index.merge.policy.max_merged_segment</code>，默认5GB。当段的大小超过此值后，将不再参与merge操作</p>
</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">当Index不再有写入操作时，对其进行force merge，最好force merge成1个段。
如此可以提升查询速度，减少内存开销，但是force merge时会消耗大量的I/O、CUP资源</p>
</li>
</ul>
<h3 id="1344-善用bulk请求" class="mt-10 mb-2 leading-7 text-xl title_3b154">13.4.4 善用Bulk请求<a class="link_3b154 header-anchor" aria-hidden="true" href="#1344-善用bulk请求">#</a></h3>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">当需要执行批量写操作时，Bulk请求比一个索引请求只写单个文档效率高得多，但是Bulk请求的整体字节数最好避免超过几十兆字节，否则会给内存带来极大压力。</li>
<li class="[&amp;:not(:first-child)]:mt-2">Bulk线程池和队列的优化：建立索引的过程属于<strong class="font-semibold">计算密集型任务</strong>，应使用固定大小的线程池，来不及处理的任务放到队列中。<!-- -->
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">线程池数：CPU核数 + 1，这也是默认配置，可以避免过多的上下文切换</li>
<li class="[&amp;:not(:first-child)]:mt-2">队列数：队列数可以适当增加，但是一定要严格控制大小，过大的队列导致较高的GC压力，并可能导致FGC频繁发生</li>
<li class="[&amp;:not(:first-child)]:mt-2">要注意bulk线程池队列的reject情况，出现reject代表ES的bulk队列已满，客户端收到429错误(TOO_MANY_REQUESTS)。
不可忽略这个异常，否则写入系统的数据会少于预期。即使客户端正确处理了429错误，我们仍然应该尽量避免产生reject。</li>
</ul>
</li>
</ul>
<h3 id="1345-单节点磁盘间的任务均衡" class="mt-10 mb-2 leading-7 text-xl title_3b154">13.4.5 单节点磁盘间的任务均衡<a class="link_3b154 header-anchor" aria-hidden="true" href="#1345-单节点磁盘间的任务均衡">#</a></h3>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">首先在配置文件conf/Elasticsearch.yml中为path.data配置多个路径来使用多块磁盘，多磁盘带来的并行写的优势可以增加吞吐量</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">多磁盘写入可能会带来任务不均衡的问题，Elasticsearch在分配shard时，落到各磁盘上的shard可能并不均匀。
这种不均匀可能会导致某些磁盘繁忙，利用率在较长时间内持续达到100%，而某些磁盘可能使用率很低甚至为0，这种不均匀达到一定程度会对写入性能产生负面影响。</p>
<p class="my-4 leading-7">对于此种场景，有两种策略可以考虑：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">简单轮询：在系统初始阶段，简单轮询的效果是最均匀的。</li>
<li class="[&amp;:not(:first-child)]:mt-2">基于可用空间的动态加权轮询：以可用空间作为权重，在磁盘之间加权轮询</li>
</ul>
</li>
</ul>
<h3 id="1346-节点间的任务均衡" class="mt-10 mb-2 leading-7 text-xl title_3b154">13.4.6 节点间的任务均衡<a class="link_3b154 header-anchor" aria-hidden="true" href="#1346-节点间的任务均衡">#</a></h3>
<p class="my-4 leading-7">为了节点间的任务尽量均衡，数据写入客户端应该把bulk请求轮询发送到各个节点。此时可以 <strong class="font-semibold">考虑使用Java API或REST API的bulk接口发送数据</strong>。</p>
<p class="my-4 leading-7">当使用Java API或REST API的bulk接口发送数据时，客户端将会轮询发送到集群节点，节点列表取决于：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">使用Java API时，当设置client.transport.sniff为true（默认为false） 时，列表为所有数据节点，否则节点列表为构建客户端对象时传入的节点列表。</li>
<li class="[&amp;:not(:first-child)]:mt-2">使用REST API时，列表为构建对象时添加进去的节点。</li>
</ul>
<p class="my-4 leading-7">    在此 <strong class="font-semibold">建议使用REST API</strong> ,Java API会在未来的版本中废弃，REST API有良好的版本兼容性好。
理论上，Java API在序列化上有性能优势，但是只有在吞吐量非常大时才值得考虑序列化的开销带来的影响， 通常搜索并不是高吞吐量的业务。</p>
<p class="my-4 leading-7">观察 <code>bulk</code> 请求在不同节点上的处理情况：</p>
<div class="language-text"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-text" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>GET _cat/thread_pool</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<h3 id="1347-优化索引的建立" class="mt-10 mb-2 leading-7 text-xl title_3b154">13.4.7 优化索引的建立<a class="link_3b154 header-anchor" aria-hidden="true" href="#1347-优化索引的建立">#</a></h3>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">自动生成docID，避免es对自定义ID验证操作</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">调整字段Mapping</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">减少不必要的字段数量</li>
<li class="[&amp;:not(:first-child)]:mt-2">将不需要创建索引字段的index属性设置为not_analyzed，对字段不分词或者不建立索引，减少相应的操作，特别是binary类型</li>
<li class="[&amp;:not(:first-child)]:mt-2">减少字段内容长度</li>
<li class="[&amp;:not(:first-child)]:mt-2">使用不同的分析器（analyzer），不同分析器之间的运算复杂度也不相同</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">调整_source字段</p>
<p class="my-4 leading-7">_source字段用于存储doc原始数据，对于部分不需要存储的字段，可以使用<code>includes excludes</code>过滤，或者禁用_source，但是一般实际场景不会禁用。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">禁用_all</p>
<p class="my-4 leading-7">_all中包含所有字段分词后的关键词，作用是可以搜索的时候不指定特定的字段，从所有字段中检索。
从ES6.0之后，_all字段默认不启用。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">对不需要评分的字段禁用Norms</p>
<p class="my-4 leading-7">Norms字段用于在搜索时计算doc的评分，如果不需要评分，可以将其禁用：</p>
<div class="language-text"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-text" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>&quot;title&quot;: {
</span></span><span style="display:block;padding:0 1.25rem">      &quot;type&quot;: &quot;string&quot;,
</span><span style="display:block;padding:0 1.25rem">      &quot;norms&quot;: {
</span><span style="display:block;padding:0 1.25rem">          &quot;enabled&quot;: false
</span><span style="display:block;padding:0 1.25rem">      }
</span><span style="display:block;padding:0 1.25rem">  }</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul><!--/$--></div><div class="rspress-doc-footer"><footer class="mt-8"><div class="xs:flex pb-5 px-2 justify-end items-center"></div><div class="flex flex-col"></div><div class="flex flex-col sm:flex-row sm:justify-around gap-4 pt-6"><div class="prev_e7091 flex flex-col"><a class="link_03735 pager-link_9b9a7 cursor-pointer" target="" href="/tang/Elasticsearch/12_Elasticsearch分片控制与原理.html"><span class="desc_9b9a7">Previous Page</span><span class="title_9b9a7">12 Elasticsearch分片控制与原理</span></a></div><div class="next_e7091 flex flex-col"></div></div></footer></div></div></div><div class="aside-container_edeb4"><div><div class="flex flex-col"><div class="&lt;lg:hidden"><div id="aside-container" class="relative text-sm font-medium"><div class="leading-7 block text-sm font-semibold pl-3">ON THIS PAGE</div><nav class="mt-1"><ul class="relative"><li><a href="#131-硬件选择" title="13.1 硬件选择" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">13.1 硬件选择</span></a></li><li><a href="#132-分片策略" title="13.2 分片策略" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">13.2 分片策略</span></a></li><li><a href="#1321-合理设置分片数" title="13.2.1 合理设置分片数" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">13.2.1 合理设置分片数</span></a></li><li><a href="#1322-推迟分片分配" title="13.2.2 推迟分片分配" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">13.2.2 推迟分片分配</span></a></li><li><a href="#133-路由选择" title="13.3 路由选择" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">13.3 路由选择</span></a></li><li><a href="#134-写入速度优化" title="13.4 写入速度优化" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">13.4 写入速度优化</span></a></li><li><a href="#1341-增大translog-flush间隔" title="13.4.1 增大Translog flush间隔" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">13.4.1 增大Translog flush间隔</span></a></li><li><a href="#1342-增大index-refresh间隔" title="13.4.2 增大Index Refresh间隔" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">13.4.2 增大Index Refresh间隔</span></a></li><li><a href="#1343-段合并优化" title="13.4.3 段合并优化" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">13.4.3 段合并优化</span></a></li><li><a href="#1344-善用bulk请求" title="13.4.4 善用Bulk请求" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">13.4.4 善用Bulk请求</span></a></li><li><a href="#1345-单节点磁盘间的任务均衡" title="13.4.5 单节点磁盘间的任务均衡" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">13.4.5 单节点磁盘间的任务均衡</span></a></li><li><a href="#1346-节点间的任务均衡" title="13.4.6 节点间的任务均衡" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">13.4.6 节点间的任务均衡</span></a></li><li><a href="#1347-优化索引的建立" title="13.4.7 优化索引的建立" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">13.4.7 优化索引的建立</span></a></li></ul></nav></div></div></div></div></div></div></div></section></div></div>
  <div id="search-container"></div>
</body>

</html>
