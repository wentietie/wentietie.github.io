<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Rspress v1.38.0">
  <title data-rh="true">k8s部署prometheus + grafana - wenatie</title>
<script>{;const saved = localStorage.getItem('rspress-theme-appearance');const preferDark = window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = !saved || saved === 'auto' ? preferDark : saved === 'dark';document.documentElement.classList.toggle('dark', isDark);document.documentElement.style.colorScheme = isDark ? 'dark' : 'light';}</script><link rel="icon" href="/rspress-icon.png"><script defer src="/static/js/styles.1737145b.js"></script><script defer src="/static/js/lib-react.bfe73f81.js"></script><script defer src="/static/js/lib-router.aa18f61d.js"></script><script defer src="/static/js/index.df03ac1d.js"></script><link href="/static/css/styles.c26b7a64.css" rel="stylesheet"></head>

<body >
  <div id="root"><div><div class="navContainer_f6cde rspress-nav px-6 " style="position:sticky"><div class="container_f6cde flex justify-between items-center h-full"><div class="navBarTitle_f6cde"><a class="link_03735 flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60 cursor-pointer" target="" href="/index.html"><span>wenatie</span></a></div><div class="flex flex-1 justify-end items-center"><div class="rightNav_f6cde"><div class="flex sm:flex-1 items-center sm:pl-4 sm:pr-2"><div class="rspress-nav-search-button navSearchButton_6e282"><button><svg width="18" height="18" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9Z"></path></svg><p class="searchWord_6e282">Search Docs</p><div style="opacity:0"><span></span><span>K</span></div></button></div><div class="mobileNavSearchButton_6e282"><svg width="24" height="24" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9Z"></path></svg></div></div><div class="rspress-nav-menu menu h-14"><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">小唐学习笔记</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/gitlab/gitlab-error.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>gitlab</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/java2/00_前言.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>java</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/mysql/01_MySQL概述.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>mysql</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/docker/Docker.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>docker</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/k8s/学习资料/command.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>k8s</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/Elasticsearch/01_Elasticsearch概述.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>Elasticsearch</span></div></div></a></div></div><div><div class="rounded-2xl my-1 flex" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><span class="text-brand">Prometheus</span></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/Python/1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>Python</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/Vue/1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>Vue</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/server/CentOS7root账号免密登录.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>服务器环境安装</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/mservice/2.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>微服务</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/项目上线/xiaochengxu.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>项目上线</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/IoTPlatform/jetlinks项目初体验.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>物联网项目</span></div></div></a></div></div></div></div></div></div><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">前端基础</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/es6/es6-1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>ES6入门</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/youdontknowjs/part1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>你不知道的Javascript</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/design/index.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>设计模式</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/typescript/ts-basic.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>typescript</span></div></div></a></div></div></div></div></div></div><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">框架</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/formwork/vue/vueyuanli.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>vue2</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/formwork/vue3/reactive/part1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>vue3</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/formwork/harmony/part1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>鸿蒙</span></div></div></a></div></div></div></div></div></div><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">计算机基础</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/end/c/data-contruction/part1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>数据结构（严蔚敏）</span></div></div></a></div></div></div></div></div></div><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">随笔笔记</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/notes/JS/hwdj.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>JS相关</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/notes/CSS/css-selector.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>CSS相关</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/notes/browser/xmlhttprequest.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>浏览器相关</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/notes/node/node.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>node相关</span></div></div></a></div></div></div></div></div></div></div><div class="flex-center flex-row"><div class="mx-2"><div class="md:mr-2 rspress-nav-appearance"><div class="p-1 border border-solid border-gray-300 text-gray-400  cursor-pointer rounded-md hover:border-gray-600 hover:text-gray-600 dark:hover:border-gray-200 dark:hover:text-gray-200 transition-all duration-300 w-7 h-7"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="dark:hidden" width="18" height="18" fill="currentColor"><path d="M12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm0-10c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zM12 4c-.6 0-1-.4-1-1V1c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1zM12 24c-.6 0-1-.4-1-1v-2c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1zM5.6 6.6c-.3 0-.5-.1-.7-.3L3.5 4.9c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.1.2-.4.3-.7.3zM19.8 20.8c-.3 0-.5-.1-.7-.3l-1.4-1.4c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.2.2-.5.3-.7.3zM3 13H1c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1zM23 13h-2c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1zM4.2 20.8c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.4.3-.7.3zM18.4 6.6c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.5.3-.7.3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="hidden dark:block" width="18" height="18" fill="currentColor"><path d="M12.1 22h-.9c-5.5-.5-9.5-5.4-9-10.9.4-4.8 4.2-8.6 9-9 .4 0 .8.2 1 .5.2.3.2.8-.1 1.1-2 2.7-1.4 6.4 1.3 8.4 2.1 1.6 5 1.6 7.1 0 .3-.2.7-.3 1.1-.1.3.2.5.6.5 1-.2 2.7-1.5 5.1-3.6 6.8-1.9 1.4-4.1 2.2-6.4 2.2zM9.3 4.4c-2.9 1-5 3.6-5.2 6.8-.4 4.4 2.8 8.3 7.2 8.7 2.1.2 4.2-.4 5.8-1.8 1.1-.9 1.9-2.1 2.4-3.4-2.5.9-5.3.5-7.5-1.1-2.8-2.2-3.9-5.9-2.7-9.2z"></path></svg></div></div></div></div></div><div class="mobileNavMenu_f6cde"><div class="navScreen_457e8 " id="navScreen"><div class="container_457e8"><div class="navMenu_457e8"><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">小唐学习笔记</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/gitlab/gitlab-error.html"><div><div class="flex justify-center"><span>gitlab</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/java2/00_前言.html"><div><div class="flex justify-center"><span>java</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/mysql/01_MySQL概述.html"><div><div class="flex justify-center"><span>mysql</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/docker/Docker.html"><div><div class="flex justify-center"><span>docker</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/k8s/学习资料/command.html"><div><div class="flex justify-center"><span>k8s</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/Elasticsearch/01_Elasticsearch概述.html"><div><div class="flex justify-center"><span>Elasticsearch</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/Prometheus/1.html"><div><div class="flex justify-center"><span>Prometheus</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/Python/1.html"><div><div class="flex justify-center"><span>Python</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/Vue/1.html"><div><div class="flex justify-center"><span>Vue</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/server/CentOS7root账号免密登录.html"><div><div class="flex justify-center"><span>服务器环境安装</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/mservice/2.html"><div><div class="flex justify-center"><span>微服务</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/项目上线/xiaochengxu.html"><div><div class="flex justify-center"><span>项目上线</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/IoTPlatform/jetlinks项目初体验.html"><div><div class="flex justify-center"><span>物联网项目</span></div></div></a></div></div></div></div></div></div></div><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">前端基础</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/es6/es6-1.html"><div><div class="flex justify-center"><span>ES6入门</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/youdontknowjs/part1.html"><div><div class="flex justify-center"><span>你不知道的Javascript</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/design/index.html"><div><div class="flex justify-center"><span>设计模式</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/typescript/ts-basic.html"><div><div class="flex justify-center"><span>typescript</span></div></div></a></div></div></div></div></div></div></div><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">框架</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/formwork/vue/vueyuanli.html"><div><div class="flex justify-center"><span>vue2</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/formwork/vue3/reactive/part1.html"><div><div class="flex justify-center"><span>vue3</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/formwork/harmony/part1.html"><div><div class="flex justify-center"><span>鸿蒙</span></div></div></a></div></div></div></div></div></div></div><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">计算机基础</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/end/c/data-contruction/part1.html"><div><div class="flex justify-center"><span>数据结构（严蔚敏）</span></div></div></a></div></div></div></div></div></div></div><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">随笔笔记</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/notes/JS/hwdj.html"><div><div class="flex justify-center"><span>JS相关</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/notes/CSS/css-selector.html"><div><div class="flex justify-center"><span>CSS相关</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/notes/browser/xmlhttprequest.html"><div><div class="flex justify-center"><span>浏览器相关</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/notes/node/node.html"><div><div class="flex justify-center"><span>node相关</span></div></div></a></div></div></div></div></div></div></div></div><div class="flex-center flex-col gap-2"><div class="mt-2 navAppearance_457e8 flex justify-center"></div></div></div></div><button aria-label="mobile hamburger" class=" navHamburger_e7b06 text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="currentColor"><circle cx="8" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="24" cy="16" r="2" fill="currentColor"></circle></svg></button></div></div></div></div><section><div class="docLayout_edeb4 pt-0"><div class="rspress-sidebar-menu"><button class="flex-center mr-auto"><div class="text-md mr-2"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M4 6h24v2H4zm0 18h24v2H4zm0-12h24v2H4zm0 6h24v2H4z"></path></svg></div><span class="text-sm">Menu</span></button><button class="flex-center ml-auto"><span class="text-sm">ON THIS PAGE</span><div class="text-md mr-2" style="transform:rotate(0deg);transition:transform 0.2s ease-out;margin-top:2px"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></button><div class="rspress-local-toc-container "><ul><li><a href="#namespace" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">namespace</span></a></li><li><a href="#node-exporter" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">node-exporter</span></a></li><li><a href="#k8s组件" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">k8s组件</span></a></li><li><a href="#kube-state-metrics" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">kube-state-metrics</span></a></li><li><a href="#blackbox-exporter" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">blackbox-exporter</span></a></li><li><a href="#dingtalk" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">dingtalk</span></a></li><li><a href="#alertmanager" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">alertmanager</span></a></li><li><a href="#prometheus" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">prometheus</span></a></li><li><a href="#grafana" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">grafana</span></a></li><li><a href="#部署" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">部署</span></a></li><li><a href="#grafana配置kubernetes数据源" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">grafana配置kubernetes数据源</span></a></li><li><a href="#告警测试" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">告警测试</span></a></li></ul></div></div><aside class="sidebar_71eca rspress-sidebar "><div class="navTitleMask_71eca"><div class="navBarTitle_f6cde"><a class="link_03735 flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60 cursor-pointer" target="" href="/index.html"><span>wenatie</span></a></div></div><div class="rspress-scrollbar sidebarContent_71eca"><nav class="pb-2"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_71eca" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">Prometheus</span></h2><div class="collapseContainer_71eca p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(90deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:1;margin-left:12px"><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Prometheus/1.html"><div class="menuItemActive_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>k8s部署prometheus + grafana</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/Prometheus/2.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>3.其他参考文档</span></div></a></div></div></div></section></nav></div></aside><div class="content_edeb4 rspress-doc-container flex flex-shrink-0 mx-auto"><div class="w-full flex-1"><div><div class="rspress-doc"><!--$--><h1 id="k8s部署prometheus--grafana" class="text-3xl mb-10 leading-10 tracking-tight title_3b154">k8s部署prometheus + grafana<a class="link_3b154 header-anchor" aria-hidden="true" href="#k8s部署prometheus--grafana">#</a></h1>
<p class="my-4 leading-7">k8s以Deployment方式部署prometheus + grafana：</p>
<hr class="my-12 border-t border-solid border-divider-light"/>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">主机说明：</li>
</ul>
<table class="block border-collapse text-base my-5 overflow-x-auto leading-7 border-gray-light-3 dark:border-divider">
<thead>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<th align="left" class="border border-solid px-4 py-2 text-text-1 text-base font-semibold border-gray-light-3 dark:border-divider">系统</th>
<th align="left" class="border border-solid px-4 py-2 text-text-1 text-base font-semibold border-gray-light-3 dark:border-divider">ip</th>
<th align="left" class="border border-solid px-4 py-2 text-text-1 text-base font-semibold border-gray-light-3 dark:border-divider">角色</th>
<th align="left" class="border border-solid px-4 py-2 text-text-1 text-base font-semibold border-gray-light-3 dark:border-divider">cpu</th>
<th align="left" class="border border-solid px-4 py-2 text-text-1 text-base font-semibold border-gray-light-3 dark:border-divider">内存</th>
<th align="left" class="border border-solid px-4 py-2 text-text-1 text-base font-semibold border-gray-light-3 dark:border-divider">hostname</th>
</tr>
</thead>
<tbody>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">CentOS 7.8</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">192.168.30.128</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">master</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">&gt;=2</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">&gt;=2G</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">master1</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">CentOS 7.8</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">192.168.30.129</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">master</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">&gt;=2</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">&gt;=2G</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">master2</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">CentOS 7.8</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">192.168.30.130</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">node</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">&gt;=2</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">&gt;=2G</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">node1</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">CentOS 7.8</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">192.168.30.131</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">node</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">&gt;=2</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">&gt;=2G</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">node2</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">CentOS 7.8</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">192.168.30.132</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">node</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">&gt;=2</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">&gt;=2G</td>
<td align="left" class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">node3</td>
</tr>
</tbody>
</table>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>[root@master ~]# kubectl get node
</span></span><span style="display:block;padding:0 1.25rem">NAME     STATUS   ROLES    AGE    VERSION
</span><span style="display:block;padding:0 1.25rem">master   Ready    master   141d   v1.19.2
</span><span style="display:block;padding:0 1.25rem">node1    Ready    &lt;none&gt;   141d   v1.19.2</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">采集方案：</li>
</ul>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>1.通过prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter采集主机的性能指标数据，并通过暴露的 /metrics 接口用prometheus抓取 
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>2.通过kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>apiserver、kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>controller</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>manager、kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>scheduler、etcd、kubelet、kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>proxy自身暴露的 /metrics 获取节点上与k8s集群相关的一些指标数据 
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>3.通过cadvisor采集容器、Pod相关的性能指标数据，并通过暴露的 /metrics 接口用prometheus抓取 通过blackbox</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter采集应用的网络性能(http、tcp、icmp等)数据，并通过暴露的 /metrics 接口用prometheus抓取 
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>4.通过kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics采集k8s资源对象的状态指标数据，并通过暴露的 /metrics 接口用prometheus抓取 
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">5.应用自己采集容器中进程主动暴露的指标数据（暴露指标的功能由应用自己实现，并添加约定的annotation，prometheus负责根据annotation实现抓取）</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">抓取介绍：</li>
</ul>
<p class="my-4 leading-7">Kubernetes可以约定好带哪些annotation前缀的服务是自主暴露监控指标的服务。应用添加约定的这些annotations，Prometheus可以根据annotation实现抓取。例如：</p>
<div class="language-json"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-json" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>prometheus.io/scrape</span><span class="token operator">:</span><span> &#x27;</span><span class="token boolean">true</span><span>&#x27;    # 获知对应的endpoint是需要被scrape的 
</span></span><span style="display:block;padding:0 1.25rem"><span>prometheus.io/app-metrics</span><span class="token operator">:</span><span> &#x27;</span><span class="token boolean">true</span><span>&#x27;   # 获知对应的endpoint中有应用进程暴露的metrics 
</span></span><span style="display:block;padding:0 1.25rem"><span>prometheus.io/app-metrics-port</span><span class="token operator">:</span><span> &#x27;</span><span class="token number">8080</span><span>&#x27;  # 获知进程暴露的metrics的端口 
</span></span><span style="display:block;padding:0 1.25rem"><span>prometheus.io/app-metrics-path</span><span class="token operator">:</span><span> &#x27;/metrics&#x27;  # 获知进程暴露的metrics的具体路径</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">应用可以在service中指定约定的annotation，实现Prometheus对该应用的网络服务进行探测：</p>
<div class="language-json"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-json" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>http探测</span><span class="token operator">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>	prometheus.io/scrape</span><span class="token operator">:</span><span> &#x27;</span><span class="token boolean">true</span><span>&#x27;    
</span></span><span style="display:block;padding:0 1.25rem"><span>	prometheus.io/http-probe</span><span class="token operator">:</span><span> &#x27;</span><span class="token boolean">true</span><span>&#x27;    
</span></span><span style="display:block;padding:0 1.25rem"><span>	prometheus.io/http-probe-port</span><span class="token operator">:</span><span> &#x27;</span><span class="token number">8080</span><span>&#x27;    
</span></span><span style="display:block;padding:0 1.25rem"><span>	prometheus.io/http-probe-path</span><span class="token operator">:</span><span> &#x27;/healthz&#x27; 
</span></span><span style="display:block;padding:0 1.25rem"><span>tcp探测</span><span class="token operator">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>	prometheus.io/scrape</span><span class="token operator">:</span><span> &#x27;</span><span class="token boolean">true</span><span>&#x27;    
</span></span><span style="display:block;padding:0 1.25rem"><span>	prometheus.io/tcp-probe</span><span class="token operator">:</span><span> &#x27;</span><span class="token boolean">true</span><span>&#x27;    
</span></span><span style="display:block;padding:0 1.25rem"><span>	prometheus.io/tcp-probe-port</span><span class="token operator">:</span><span> &#x27;</span><span class="token number">80</span><span>&#x27;</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">Prometheus根据这些annotations可以获知相应service是需要被探测的，探测的网络协议可以是http、tcp或其他，以及具体的探测端口。http探测需要知道探测的具体url。</p>
<hr class="my-12 border-t border-solid border-divider-light"/>
<h3 id="namespace" class="mt-10 mb-2 leading-7 text-xl title_3b154">namespace<a class="link_3b154 header-anchor" aria-hidden="true" href="#namespace">#</a></h3>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>mkdir -p /home/k8s/monitoring/{node-exporter,k8s,kube-state-metrics,blackbox-exporter,dingtalk,alertmanager,prometheus,grafana} 
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">cd /home/k8s/monitoring 
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">vim namespace.yaml</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Namespace
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>  
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<hr class="my-12 border-t border-solid border-divider-light"/>
<h3 id="node-exporter" class="mt-10 mb-2 leading-7 text-xl title_3b154">node-exporter<a class="link_3b154 header-anchor" aria-hidden="true" href="#node-exporter">#</a></h3>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim node-exporter/node-exporter.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Service
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/scrape</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;true&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9100</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> TCP
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">targetPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9100</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">type</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodePort
</span></span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">---</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> apps/v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> DaemonSet
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">matchLabels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">template</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">containers</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">image</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prom/node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>latest
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">imagePullPolicy</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> IfNotPresent
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">containerPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9100</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">hostPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9100</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">hostNetwork</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token boolean" style="color:#EBCB8B;font-weight:bold">true</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">hostPID</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token boolean" style="color:#EBCB8B;font-weight:bold">true</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">tolerations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">key</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>role.kubernetes.io/master
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">operator</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Exists
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">effect</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NoSchedule</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<hr class="my-12 border-t border-solid border-divider-light"/>
<h3 id="k8s组件" class="mt-10 mb-2 leading-7 text-xl title_3b154">k8s组件<a class="link_3b154 header-anchor" aria-hidden="true" href="#k8s组件">#</a></h3>
<p class="my-4 leading-7">==controller-manager：==</p>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim k8s/kube-controller-manager-prometheus-discovery.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Service
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>controller</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>manager</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>discovery
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>system
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">component</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>controller</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>manager
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/scrape</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;true&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">component</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>controller</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>manager
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> http</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">10252</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">targetPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">10252</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> TCP
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">type</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodePort</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">==kube-scheduler：==</p>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim k8s/kube-scheduler-prometheus-discovery.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Service
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>scheduler</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>discovery
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>system
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">component</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>scheduler
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/scrape</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;true&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">component</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>scheduler
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> http</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">10251</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> TCP
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">targetPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">10251</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">type</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodePort</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">==kube-proxy：==</p>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim k8s/kube-proxy-prometheus-discovery.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Service
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>proxy</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>discovery
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>system
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">k8s-app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>proxy
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/scrape</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;true&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">k8s-app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>proxy
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> http</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">10249</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> TCP
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">targetPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">10249</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">type</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodePort</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<hr class="my-12 border-t border-solid border-divider-light"/>
<h3 id="kube-state-metrics" class="mt-10 mb-2 leading-7 text-xl title_3b154">kube-state-metrics<a class="link_3b154 header-anchor" aria-hidden="true" href="#kube-state-metrics">#</a></h3>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim kube-state-metrics/rbac.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ServiceAccount
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">---</span><span> 
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> rbac.authorization.k8s.io/v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ClusterRole
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">rules</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroups</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> configmaps
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> secrets
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> nodes
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> pods
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> services
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> resourcequotas
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> replicationcontrollers
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> limitranges
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> persistentvolumeclaims
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> persistentvolumes
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> namespaces
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> endpoints
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">verbs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> list
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> watch
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroups</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> extensions
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> daemonsets
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> deployments
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> replicasets
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> ingresses
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">verbs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> list
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> watch
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroups</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> apps
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> statefulsets
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> daemonsets
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> deployments
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> replicasets
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">verbs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> list
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> watch
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroups</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> batch
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> cronjobs
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> jobs
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">verbs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> list
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> watch
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroups</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> autoscaling
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> horizontalpodautoscalers
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">verbs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> list
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> watch
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroups</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> authentication.k8s.io
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> tokenreviews
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">verbs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> create
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroups</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> authorization.k8s.io
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> subjectaccessreviews
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">verbs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> create
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroups</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> policy
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> poddisruptionbudgets
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">verbs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> list
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> watch
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroups</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> certificates.k8s.io
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> certificatesigningrequests
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">verbs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> list
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> watch
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroups</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> storage.k8s.io
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> storageclasses
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> volumeattachments
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">verbs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> list
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> watch
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroups</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> admissionregistration.k8s.io
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> mutatingwebhookconfigurations
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> validatingwebhookconfigurations
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">verbs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> list
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> watch
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroups</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> networking.k8s.io
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> networkpolicies
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">verbs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> list
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> watch
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroups</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> coordination.k8s.io
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> leases
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">verbs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> list
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> watch
</span></span><span style="display:block;padding:0 1.25rem">  
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">---</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> rbac.authorization.k8s.io/v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ClusterRoleBinding
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">roleRef</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">apiGroup</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> rbac.authorization.k8s.io
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ClusterRole
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">subjects</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ServiceAccount
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim kube-state-metrics/kube-state-metrics.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Service
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/scrape</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;true&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/http-probe</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;true&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/http-probe-path</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;/healthz&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/http-probe-port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;8080&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">8080</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> TCP
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">targetPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">8080</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">type</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodePort
</span></span><span style="display:block;padding:0 1.25rem">   
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">---</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> apps/v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Deployment
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">replicas</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">1</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">matchLabels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">template</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">serviceAccountName</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">containers</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">image</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> quay.mirrors.ustc.edu.cn/coreos/kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>v1.8.0                </span><span class="token" style="color:var(--code-token-comment)"># kube-state-metrics:v1.9.7 适用于Kubernetes 1.16以上版本</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">imagePullPolicy</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> IfNotPresent
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">containerPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">8080</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">nodeSelector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">node-role.kubernetes.io/master</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">kubernetes.io/hostname</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;master&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">tolerations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">key</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>role.kubernetes.io/master
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">operator</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Exists
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">effect</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NoSchedule</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<hr class="my-12 border-t border-solid border-divider-light"/>
<h3 id="blackbox-exporter" class="mt-10 mb-2 leading-7 text-xl title_3b154">blackbox-exporter<a class="link_3b154 header-anchor" aria-hidden="true" href="#blackbox-exporter">#</a></h3>
<p class="my-4 leading-7">blackbox-exporter是一个黑盒探测工具，可以对服务的http、tcp、icmp等进行网络探测。</p>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim blackbox-exporter/config.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ConfigMap
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> blackbox</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> blackbox</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">data</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">blackbox.yml</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">|</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">modules</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">http_2xx</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">prober</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> http
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">timeout</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 10s
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">http</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">valid_http_versions</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-string)">&quot;HTTP/1.1&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;HTTP/2&quot;</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">valid_status_codes</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">method</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> GET
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">preferred_ip_protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;ip4&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">http_post_2xx</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">prober</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> http
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">timeout</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 10s
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">http</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">valid_http_versions</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-string)">&quot;HTTP/1.1&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;HTTP/2&quot;</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">method</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> POST
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">preferred_ip_protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;ip4&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">tcp_connect</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">prober</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> tcp
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">timeout</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 10s
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">icmp</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">prober</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> icmp
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">timeout</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 10s
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">icmp</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">preferred_ip_protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;ip4&quot;</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim blackbox-exporter/blackbox-exporter.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Service
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> blackbox</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> blackbox</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/scrape</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;true&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> blackbox</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> blackbox
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9115</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> TCP
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">targetPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9115</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">nodePort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">30115</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">type</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodePort
</span></span><span style="display:block;padding:0 1.25rem">  
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">---</span><span>  
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> apps/v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Deployment
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> blackbox</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">replicas</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">1</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">matchLabels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> blackbox</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">template</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> blackbox</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">containers</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> blackbox</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">image</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prom/blackbox</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>latest
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">imagePullPolicy</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> IfNotPresent
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">containerPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9115</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">readinessProbe</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">tcpSocket</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9115</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">initialDelaySeconds</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">10</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">timeoutSeconds</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">5</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">requests</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">memory</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 50Mi
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">cpu</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 100m
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">limits</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">memory</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 60Mi
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">cpu</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 200m
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">volumeMounts</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> config
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">mountPath</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /etc/blackbox_exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">args</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;--config.file=/etc/blackbox_exporter/blackbox.yml&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;--web.listen-address=:9115&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">volumes</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> config
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">configMap</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> blackbox</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>exporter
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">nodeSelector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">node-role.kubernetes.io/master</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">tolerations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">key</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>role.kubernetes.io/master
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">operator</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Exists
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">effect</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NoSchedule</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<blockquote class="border-l-2 border-solid border-divider pl-4 my-6 transition-colors duration-500 blockquote_3b154">
<p class="my-4 leading-7">注意：
blackbox-exporter的配置文件为 <code>/etc/blackbox_exporter/blackbox.yml</code>， 运行时可以动态重载配置文件，当重新加载配置文件失败时，不影响运行中的配置。</p>
<p class="my-4 leading-7">重载方式：<code>curl -XPOST http://ip:9115/-/reload</code></p>
</blockquote>
<hr class="my-12 border-t border-solid border-divider-light"/>
<h3 id="dingtalk" class="mt-10 mb-2 leading-7 text-xl title_3b154">dingtalk<a class="link_3b154 header-anchor" aria-hidden="true" href="#dingtalk">#</a></h3>
<p class="my-4 leading-7">未验证！！</p>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim dingtalk/config.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ConfigMap
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> dingtalk</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>config
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">data</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">config.yml</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">|</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">targets</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">webhook</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">url</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> https</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>//oapi.dingtalk.com/robot/send</span><span class="token" style="color:var(--code-token-punctuation)">?</span><span>access_token=xxxxxxxxxxxx             </span><span class="token" style="color:var(--code-token-comment)">#修改为钉钉机器人的webhook</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">mention</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">all</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token boolean" style="color:#EBCB8B;font-weight:bold">true</span><span>             </span><span class="token" style="color:var(--code-token-comment)">#@所有</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim dingtalk/dingtalk.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Service
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> dingtalk
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> dingtalk
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/scrape</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;false&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> dingtalk
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> dingtalk
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">8060</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> TCP
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">targetPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">8060</span><span>
</span></span><span style="display:block;padding:0 1.25rem">  
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">---</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> apps/v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Deployment
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> dingtalk
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">replicas</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">1</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">matchLabels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> dingtalk
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">template</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> dingtalk
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> dingtalk
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">containers</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> dingtalk
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">image</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> timonwong/prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>webhook</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>dingtalk</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>latest
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">imagePullPolicy</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> IfNotPresent
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">containerPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">8060</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">volumeMounts</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> config
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">mountPath</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /etc/prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>webhook</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>dingtalk
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">volumes</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> config
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">configMap</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> dingtalk</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>config</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<h3 id="alertmanager" class="mt-10 mb-2 leading-7 text-xl title_3b154">alertmanager<a class="link_3b154 header-anchor" aria-hidden="true" href="#alertmanager">#</a></h3>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim alertmanager/templates.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ConfigMap
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>templates
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">data</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">default.tmpl</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">|</span><span class="token scalar" style="color:var(--code-token-string)">
</span></span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;__alertmanager&quot; }}AlertManager{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;__alertmanagerURL&quot; }}{{ .ExternalURL }}/#/alerts?receiver={{ .Receiver }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;__subject&quot; }}[{{ .Status | toUpper }}{{ if eq .Status &quot;firing&quot; }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join &quot; &quot; }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join &quot; &quot; }}{{ end }}){{ end }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;__description&quot; }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;__text_alert_list&quot; }}{{ range . }}Labels:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ end }}Annotations:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ end }}Source: {{ .GeneratorURL }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ end }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;slack.default.title&quot; }}{{ template &quot;__subject&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;slack.default.username&quot; }}{{ template &quot;__alertmanager&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;slack.default.fallback&quot; }}{{ template &quot;slack.default.title&quot; . }} | {{ template &quot;slack.default.titlelink&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;slack.default.pretext&quot; }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;slack.default.titlelink&quot; }}{{ template &quot;__alertmanagerURL&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;slack.default.iconemoji&quot; }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;slack.default.iconurl&quot; }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;slack.default.text&quot; }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;hipchat.default.from&quot; }}{{ template &quot;__alertmanager&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;hipchat.default.message&quot; }}{{ template &quot;__subject&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;pagerduty.default.description&quot; }}{{ template &quot;__subject&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;pagerduty.default.client&quot; }}{{ template &quot;__alertmanager&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;pagerduty.default.clientURL&quot; }}{{ template &quot;__alertmanagerURL&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;pagerduty.default.instances&quot; }}{{ template &quot;__text_alert_list&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;opsgenie.default.message&quot; }}{{ template &quot;__subject&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;opsgenie.default.description&quot; }}{{ .CommonAnnotations.SortedPairs.Values | join &quot; &quot; }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ if gt (len .Alerts.Firing) 0 -}}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    Alerts Firing:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ template &quot;__text_alert_list&quot; .Alerts.Firing }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{- end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ if gt (len .Alerts.Resolved) 0 -}}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    Alerts Resolved:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ template &quot;__text_alert_list&quot; .Alerts.Resolved }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{- end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{- end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;opsgenie.default.source&quot; }}{{ template &quot;__alertmanagerURL&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;victorops.default.message&quot; }}{{ template &quot;__subject&quot; . }} | {{ template &quot;__alertmanagerURL&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;victorops.default.from&quot; }}{{ template &quot;__alertmanager&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;email.default.subject&quot; }}{{ template &quot;__subject&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;email.default.html&quot; }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    &lt;!--
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    Style and HTML derived from https://github.com/mailgun/transactional-email-templates
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    The MIT License (MIT)
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    Copyright (c) 2014 Mailgun
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    Permission is hereby granted, free of charge, to any person obtaining a copy
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    of this software and associated documentation files (the &quot;Software&quot;), to deal
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    in the Software without restriction, including without limitation the rights
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    copies of the Software, and to permit persons to whom the Software is
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    furnished to do so, subject to the following conditions:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    The above copyright notice and this permission notice shall be included in all
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    copies or substantial portions of the Software.
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    SOFTWARE.
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    --&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns=&quot;http://www.w3.org/1999/xhtml&quot; style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    &lt;head style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot; style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    &lt;title style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;{{ template &quot;__subject&quot; . }}&lt;/title&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    &lt;/head&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    &lt;body itemscope=&quot;&quot; itemtype=&quot;http://schema.org/EmailMessage&quot; style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; -webkit-font-smoothing: antialiased; -webkit-text-size-adjust: none; height: 100%; line-height: 1.6em; width: 100% !important; background-color: #f6f6f6; margin: 0; padding: 0;&quot; bgcolor=&quot;#f6f6f6&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    &lt;table style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; width: 100%; background-color: #f6f6f6; margin: 0;&quot; bgcolor=&quot;#f6f6f6&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">      &lt;tr style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        &lt;td style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0;&quot; valign=&quot;top&quot;&gt;&lt;/td&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        &lt;td width=&quot;600&quot; style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; display: block !important; max-width: 600px !important; clear: both !important; width: 100% !important; margin: 0 auto; padding: 0;&quot; valign=&quot;top&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          &lt;div style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; max-width: 600px; display: block; margin: 0 auto; padding: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">            &lt;table width=&quot;100%&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; border-radius: 3px; background-color: #fff; margin: 0; border: 1px solid #e9e9e9;&quot; bgcolor=&quot;#fff&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">              &lt;tr style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                &lt;td style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 16px; vertical-align: top; color: #fff; font-weight: 500; text-align: center; border-radius: 3px 3px 0 0; background-color: #E6522C; margin: 0; padding: 20px;&quot; align=&quot;center&quot; bgcolor=&quot;#E6522C&quot; valign=&quot;top&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                  {{ .Alerts | len }} alert{{ if gt (len .Alerts) 1 }}s{{ end }} for {{ range .GroupLabels.SortedPairs }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    {{ .Name }}={{ .Value }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                  {{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                &lt;/td&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">              &lt;/tr&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">              &lt;tr style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                &lt;td style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 10px;&quot; valign=&quot;top&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                  &lt;table width=&quot;100%&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    &lt;tr style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      &lt;td style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;&quot; valign=&quot;top&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        &lt;a href=&quot;{{ template &quot;__alertmanagerURL&quot; . }}&quot; style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; color: #FFF; text-decoration: none; line-height: 2em; font-weight: bold; text-align: center; cursor: pointer; display: inline-block; border-radius: 5px; text-transform: capitalize; background-color: #348eda; margin: 0; border-color: #348eda; border-style: solid; border-width: 10px 20px;&quot;&gt;View in {{ template &quot;__alertmanager&quot; . }}&lt;/a&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      &lt;/td&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    &lt;/tr&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    {{ if gt (len .Alerts.Firing) 0 }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    &lt;tr style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      &lt;td style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;&quot; valign=&quot;top&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        &lt;strong style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;[{{ .Alerts.Firing | len }}] Firing&lt;/strong&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      &lt;/td&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    &lt;/tr&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    {{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    {{ range .Alerts.Firing }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    &lt;tr style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      &lt;td style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;&quot; valign=&quot;top&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        &lt;strong style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;Labels&lt;/strong&gt;&lt;br style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        {{ range .Labels.SortedPairs }}{{ .Name }} = {{ .Value }}&lt;br style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        {{ if gt (len .Annotations) 0 }}&lt;strong style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;Annotations&lt;/strong&gt;&lt;br style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        {{ range .Annotations.SortedPairs }}{{ .Name }} = {{ .Value }}&lt;br style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        &lt;a href=&quot;{{ .GeneratorURL }}&quot; style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; color: #348eda; text-decoration: underline; margin: 0;&quot;&gt;Source&lt;/a&gt;&lt;br style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      &lt;/td&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    &lt;/tr&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    {{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    {{ if gt (len .Alerts.Resolved) 0 }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      {{ if gt (len .Alerts.Firing) 0 }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    &lt;tr style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      &lt;td style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;&quot; valign=&quot;top&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        &lt;br style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        &lt;hr style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        &lt;br style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      &lt;/td&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    &lt;/tr&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      {{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    &lt;tr style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      &lt;td style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;&quot; valign=&quot;top&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        &lt;strong style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;[{{ .Alerts.Resolved | len }}] Resolved&lt;/strong&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      &lt;/td&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    &lt;/tr&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    {{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    {{ range .Alerts.Resolved }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    &lt;tr style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      &lt;td style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0; padding: 0 0 20px;&quot; valign=&quot;top&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        &lt;strong style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;Labels&lt;/strong&gt;&lt;br style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        {{ range .Labels.SortedPairs }}{{ .Name }} = {{ .Value }}&lt;br style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        {{ if gt (len .Annotations) 0 }}&lt;strong style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;Annotations&lt;/strong&gt;&lt;br style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        {{ range .Annotations.SortedPairs }}{{ .Name }} = {{ .Value }}&lt;br style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                        &lt;a href=&quot;{{ .GeneratorURL }}&quot; style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; color: #348eda; text-decoration: underline; margin: 0;&quot;&gt;Source&lt;/a&gt;&lt;br style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot; /&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                      &lt;/td&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    &lt;/tr&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                    {{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                  &lt;/table&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                &lt;/td&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">              &lt;/tr&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">            &lt;/table&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">            &lt;div style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; width: 100%; clear: both; color: #999; margin: 0; padding: 20px;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">              &lt;table width=&quot;100%&quot; style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                &lt;tr style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; margin: 0;&quot;&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                  &lt;td style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 12px; vertical-align: top; text-align: center; color: #999; margin: 0; padding: 0 0 20px;&quot; align=&quot;center&quot; valign=&quot;top&quot;&gt;&lt;a href=&quot;{{ .ExternalURL }}&quot; style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 12px; color: #999; text-decoration: underline; margin: 0;&quot;&gt;Sent by {{ template &quot;__alertmanager&quot; . }}&lt;/a&gt;&lt;/td&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">                &lt;/tr&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">              &lt;/table&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">            &lt;/div&gt;&lt;/div&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        &lt;/td&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        &lt;td style=&quot;font-family: &#x27;Helvetica Neue&#x27;, Helvetica, Arial, sans-serif; box-sizing: border-box; font-size: 14px; vertical-align: top; margin: 0;&quot; valign=&quot;top&quot;&gt;&lt;/td&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">      &lt;/tr&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    &lt;/table&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    &lt;/body&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    &lt;/html&gt;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;pushover.default.title&quot; }}{{ template &quot;__subject&quot; . }}{{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;pushover.default.message&quot; }}{{ .CommonAnnotations.SortedPairs.Values | join &quot; &quot; }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ if gt (len .Alerts.Firing) 0 }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    Alerts Firing:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ template &quot;__text_alert_list&quot; .Alerts.Firing }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ if gt (len .Alerts.Resolved) 0 }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    Alerts Resolved:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ template &quot;__text_alert_list&quot; .Alerts.Resolved }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ end }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ end }}
</span><span style="display:block;padding:0 1.25rem"><span class="token scalar" style="color:var(--code-token-string)">    {{ define &quot;pushover.default.url&quot; }}{{ template &quot;__alertmanagerURL&quot; . }}{{ end }}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">slack.tmpl</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">|</span><span class="token scalar" style="color:var(--code-token-string)">
</span></span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ define &quot;slack.devops.text&quot; }}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{range .Alerts}}{{.Annotations.DESCRIPTION}}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{end}}
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    {{ end }}</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim alertmanager/config.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ConfigMap
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>config
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">data</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">config.yml</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">|</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">global</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">resolve_timeout</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 5m
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">smtp_smarthost</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;smtp.163.com:465&#x27;</span><span>                </span><span class="token" style="color:var(--code-token-comment)">#邮箱smtp服务器代理，启用SSL发信, 端口一般是465</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">smtp_from</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;alert@163.com&#x27;</span><span>                </span><span class="token" style="color:var(--code-token-comment)">#发送邮箱名称</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">smtp_auth_username</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;alert@163.com&#x27;</span><span>               </span><span class="token" style="color:var(--code-token-comment)">#邮箱名称</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">smtp_auth_password</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;password&#x27;</span><span>                </span><span class="token" style="color:var(--code-token-comment)">#邮箱密码或授权码</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">smtp_require_tls</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token boolean" style="color:#EBCB8B;font-weight:bold">false</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">templates</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;/etc/templates/*.tmpl&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">route</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">receiver</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;default&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">group_wait</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 10s
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">group_interval</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 1m
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">repeat_interval</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 1h
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">group_by</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-string)">&#x27;alertname&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;instance&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;cluster&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;service&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">routes</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">receiver</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;default&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">match</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">severity</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;warning&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">receiver</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;dingtalk&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">match</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">severity</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;critical&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">inhibit_rules</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_match</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">severity</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;critical&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">target_match</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">severity</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;warning&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">equal</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-string)">&#x27;alertname&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;instance&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;cluster&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;service&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">receivers</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;default&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">email_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">to</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;receiver@163.com&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">send_resolved</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token boolean" style="color:#EBCB8B;font-weight:bold">true</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;dingtalk&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">webhook_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">url</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;http://dingtalk:8060/dingtalk/webhook/send&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">send_resolved</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token boolean" style="color:#EBCB8B;font-weight:bold">true</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim alertmanager/alertmanager.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Service
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/scrape</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;true&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9093</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> TCP
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">targetPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9093</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">type</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodePort 
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">---</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> apps/v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Deployment
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">replicas</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">1</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">matchLabels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">template</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">containers</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">image</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prom/alertmanager</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>latest
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">imagePullPolicy</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> IfNotPresent
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">containerPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9093</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">env</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> POD_IP
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">valueFrom</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">fieldRef</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>              </span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span>              </span><span class="token atrule" style="color:var(--code-token-variable)">fieldPath</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> status.podIP
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">args</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;--config.file=/etc/alertmanager/config.yml&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;--storage.path=/alertmanager&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;--cluster.advertise-address=$(POD_IP):6783&quot;</span><span>                </span><span class="token" style="color:var(--code-token-comment)">#没有该参数会报错：Failed to get final advertise address</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">volumeMounts</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> config
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">mountPath</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /etc/alertmanager
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> templates
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">mountPath</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /etc/templates
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">mountPath</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /alertmanager
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">volumes</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> config
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">configMap</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>config
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> templates
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">configMap</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>templates
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> alertmanager
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">emptyDir</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span class="token" style="color:var(--code-token-punctuation)">}</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<hr class="my-12 border-t border-solid border-divider-light"/>
<h3 id="prometheus" class="mt-10 mb-2 leading-7 text-xl title_3b154">prometheus<a class="link_3b154 header-anchor" aria-hidden="true" href="#prometheus">#</a></h3>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim prometheus/rbac.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-punctuation)">---</span><span>         
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Service
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/scrape</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;true&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9090</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> TCP
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">targetPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9090</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">type</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodePort
</span></span><span style="display:block;padding:0 1.25rem">          
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">---</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> apps/v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Deployment
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">replicas</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">1</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">matchLabels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">template</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">serviceAccountName</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">containers</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">image</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prom/prometheus</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>latest
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">imagePullPolicy</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> IfNotPresent
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">args</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;--storage.tsdb.path=/prometheus&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;--storage.tsdb.retention.time=30d&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;--config.file=/etc/prometheus/prometheus.yml&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">containerPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9090</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">requests</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">cpu</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 500m
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">memory</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 500M
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">limits</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">cpu</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 500m
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">memory</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 500M
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">volumeMounts</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> config
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">mountPath</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /etc/prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> rules
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">mountPath</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /etc/prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>rules
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">mountPath</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">volumes</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> config
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">configMap</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>config
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> rules
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">configMap</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>rules
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">emptyDir</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">nodeSelector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">node-role.kubernetes.io/master</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">kubernetes.io/hostname</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;master&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">tolerations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">key</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>role.kubernetes.io/master
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">operator</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Exists
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">effect</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NoSchedule</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">==prometheus配置文件说明：==</p>
<blockquote class="border-l-2 border-solid border-divider pl-4 my-6 transition-colors duration-500 blockquote_3b154">
<p class="my-4 leading-7">annotations将任何非标识metadata附加到对象，而labels可用于选择对象并查找满足某些条件的对象集合。相比之下，annotations不用于标识和选择对象，虽然它也是键值形式。annotations不会被Kubernetes直接使用，其主要目的是方便用户阅读查找。</p>
<p class="my-4 leading-7">Kubernetes的API SERVER会暴露API服务，Promethues集成了对Kubernetes的自动发现，它有5种模式：node、service、pod、endpoints、ingress。 上面是Prometheus官方给出的对Kubernetes服务发现的配置。可以看到大量的relabel_configs，其实把所有的relabel_configs去掉一样可以对kubernetes做服务发现。 relabel_configs仅仅是对采集过来的指标做二次处理，比如要什么、不要什么以及替换什么等等。而以 _<em>meta</em> 开头的这些元数据标签都是实例中包含的， 而relabel则是动态的修改、覆盖、添加删除这些标签或者这些标签对应的值。而且以 __ 开头的标签通常是系统内部使用的，因此这些标签不会被写入样本数据中， 如果我们要收集这些东西那么则要进行relabel操作。当然relabel操作也不仅限于操作以 __ 开头的标签。</p>
<p class="my-4 leading-7"><strong class="font-semibold">action的行为：</strong></p>
<p class="my-4 leading-7">----&gt;replace：默认行为，不配置action的话就采用这种行为，它会根据regex来去匹配source_labels标签上的值，并将并将匹配到的值写入target_label中;</p>
<p class="my-4 leading-7">----&gt;labelmap：它会根据regex去匹配标签名称，并将匹配到的内容作为新标签的名称，其值作为新标签的值;</p>
<p class="my-4 leading-7">----&gt;keep：仅收集匹配到regex的源标签，而会丢弃没有匹配到的所有标签，用于选择;</p>
<p class="my-4 leading-7">----&gt;drop：丢弃匹配到regex的源标签，而会收集没有匹配到的所有标签，用于排除;</p>
<p class="my-4 leading-7">----&gt;labeldrop：使用regex匹配标签，符合regex规则的标签将从target实例中移除，其实也就是不收集不保存;</p>
<p class="my-4 leading-7">----&gt;abelkeep：使用regex匹配标签，仅收集符合regex规则的标签，不符合的不收集。</p>
</blockquote>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim prometheus/config.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ConfigMap
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>config
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">data</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.yml</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">|</span><span class="token scalar" style="color:var(--code-token-string)">
</span></span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    global:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">      scrape_interval: 10s
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">      scrape_timeout: 10s
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">      evaluation_interval: 10s
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    alerting:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">      alertmanagers:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">      - static_configs:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        - targets:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          - alertmanager:9093
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    rule_files:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">      - &quot;/etc/prometheus-rules/*.rules&quot;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    scrape_configs:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">      - job_name: &#x27;node-exporter&#x27;                #node节点性能指标数据
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        tls_config:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        kubernetes_sd_configs:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        - role: endpoints
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        relabel_configs:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape, __meta_kubernetes_endpoint_port_name]
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          regex: true;node-exporter
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          action: keep
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme]
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          action: replace
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          target_label: __scheme__
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          regex: (https?)
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          action: replace
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          target_label: __metrics_path__
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          regex: (.+)
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        - source_labels: [__address__, __meta_kubernetes_service_annotation_prometheus_io_port]
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          action: replace
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          target_label: __address__
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          regex: (.+)(?::\d+);(\d+)
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          replacement: $1:$2
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        - action: labelmap
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          regex: __meta_kubernetes_service_label_(.+)
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        - source_labels: [__meta_kubernetes_namespace]
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          action: replace
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          target_label: kubernetes_namespace
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        - source_labels: [__meta_kubernetes_service_name]
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          action: replace
</span><span style="display:block;padding:0 1.25rem"><span class="token scalar" style="color:var(--code-token-string)">          target_label: kubernetes_name</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">job_name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;k8s-nodes&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">scheme</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> https
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">tls_config</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">ca_file</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">bearer_token_file</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /var/run/secrets/kubernetes.io/serviceaccount/token
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">kubernetes_sd_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">role</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">relabel_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> labelmap
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __meta_kubernetes_node_label_(.+)
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __address__
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">replacement</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 10.1.93.190</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span class="token number">6443</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_node_name</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> (.+)
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __metrics_path__
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">replacement</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /api/v1/nodes/$</span><span class="token" style="color:var(--code-token-punctuation)">{</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>/proxy/metrics
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">job_name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;kubernetes-cadvisor&#x27;</span><span>                </span><span class="token" style="color:var(--code-token-comment)">#容器、Pod相关的性能指标数据</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">scheme</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> https
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">tls_config</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">ca_file</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">bearer_token_file</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /var/run/secrets/kubernetes.io/serviceaccount/token
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">kubernetes_sd_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">role</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">relabel_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> labelmap
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __meta_kubernetes_node_label_(.+)
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __address__
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">replacement</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 10.1.93.190</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span class="token number">6443</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_node_name</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> (.+)
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __metrics_path__
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">replacement</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /api/v1/nodes/$</span><span class="token" style="color:var(--code-token-punctuation)">{</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>/proxy/metrics/cadvisor
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">metric_relabel_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>id</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> replace
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;^/machine\.slice/machine-rkt\\x2d([^\\]+)\\.+/([^/]+)\.service$&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> rkt_container_name
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">replacement</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;${2}-${1}&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>id</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> replace
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;^/system\.slice/(.+)\.service$&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> systemd_service_name
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">replacement</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;${1}&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">job_name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;kube-state-metrics&#x27;</span><span>              </span><span class="token" style="color:var(--code-token-comment)">#资源对象(Deployment、Pod等)的状态</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">tls_config</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">ca_file</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">bearer_token_file</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /var/run/secrets/kubernetes.io/serviceaccount/token
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">kubernetes_sd_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">role</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> endpoints
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">relabel_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_service_annotation_prometheus_io_scrape</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> __meta_kubernetes_endpoint_port_name</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> true;kube</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>state</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>metrics
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> keep
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_service_annotation_prometheus_io_scheme</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> replace
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __scheme__
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> (https</span><span class="token" style="color:var(--code-token-punctuation)">?</span><span>)
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_service_annotation_prometheus_io_path</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> replace
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __metrics_path__
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> (.+)
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__address__</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> __meta_kubernetes_service_annotation_prometheus_io_port</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> replace
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __address__
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> (.+)(</span><span class="token" style="color:var(--code-token-punctuation)">?</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>\d+);(\d+)
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">replacement</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> $1</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>$2
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> labelmap
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __meta_kubernetes_service_label_(.+)
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_namespace</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> replace
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kubernetes_namespace
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_service_name</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> replace
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kubernetes_name
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">job_name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;kubernetes-service-http-probe&#x27;</span><span>               </span><span class="token" style="color:var(--code-token-comment)">#通过http方式探测Service状态</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">tls_config</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">ca_file</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">bearer_token_file</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /var/run/secrets/kubernetes.io/serviceaccount/token
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">kubernetes_sd_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">role</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> service
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">metrics_path</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /probe
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">params</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">module</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>http_2xx</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">relabel_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_service_annotation_prometheus_io_scrape</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> __meta_kubernetes_service_annotation_prometheus_io_http_probe</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> true;true
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> keep
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_service_name</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> __meta_kubernetes_namespace</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> __meta_kubernetes_service_annotation_prometheus_io_http_probe_port</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> __meta_kubernetes_service_annotation_prometheus_io_http_probe_path</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> replace
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __param_target
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> (.+);(.+);(.+);(.+)
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">replacement</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> $1.$2</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>$3$4
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __address__
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">replacement</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 10.1.93.190</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span class="token number">30115</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__param_target</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> instance
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> labelmap
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __meta_kubernetes_service_annotation_prometheus_io_app_info_(.+)
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">job_name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;kubernetes-service-tcp-probe&#x27;</span><span>                </span><span class="token" style="color:var(--code-token-comment)">#通过tcp方式探测Service状态</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">tls_config</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">ca_file</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">bearer_token_file</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /var/run/secrets/kubernetes.io/serviceaccount/token
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">kubernetes_sd_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">role</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> service
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">metrics_path</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /probe
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">params</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">module</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>tcp_connect</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">relabel_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_service_annotation_prometheus_io_scrape</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> __meta_kubernetes_service_annotation_prometheus_io_tcp_probe</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> true;true
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> keep
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_service_name</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> __meta_kubernetes_namespace</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> __meta_kubernetes_service_annotation_prometheus_io_tcp_probe_port</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> replace
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __param_target
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> (.+);(.+);(.+)
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">replacement</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> $1.$2</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>$3
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __address__
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">replacement</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 10.1.93.190</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span class="token number">30115</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__param_target</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> instance
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> labelmap
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __meta_kubernetes_service_annotation_prometheus_io_app_info_(.+)
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">job_name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;kubernetes-ingresses&#x27;</span><span>              </span><span class="token" style="color:var(--code-token-comment)">#通过http方式探测ingresses状态</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">kubernetes_sd_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">role</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ingress
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">metrics_path</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /probe
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">params</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">module</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>http_2xx</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">relabel_configs</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_ingress_scheme</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> __address__</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> __meta_kubernetes_ingress_path</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> (.+);(.+);(.+)
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">replacement</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> $</span><span class="token" style="color:var(--code-token-punctuation)">{</span><span class="token number">1</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>//$</span><span class="token" style="color:var(--code-token-punctuation)">{</span><span class="token number">2</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>$</span><span class="token" style="color:var(--code-token-punctuation)">{</span><span class="token number">3</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __param_target
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __address__
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">replacement</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 10.1.93.190</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span class="token number">30115</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__param_target</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> instance
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">action</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> labelmap
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">regex</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> __meta_kubernetes_ingress_label_(.+)
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_namespace</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kubernetes_namespace
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">source_labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>__meta_kubernetes_ingress_name</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">target_label</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> kubernetes_name</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim prometheus/rules.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> ConfigMap
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>rules
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">data</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">node.rules</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">|</span><span class="token scalar" style="color:var(--code-token-string)">
</span></span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    groups:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">    - name: node
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">      rules:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">      - alert: NodeDown
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        expr: up == 0
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        for: 3m
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        labels:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          severity: critical
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        annotations:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          summary: &quot;{{ $labels.instance }}: down&quot;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          description: &quot;{{ $labels.instance }} has been down for more than 3m&quot;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          value: &quot;{{ $value }}&quot;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">      - alert: NodeCPUHigh
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        expr: (1 - avg by (instance) (irate(node_cpu_seconds_total{mode=&quot;idle&quot;}[5m]))) * 100 &gt; 75
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        for: 5m
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        labels:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          severity: warning
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">        annotations:
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          summary: &quot;{{$labels.instance}}: High CPU usage&quot;
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-string)" class="token scalar">          description: &quot;{{$labels.instance}}: CPU usage is above 75%&quot;
</span><span style="display:block;padding:0 1.25rem"><span class="token scalar" style="color:var(--code-token-string)">          value: &quot;{{ $value }}&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">alert</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodeCPUIowaitHigh
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">expr</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> avg by (instance) (irate(node_cpu_seconds_total</span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>mode=&quot;iowait&quot;</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>5m</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>)) * 100 </span><span class="token" style="color:var(--code-token-punctuation)">&gt;</span><span> 50
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">for</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 5m
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">severity</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> warning
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">summary</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{$labels.instance}}: High CPU iowait usage&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">description</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{$labels.instance}}: CPU iowait usage is above 50%&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">value</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{ $value }}&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">alert</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodeMemoryUsageHigh
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">expr</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> (1 </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100 </span><span class="token" style="color:var(--code-token-punctuation)">&gt;</span><span> 90
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">for</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 5m
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">severity</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> warning
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">summary</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{$labels.instance}}: High memory usage&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">description</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{$labels.instance}}: Memory usage is above 90%&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">value</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{ $value }}&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">alert</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodeDiskRootLow
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">expr</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> (1 </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> node_filesystem_avail_bytes</span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>fstype=~&quot;ext.</span><span class="token" style="color:#EBCB8B;font-weight:bold">*|xfs&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>mountpoint =&quot;/&quot;</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span> / node_filesystem_size_bytes</span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>fstype=~&quot;ext.</span><span class="token" style="color:#EBCB8B;font-weight:bold">*|xfs&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>mountpoint =&quot;/&quot;</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>) * 100 </span><span class="token" style="color:var(--code-token-punctuation)">&gt;</span><span> 80
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">for</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 10m
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">severity</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> warning
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">summary</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{$labels.instance}}: Low disk(the / partition) space&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">description</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{$labels.instance}}: Disk(the / partition) usage is above 80%&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">value</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{ $value }}&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem">        
</span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">alert</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodeDiskBootLow
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">expr</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> (1 </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> node_filesystem_avail_bytes</span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>fstype=~&quot;ext.</span><span class="token" style="color:#EBCB8B;font-weight:bold">*|xfs&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>mountpoint =&quot;/boot&quot;</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span> / node_filesystem_size_bytes</span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>fstype=~&quot;ext.</span><span class="token" style="color:#EBCB8B;font-weight:bold">*|xfs&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>mountpoint =&quot;/boot&quot;</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>) * 100 </span><span class="token" style="color:var(--code-token-punctuation)">&gt;</span><span> 80
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">for</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 10m
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">severity</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> warning
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">summary</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{$labels.instance}}: Low disk(the /boot partition) space&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">description</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{$labels.instance}}: Disk(the /boot partition) usage is above 80%&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">value</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{ $value }}&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">alert</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodeLoad5High
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">expr</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> (node_load5) </span><span class="token" style="color:var(--code-token-punctuation)">&gt;</span><span> (count by (instance) (node_cpu_seconds_total</span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>mode=&#x27;system&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>) * 2)
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">for</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 5m
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">severity</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> warning
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">summary</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{$labels.instance}}: Load(5m) High&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">description</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{$labels.instance}}: Load(5m) is 2 times the number of CPU cores&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">value</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;{{ $value }}&quot;</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim prometheus/prometheus.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-punctuation)">---</span><span>         
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Service
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/scrape</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;true&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9090</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> TCP
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">targetPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9090</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">type</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodePort
</span></span><span style="display:block;padding:0 1.25rem">          
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">---</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> apps/v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Deployment
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">replicas</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">1</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">matchLabels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">template</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">serviceAccountName</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">containers</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">image</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prom/prometheus</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>latest
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">imagePullPolicy</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> IfNotPresent
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">args</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;--storage.tsdb.path=/prometheus&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;--storage.tsdb.retention.time=30d&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;--config.file=/etc/prometheus/prometheus.yml&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">containerPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">9090</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">requests</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">cpu</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 500m
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">memory</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 500M
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">limits</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">cpu</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 500m
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">memory</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 500M
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">volumeMounts</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> config
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">mountPath</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /etc/prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> rules
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">mountPath</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /etc/prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>rules
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">mountPath</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">volumes</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> config
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">configMap</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>config
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> rules
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">configMap</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>rules
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> prometheus
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">emptyDir</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">nodeSelector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">node-role.kubernetes.io/master</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">kubernetes.io/hostname</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;master&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">tolerations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">key</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> node</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>role.kubernetes.io/master
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">operator</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Exists
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">effect</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NoSchedule</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<hr class="my-12 border-t border-solid border-divider-light"/>
<h3 id="grafana" class="mt-10 mb-2 leading-7 text-xl title_3b154">grafana<a class="link_3b154 header-anchor" aria-hidden="true" href="#grafana">#</a></h3>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim grafana/secret.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Secret
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">data</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">admin-password</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> YWRtaW4=              </span><span class="token" style="color:var(--code-token-comment)"># base64 加解密</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">admin-username</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> YWRtaW4=
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">type</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Opaque</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim grafana/grafana.yaml</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-yaml"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-yaml" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-punctuation)">---</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Service
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">annotations</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/scrape</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;true&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">prometheus.io/path</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;/metrics&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">3000</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">protocol</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> TCP
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">targetPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">3000</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">type</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> NodePort
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">---</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">apiVersion</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> apps/v1
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">kind</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Deployment
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">namespace</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> monitoring
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">replicas</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">1</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">selector</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">matchLabels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token atrule" style="color:var(--code-token-variable)">template</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">metadata</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">labels</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">app</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token atrule" style="color:var(--code-token-variable)">spec</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">containers</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">image</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana/grafana</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>latest
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">imagePullPolicy</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> IfNotPresent
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">ports</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">containerPort</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">3000</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">resources</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">limits</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">cpu</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 100m
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">memory</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 100Mi
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">requests</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">cpu</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 100m
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">memory</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> 100Mi
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">env</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> GF_AUTH_BASIC_ENABLED
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">value</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;true&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> GF_AUTH_ANONYMOUS_ENABLED
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">value</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;false&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> GF_AUTH_ANONYMOUS_ORG_ROLE
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">value</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> Admin
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> GF_DASHBOARDS_JSON_ENABLED
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">value</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;true&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> GF_INSTALL_PLUGINS
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">value</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>kubernetes</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>app               </span><span class="token" style="color:var(--code-token-comment)">#安装grafana-kubernetes-app插件</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> GF_SECURITY_ADMIN_USER
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">valueFrom</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>              </span><span class="token atrule" style="color:var(--code-token-variable)">secretKeyRef</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>                </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana
</span></span><span style="display:block;padding:0 1.25rem"><span>                </span><span class="token atrule" style="color:var(--code-token-variable)">key</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> admin</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>username
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> GF_SECURITY_ADMIN_PASSWORD
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">valueFrom</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>              </span><span class="token atrule" style="color:var(--code-token-variable)">secretKeyRef</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>                </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana
</span></span><span style="display:block;padding:0 1.25rem"><span>                </span><span class="token atrule" style="color:var(--code-token-variable)">key</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> admin</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>password
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">readinessProbe</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">httpGet</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">path</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /login
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token atrule" style="color:var(--code-token-variable)">port</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">3000</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">initialDelaySeconds</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">10</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">timeoutSeconds</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token number">5</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">volumeMounts</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>storage
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token atrule" style="color:var(--code-token-variable)">mountPath</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> /var/lib/grafana
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token atrule" style="color:var(--code-token-variable)">volumes</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">-</span><span> </span><span class="token atrule" style="color:var(--code-token-variable)">name</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> grafana</span><span class="token" style="color:var(--code-token-punctuation)">-</span><span>storage
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token atrule" style="color:var(--code-token-variable)">emptyDir</span><span class="token" style="color:var(--code-token-punctuation)">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span class="token" style="color:var(--code-token-punctuation)">}</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<hr class="my-12 border-t border-solid border-divider-light"/>
<h3 id="部署" class="mt-10 mb-2 leading-7 text-xl title_3b154">部署<a class="link_3b154 header-anchor" aria-hidden="true" href="#部署">#</a></h3>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span># 文件目录结构
</span></span><span style="display:block;padding:0 1.25rem">[root@master prometheus2]# tree
</span><span style="display:block;padding:0 1.25rem">.
</span><span style="display:block;padding:0 1.25rem">├── alertmanager
</span><span style="display:block;padding:0 1.25rem">│   ├── alertmanager.yaml
</span><span style="display:block;padding:0 1.25rem">│   ├── config.yaml
</span><span style="display:block;padding:0 1.25rem">│   └── templates.yaml
</span><span style="display:block;padding:0 1.25rem">├── blackbox-exporter
</span><span style="display:block;padding:0 1.25rem">│   ├── blackbox-exporter.yaml
</span><span style="display:block;padding:0 1.25rem">│   └── config.yaml
</span><span style="display:block;padding:0 1.25rem">├── dingtalk
</span><span style="display:block;padding:0 1.25rem">│   ├── config.yaml
</span><span style="display:block;padding:0 1.25rem">│   └── dingtalk.yaml
</span><span style="display:block;padding:0 1.25rem">├── grafana
</span><span style="display:block;padding:0 1.25rem">│   ├── grafana.yaml
</span><span style="display:block;padding:0 1.25rem">│   └── secret.yaml
</span><span style="display:block;padding:0 1.25rem">├── k8s
</span><span style="display:block;padding:0 1.25rem">│   ├── kube-controller-manager-prometheus-discovery.yaml
</span><span style="display:block;padding:0 1.25rem">│   ├── kube-proxy-prometheus-discovery.yaml
</span><span style="display:block;padding:0 1.25rem">│   └── kube-scheduler-prometheus-discovery.yaml
</span><span style="display:block;padding:0 1.25rem">├── kube-state-metrics
</span><span style="display:block;padding:0 1.25rem">│   ├── kube-state-metrics.yaml
</span><span style="display:block;padding:0 1.25rem">│   └── rbac.yaml
</span><span style="display:block;padding:0 1.25rem">├── node-exporter
</span><span style="display:block;padding:0 1.25rem">│   └── node-exporter.yaml
</span><span style="display:block;padding:0 1.25rem">└── prometheus
</span><span style="display:block;padding:0 1.25rem">    ├── config.yaml
</span><span style="display:block;padding:0 1.25rem">    ├── nc.yaml
</span><span style="display:block;padding:0 1.25rem">    ├── prometheus.yaml
</span><span style="display:block;padding:0 1.25rem">    ├── rbac.yaml
</span><span style="display:block;padding:0 1.25rem">    └── rules.yaml
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">8 directories, 20 files</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span># 部署
</span></span><span style="display:block;padding:0 1.25rem">kubectl apply -f namespace.yaml
</span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem">kubectl apply -f node-exporter/
</span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem">kubectl apply -f k8s/
</span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem">kubectl apply -f kube-state-metrics/
</span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem">kubectl apply -f blackbox-exporter/
</span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem">kubectl apply -f dingtalk/
</span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem">kubectl apply -f alertmanager/
</span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem">kubectl apply -f prometheus/
</span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem">kubectl apply -f grafana/</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span># 查看部署结果
</span></span><span style="display:block;padding:0 1.25rem">[root@master prometheus2]# kubectl get all -n monitoring
</span><span style="display:block;padding:0 1.25rem">NAME                                      READY   STATUS    RESTARTS   AGE
</span><span style="display:block;padding:0 1.25rem">pod/alertmanager-59f9ddcccf-kbbvc         1/1     Running   0          22h
</span><span style="display:block;padding:0 1.25rem">pod/blackbox-exporter-b74677477-f2sf5     1/1     Running   0          23h
</span><span style="display:block;padding:0 1.25rem">pod/grafana-74bfb44dbf-6rtrn              1/1     Running   0          22h
</span><span style="display:block;padding:0 1.25rem">pod/kube-state-metrics-5f6f7c9fbb-zcf6k   1/1     Running   0          23h
</span><span style="display:block;padding:0 1.25rem">pod/node-exporter-4nxpb                   1/1     Running   0          23h
</span><span style="display:block;padding:0 1.25rem">pod/node-exporter-xz5kq                   1/1     Running   0          23h
</span><span style="display:block;padding:0 1.25rem">pod/prometheus-7f99f9888d-kdn9d           1/1     Running   0          16h
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">NAME                         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
</span><span style="display:block;padding:0 1.25rem">service/alertmanager         NodePort    10.96.167.209   &lt;none&gt;        9093:31973/TCP   22h
</span><span style="display:block;padding:0 1.25rem">service/blackbox-exporter    NodePort    10.96.179.56    &lt;none&gt;        9115:30115/TCP   23h
</span><span style="display:block;padding:0 1.25rem">service/dingtalk             ClusterIP   10.96.168.175   &lt;none&gt;        8060/TCP         23h
</span><span style="display:block;padding:0 1.25rem">service/grafana              NodePort    10.96.158.146   &lt;none&gt;        3000:31170/TCP   22h
</span><span style="display:block;padding:0 1.25rem">service/kube-state-metrics   NodePort    10.96.106.100   &lt;none&gt;        8080:31493/TCP   23h
</span><span style="display:block;padding:0 1.25rem">service/node-exporter        NodePort    10.96.215.144   &lt;none&gt;        9100:30181/TCP   22h
</span><span style="display:block;padding:0 1.25rem">service/prometheus           NodePort    10.96.229.43    &lt;none&gt;        9090:32343/TCP   22h
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">NAME                           DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE
</span><span style="display:block;padding:0 1.25rem">daemonset.apps/node-exporter   1         1         1       1            1           &lt;none&gt;          23h
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">NAME                                 READY   UP-TO-DATE   AVAILABLE   AGE
</span><span style="display:block;padding:0 1.25rem">deployment.apps/alertmanager         1/1     1            1           22h
</span><span style="display:block;padding:0 1.25rem">deployment.apps/blackbox-exporter    1/1     1            1           23h
</span><span style="display:block;padding:0 1.25rem">deployment.apps/dingtalk             1/1     1            1           23h
</span><span style="display:block;padding:0 1.25rem">deployment.apps/grafana              1/1     1            1           22h
</span><span style="display:block;padding:0 1.25rem">deployment.apps/kube-state-metrics   1/1     1            1           23h
</span><span style="display:block;padding:0 1.25rem">deployment.apps/prometheus           1/1     1            1           22h
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">NAME                                            DESIRED   CURRENT   READY   AGE
</span><span style="display:block;padding:0 1.25rem">replicaset.apps/alertmanager-59f9ddcccf         1         1         1       22h
</span><span style="display:block;padding:0 1.25rem">replicaset.apps/blackbox-exporter-b74677477     1         1         1       23h
</span><span style="display:block;padding:0 1.25rem">replicaset.apps/dingtalk-77d475cc8              1         1         1       23h
</span><span style="display:block;padding:0 1.25rem">replicaset.apps/grafana-74bfb44dbf              1         1         1       22h
</span><span style="display:block;padding:0 1.25rem">replicaset.apps/kube-state-metrics-5f6f7c9fbb   1         1         1       23h
</span><span style="display:block;padding:0 1.25rem">replicaset.apps/kube-state-metrics-7d4b4fb7c8   1         1         1       23h
</span><span style="display:block;padding:0 1.25rem">replicaset.apps/prometheus-7f99f9888d           1         1         1       22h</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">==访问prometheus：==浏览器输入<a target="_blank" rel="noopener noreferrer" href="http://10.1.93.190:32343/targets" class="link_03735  link_3b154 inline-link_3b154">http://10.1.93.190:32343/targets</a>   （端口号视service而定）</p>
<p class="my-4 leading-7"><img src="/static/image/1616552351873.6e757935.png" alt="1616552351873"/></p>
<p class="my-4 leading-7"><img src="/static/image/1616552817376.ab7fa49f.png" alt="1616552817376"/></p>
<p class="my-4 leading-7">==访问grafana：==浏览器输入<a target="_blank" rel="noopener noreferrer" href="http://10.1.93.190:31170/targets" class="link_03735  link_3b154 inline-link_3b154">http://10.1.93.190:31170/targets</a>  （端口号视service而定）</p>
<p class="my-4 leading-7">以下均未验证！！！</p>
<p class="my-4 leading-7">数据源是<code>http://prometheus:32343</code>，导入<code>主机详情</code>模板8919，</p>
<p class="my-4 leading-7"><img src="/static/image/20200729191908564.76696f70.png" alt="在这里插入图片描述"/></p>
<hr class="my-12 border-t border-solid border-divider-light"/>
<h3 id="grafana配置kubernetes数据源" class="mt-10 mb-2 leading-7 text-xl title_3b154">grafana配置kubernetes数据源<a class="link_3b154 header-anchor" aria-hidden="true" href="#grafana配置kubernetes数据源">#</a></h3>
<p class="my-4 leading-7">启动插件：<code>Plugins</code> → <code>kubernetes</code> → <code>Enable</code>，然后配置集群访问地址及访问证书：</p>
<p class="my-4 leading-7">如果是通过kubeadm方式搭建的k8s集群，会有一个 <code>/etc/kubernetes/admin.conf</code> 文件，里面包含了客户端的证书和密码base64编码。</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>
</code></div></div>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><code>cat /etc/kubernetes/admin.conf
apiVersion: v1clusters:- cluster:    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJd01EVXhNakV3TURBek1Gb1hEVE13TURVeE1ERXdNREF6TUZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTDVpCmYxTGcxUUlqN0VlWlZ0cVFmS3dGZjg4V3NVbVVialZldll5NDZTUittMWpwRWdvM2wxWEIvZHBFNzRWOGtqTGQKZkdGdmVWZkVxNy8rMzdyamNGMXRpSm1BbThLZnMrMW9QdEpLOE0yZjNTSm5FZVVIQUlBeFl2cUE4ZFNsbThTQwpmSkJWU2J3K1pROTBTelpKNzdQUzFuZTBmYnRod0Y2VHE0Uy9FV3h3cUZZMzF5cENub05lVUNtcElsSjVnYWdtCnJ2QmhkTmFNb2oyQlRrMWNDVjh3dkRVS3RlbXFVYVE4R2ZCalZLeHhkdWtwcjJ3S3RPbXZkem1vMEdLSE11MFcKWmQ1TVd0dStIQVZrTXhzcE95Yk41NkFkNnloUkN5YkFJbTN2ZWJlTFV5cjBEY2JhNzJXNVlPRHRCY3ZBOEJxOAoxR1JQc1EwaXBUdGtYbDVCZEhzQ0F3RUFBYU1qTUNFd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFJS0lIb25wVllFWWpwR3JrN2wraGJyeGlxZXkKeGFQT1M3UW5TZEVZMC94TWtiUWxKcy9rUFcxU2lVemdoUk4wQWJxMnFtTXVuNHhlZ0pLdGVPNXhYRGJZNEhZbgpVVCtPWG0rQ1hBQjd3S3pYcDlmUTZBUDk3cmY0L2FRaXlGZEtsZUJ6Y3JNUkErZHZWTjk3NGlHUW94aFh3T1FNCmZXeGNrMDNhU0Qvc2s5UnJrcFhlL1g2NHQrV3BkUlFGRjE2YVFlSHVxNnJQRWZTR2VPUWVpcVIrQVgvdWpIOHoKZzJZY2JKWE85U3ZheXcyb3oxSlozTUx6K0FpeE5RTHFNYU00Tm43TklvMExxUHFqNzZoU3d1Qk1nREE0VnFtZAowZHRtS211OVZjTGZHcW9ITnZnajlTYlVlZ1crL3VEbzcwVXdvb2NGTmlnSnRnOVVSZWpEUXJJSm4rUT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=    server: https://192.168.30.188:6443  name: kubernetescontexts:- context:    cluster: kubernetes    user: kubernetes-admin  name: kubernetes-admin@kubernetescurrent-context: kubernetes-admin@kuberneteskind: Configpreferences: {}users:- name: kubernetes-admin  user:    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM4akNDQWRxZ0F3SUJBZ0lJZWtMYS9Fc1ZDSGd3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TURBMU1USXhNREF3TXpCYUZ3MHlNVEExTVRJeE1EQXdNekphTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXJ2a084MUg0ZW9zak5kM3oKSy9UUEhHcGtCR1FvZm1hbm9ldjRlWXNmUTlPZW0wYzBvVUJ3cXoxM2JabmJUbmJweFFqbmdZMkc4bHF4UmkwaQpCdlA2ZmtmS0ZFQlZzUTd4dGlqZXBrdnByWEdPL08wUUE1U0k4NHJzTjVHOVhOa2pQbWdzYTBlblZxNUVvRTBGClRaNXpRRjlwUlkxWUZZZXYrTDE1bU5FaXlScUg4UDJRY3BoUmxWK09IUXVHaVdLNEhIRVB2QWw2QUpJeWN6d3MKWWMrdk1IdHlZbmF5NUMwUldVWHhyUmc0ZytKMksrY1h1YlF0elhXdjdxaTNhNjFDekpaZi9TZkNOd0Jyam9zRwp0b215WEJWNVZTVGJUYVk1OFZrLzFPK1NSc3BybjF3TDc0djdXUXVEaE9ydXhBRXpuYmRXWWxOMEZBMm5MTjlZCmwxWkVKUUlEQVFBQm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFHazlIRDAxRmRRUnd4THhGUi8yRjdPM2ZpdGRFV3pDTC9UawpsZUxZaGlQaVh3NjNwOGtWU0VabEIyNEYzNEd2WlB3YS9LWnNUQnZXM0Mwek9uNGpHQ2hueHEvaVdqTWFnVEdBCktPUFV2bUI2VzhvVzhlb0lrSStOOEs0NFhSRnZzeGIwNUtqaCtwd0VZZzJUQXpBNEFlQzlnSjZYaTBzbHpnVnIKcWRzbXZtV0QzNEdXYzJOcVIzSDA3cW43RlJwRHIrTjlrTHE4Ukt4L0YwMWNCV1I3VVRZcnJTLzJEQ2t1N3lsWgptdTcwcXZicndYWnF6TkI5b05hQk82SHJsZXpuU2JQbnFKZUo0Q1czc2NMNmJ1N3A3bEppV1VQb0VHT0xic3YvCnFjT0xqdnZSRFF6eC9Xak5DWFZLNFhxbzJjVERGYitXeFJ1U2xGaUlQclk1QjlkQlFJWT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBcnZrTzgxSDRlb3NqTmQzeksvVFBIR3BrQkdRb2ZtYW5vZXY0ZVlzZlE5T2VtMGMwCm9VQndxejEzYlpuYlRuYnB4UWpuZ1kyRzhscXhSaTBpQnZQNmZrZktGRUJWc1E3eHRpamVwa3ZwclhHTy9PMFEKQTVTSTg0cnNONUc5WE5ralBtZ3NhMGVuVnE1RW9FMEZUWjV6UUY5cFJZMVlGWWV2K0wxNW1ORWl5UnFIOFAyUQpjcGhSbFYrT0hRdUdpV0s0SEhFUHZBbDZBSkl5Y3p3c1ljK3ZNSHR5WW5heTVDMFJXVVh4clJnNGcrSjJLK2NYCnViUXR6WFd2N3FpM2E2MUN6SlpmL1NmQ053QnJqb3NHdG9teVhCVjVWU1RiVGFZNThWay8xTytTUnNwcm4xd0wKNzR2N1dRdURoT3J1eEFFem5iZFdZbE4wRkEybkxOOVlsMVpFSlFJREFRQUJBb0lCQUI4OHI0S1krN2RFNThCUwpJM3VSZFBncHRqbGllQ2c0dzJ5UTZBY3E0eVlFdmFnVENqNVBkczNiWjFyVndPVTlMWGJUcENEbzExS2xCa2owCi9jSW9CR3hPL0xDbzI2T0VlM3A5eVdIKzQzVG5kUk9LYnZWMHF3NXZtc1JBN0lHSzhsUE4zVUE1eHBJZkFubHIKeHFxWXd4S1c5Z0JJdjVUNGFGNEwxWTJHcUtNbUlhenVjLzVleU5rZjk3bnRyOFJncXQxcDJyaWJIVS9nRzFlYgpIWktyNm01UWx2MWJpYTFIYms2SWI2b1pYTVFIWWJSckpVemJSaWp6eE1RVkRmZ2tpalhSR3pSRjdZeVFZbTk5CmwwUzI1bDYzY1dIT3J6czM5R21xRmQ4Z0JJc0M3SkxuUThUY01nb1Axb0M5WXUzMGRrSDBvUi95M2lOTnFxRW8KZVJ2d0w0RUNnWUVBeG1tY2JDZXRlRDI5VWZDTE1kKzByTU14aVV4bHI3TTdrYUJOeWxPK2lOZWxKbUk5UHRXcwpkUzQzS2hkeElnSVNIQVRTdWxpR3VKMStEekxTWWNGZ2FkSmQxd25NNHppOUc2cW9NOXZTTVN2ZGtvK28ydXRqCmNscVBZcnVRbC9nK252dkE2N1ZyZzAyUXF0NFlqcmkrYmxQL1RNaDZGS3NGa0VQeXZPTHUxOTBDZ1lFQTRjSFgKUm43WUl2TWtMNGQrR3dkUmRwcXl5YStxVC9nbUtKTnNwb3VLUVZlaUd3aW9vR21BR0E0MEJBR2hyN24vMXB6Rwo5VkVQb201VDdPRnVmVWxGaUNURmJBblN2RWU5RTREUHJ3SDNhazlXR0JzcWxYcUZwMjdwWWFyZ3NSS2JDWU9UCm9Nc1FJR0wxelN4NEpkdFArMUxDQ1BuRnowMTNkajhRbmc4TVBPa0NnWUFwczF5cTVwUHc1NWo0dGNPcmtjYloKWUpUeXRGblMyYXExYXFtdTBuY0RMNytJRjdHam1Ta0wzOUM4U2Z6L0ZzeFRremZ1N2xneVNQZUxualRWVXQwKwpvSFlVa2Z5NzdOcmlDN1lhWUNNSExwNzlCTENLZ2xwK1dFWTJqQkZSdjF6NThST1U5cVpJREc5UldpaHpKcVR2CmJ6d0RHVWQvUElxSXpaOGd6OWsvQ1FLQmdIbEFRaDVEdkZReElNdENTM0c2NFg4QklXdC9wTXFrcmVIM0pGRGkKKzFPUy9LYm1aS01iWnNnRXdOMHgveVJCa3U0eWNBMk1Cd2lubHYzUUtpYXlOdDBqV3NGbkdUODBqSkd3Q2x1bApnN3dlZGxBbUx4M3ZtMTlOQzU0QVNBUHl5VUEzNGc5bllQYjBENjZ0NXEzMmQ2TzFWQys3N3dralF6bElMK1drCmtWOFpBb0dBVk01R1lLbnpNVjUzVzNXT3I0dFdLSm5XUHFiaHVlUEt5SXMzbTNkUzhGUE56SDU2UHhNKzRUM24Ka2NzT1VsZTlkQkFENXRXT3E5eHFmNWF4MXpaU2s1SzFhdUphSzRaa3RzNkdMRUgrU09WckdoK1JXQWtRcUFVbgo0Qmk4ZVA4MmR5M3N2RmV1UkNvTWFXRVQ0QlFHaGRQaFFCd1NNdlYrSWI2R3U0VldwN289Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
</code></div></div>
<p class="my-4 leading-7">其中属性<code>certificate-authority-data</code>、<code>client-certificate-data</code>、<code>client-key-data</code> 对应 CA 证书、Client 证书、Client 私钥，文件里面的内容是base64编码过后的，分别执行 <code>echo &quot;&quot; | base64 -d</code> 就能还原成证书源文件。</p>
<p class="my-4 leading-7">首先将<code>Datasource</code>设置为<code>Prometheus</code>，</p>
<p class="my-4 leading-7"><img src="/static/image/20200729191924720.f2244443.png" alt="在这里插入图片描述"/></p>
<p class="my-4 leading-7">点击<code>Save</code>保存即可，grafana中自动出现下图中的dashboard，</p>
<p class="my-4 leading-7"><img src="/static/image/20200729191937113.b0395eb7.png" alt="在这里插入图片描述"/></p>
<p class="my-4 leading-7"><img src="/static/image/2020072919195143.68f5e606.png" alt="在这里插入图片描述"/></p>
<p class="my-4 leading-7">K8s Cluster：</p>
<p class="my-4 leading-7"><img src="/static/image/2020072919200356.a630cd4b.png" alt="在这里插入图片描述"/></p>
<p class="my-4 leading-7">K8s Node：</p>
<p class="my-4 leading-7">没有显示是因为prometheus的metric有更新，比如<code>node_cpu</code>改成了<code>node_cpu_seconds_total</code>。可以重新定义该dashboard的变量（可以参考8919 dashboard的变量），然后根据prometheus界面的metrics来调试。调试完毕示图：</p>
<p class="my-4 leading-7"><img src="/static/image/20200729192014827.c2edff4b.png" alt="在这里插入图片描述"/></p>
<p class="my-4 leading-7">K8s Deployments：</p>
<p class="my-4 leading-7"><img src="/static/image/2020072919202645.dbb42c7a.png" alt="在这里插入图片描述"/></p>
<p class="my-4 leading-7">K8s Container：</p>
<p class="my-4 leading-7"><img src="/static/image/202007291920401.bbeef20d.png" alt="在这里插入图片描述"/></p>
<p class="my-4 leading-7">grafana配置kubernetes数据源完成，接下来测试告警。</p>
<hr class="my-12 border-t border-solid border-divider-light"/>
<h3 id="告警测试" class="mt-10 mb-2 leading-7 text-xl title_3b154">告警测试<a class="link_3b154 header-anchor" aria-hidden="true" href="#告警测试">#</a></h3>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">宕机测试：</li>
</ul>
<p class="my-4 leading-7">模拟node-exporter宕机，测试钉钉告警（<code>critical</code>）是否正常。这里选择<code>node3</code>作为测试机器。</p>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>vim kill_node-exporter.sh</span></span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>#!/bin/bash
</span></span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem">nodepid=`netstat -lntp | grep 9100 | awk &#x27;{print $NF}&#x27; | awk -F &#x27;/&#x27; &#x27;{print $1}&#x27;`
</span><span style="display:block;padding:0 1.25rem">nodenum=`netstat -lntp | grep 9100 | grep -v pause | wc -l`
</span><span style="display:block;padding:0 1.25rem"> 
</span><span style="display:block;padding:0 1.25rem">if [ $nodenum -eq 0 ];then
</span><span style="display:block;padding:0 1.25rem">    exit
</span><span style="display:block;padding:0 1.25rem">else
</span><span style="display:block;padding:0 1.25rem">    kill -9 $nodepid
</span><span style="display:block;padding:0 1.25rem">    exit
</span><span style="display:block;padding:0 1.25rem">fi</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">等待3m，收到钉钉故障告警和恢复告警，</p>
<p class="my-4 leading-7"><img src="/static/image/20200729192053371.cfd33e68.png" alt="在这里插入图片描述"/></p>
<p class="my-4 leading-7"><img src="/static/image/2020072919210429.406f4247.png" alt="在这里插入图片描述"/></p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">CPU测试：</li>
</ul>
<p class="my-4 leading-7">模拟CPU使用率为80%，测试邮件告警（<code>warning</code>)是否正常。这里选择<code>node3</code>作为测试机器。</p>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>yum install -y stress-ng stress-ng -c 0 -l 80            
</span></span><span style="display:block;padding:0 1.25rem"># -c 指定压力源进程的数量，以匹配在线CPU的数量，0表示加载每个cpu；-l 指定CPU使用率；Ctrl + C 退出</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7"><img src="/static/image/20200729192120498.f9a9cb2e.png" alt="在这里插入图片描述"/></p>
<p class="my-4 leading-7">等待5m，收到邮件故障告警和恢复告警，</p>
<p class="my-4 leading-7"><img src="/static/image/20200729192130944.ee3c6074.png" alt="在这里插入图片描述"/></p>
<p class="my-4 leading-7"><img src="/static/image/20200729192140965.e555963a.png" alt="在这里插入图片描述"/></p>
<p class="my-4 leading-7">测试钉钉和邮件告警均没有问题。更多关于k8s集群的指标监控可以自行配置，此处仅作为演示。</p>
<p class="my-4 leading-7">k8s以Deployment方式部署 prometheus + grafana 完成。生产环境建议使用StatefulSet方式部署集群，大致过程与上面类似。已存放至个人gitee：<a target="_blank" rel="noopener noreferrer" href="https://gitee.com/xinbadayt/prometheus.git" class="link_03735  link_3b154 inline-link_3b154">https://gitee.com/xinbadayt/prometheus.git</a></p>
<p class="my-4 leading-7">转载至<a target="_blank" rel="noopener noreferrer" href="https://blog.csdn.net/miss1181248983/article/details/107673128" class="link_03735  link_3b154 inline-link_3b154">https://blog.csdn.net/miss1181248983/article/details/107673128</a></p><!--/$--></div><div class="rspress-doc-footer"><footer class="mt-8"><div class="xs:flex pb-5 px-2 justify-end items-center"></div><div class="flex flex-col"></div><div class="flex flex-col sm:flex-row sm:justify-around gap-4 pt-6"><div class="prev_e7091 flex flex-col"></div><div class="next_e7091 flex flex-col"><a class="link_03735 pager-link_9b9a7 next_9b9a7 cursor-pointer" target="" href="/tang/Prometheus/2.html"><span class="desc_9b9a7">Next Page</span><span class="title_9b9a7">3.其他参考文档</span></a></div></div></footer></div></div></div><div class="aside-container_edeb4"><div><div class="flex flex-col"><div class="&lt;lg:hidden"><div id="aside-container" class="relative text-sm font-medium"><div class="leading-7 block text-sm font-semibold pl-3">ON THIS PAGE</div><nav class="mt-1"><ul class="relative"><li><a href="#namespace" title="namespace" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">namespace</span></a></li><li><a href="#node-exporter" title="node-exporter" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">node-exporter</span></a></li><li><a href="#k8s组件" title="k8s组件" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">k8s组件</span></a></li><li><a href="#kube-state-metrics" title="kube-state-metrics" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">kube-state-metrics</span></a></li><li><a href="#blackbox-exporter" title="blackbox-exporter" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">blackbox-exporter</span></a></li><li><a href="#dingtalk" title="dingtalk" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">dingtalk</span></a></li><li><a href="#alertmanager" title="alertmanager" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">alertmanager</span></a></li><li><a href="#prometheus" title="prometheus" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">prometheus</span></a></li><li><a href="#grafana" title="grafana" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">grafana</span></a></li><li><a href="#部署" title="部署" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">部署</span></a></li><li><a href="#grafana配置kubernetes数据源" title="grafana配置kubernetes数据源" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">grafana配置kubernetes数据源</span></a></li><li><a href="#告警测试" title="告警测试" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">告警测试</span></a></li></ul></nav></div></div></div></div></div></div></div></section></div></div>
  <div id="search-container"></div>
</body>

</html>
