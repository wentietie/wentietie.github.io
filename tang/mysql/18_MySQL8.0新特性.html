<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Rspress v1.38.0">
  <title data-rh="true">18 MySQL8.0新特性 - wenatie</title>
<script>{;const saved = localStorage.getItem('rspress-theme-appearance');const preferDark = window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = !saved || saved === 'auto' ? preferDark : saved === 'dark';document.documentElement.classList.toggle('dark', isDark);document.documentElement.style.colorScheme = isDark ? 'dark' : 'light';}</script><link rel="icon" href="/rspress-icon.png"><script defer src="/static/js/styles.1737145b.js"></script><script defer src="/static/js/lib-react.bfe73f81.js"></script><script defer src="/static/js/lib-router.aa18f61d.js"></script><script defer src="/static/js/index.df03ac1d.js"></script><link href="/static/css/styles.c26b7a64.css" rel="stylesheet"></head>

<body >
  <div id="root"><div><div class="navContainer_f6cde rspress-nav px-6 " style="position:sticky"><div class="container_f6cde flex justify-between items-center h-full"><div class="navBarTitle_f6cde"><a class="link_03735 flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60 cursor-pointer" target="" href="/index.html"><span>wenatie</span></a></div><div class="flex flex-1 justify-end items-center"><div class="rightNav_f6cde"><div class="flex sm:flex-1 items-center sm:pl-4 sm:pr-2"><div class="rspress-nav-search-button navSearchButton_6e282"><button><svg width="18" height="18" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9Z"></path></svg><p class="searchWord_6e282">Search Docs</p><div style="opacity:0"><span></span><span>K</span></div></button></div><div class="mobileNavSearchButton_6e282"><svg width="24" height="24" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9Z"></path></svg></div></div><div class="rspress-nav-menu menu h-14"><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">小唐学习笔记</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/gitlab/gitlab-error.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>gitlab</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/java2/00_前言.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>java</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/mysql/01_MySQL概述.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>mysql</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/docker/Docker.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>docker</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/k8s/学习资料/command.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>k8s</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/Elasticsearch/01_Elasticsearch概述.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>Elasticsearch</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/Prometheus/1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>Prometheus</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/Python/1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>Python</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/Vue/1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>Vue</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/server/CentOS7root账号免密登录.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>服务器环境安装</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/mservice/2.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>微服务</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/项目上线/xiaochengxu.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>项目上线</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/tang/IoTPlatform/jetlinks项目初体验.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>物联网项目</span></div></div></a></div></div></div></div></div></div><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">前端基础</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/es6/es6-1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>ES6入门</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/youdontknowjs/part1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>你不知道的Javascript</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/design/index.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>设计模式</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/typescript/ts-basic.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>typescript</span></div></div></a></div></div></div></div></div></div><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">框架</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/formwork/vue/vueyuanli.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>vue2</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/formwork/vue3/reactive/part1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>vue3</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/formwork/harmony/part1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>鸿蒙</span></div></div></a></div></div></div></div></div></div><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">计算机基础</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/end/c/data-contruction/part1.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>数据结构（严蔚敏）</span></div></div></a></div></div></div></div></div></div><div class="mx-3 last:mr-0"><div class="relative flex-center h-14"><button class="rspress-nav-menu-group-button flex-center items-center font-medium text-sm text-text-1 hover:text-text-2 transition-colors duration-200"><span class="text-sm font-medium flex" style="margin-right:2px">随笔笔记</span><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div class="rspress-nav-menu-group-content absolute mx-0.8 transition-opacity duration-300" style="opacity:0;visibility:hidden;right:0;top:52px"><div class="p-3 pr-2 w-full h-full max-h-100vh whitespace-nowrap" style="box-shadow:var(--rp-shadow-3);z-index:100;border:1px solid var(--rp-c-divider-light);border-radius:var(--rp-radius-large);background:var(--rp-c-bg)"><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/notes/JS/hwdj.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>JS相关</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/notes/CSS/css-selector.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>CSS相关</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/notes/browser/xmlhttprequest.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>浏览器相关</span></div></div></a></div></div><div><div class="font-medium my-1"><a class="link_03735  cursor-pointer" target="" href="/notes/node/node.html"><div class="rounded-2xl hover:bg-mute" style="padding:0.4rem 1.5rem 0.4rem 0.75rem"><div class="flex"><span>node相关</span></div></div></a></div></div></div></div></div></div></div><div class="flex-center flex-row"><div class="mx-2"><div class="md:mr-2 rspress-nav-appearance"><div class="p-1 border border-solid border-gray-300 text-gray-400  cursor-pointer rounded-md hover:border-gray-600 hover:text-gray-600 dark:hover:border-gray-200 dark:hover:text-gray-200 transition-all duration-300 w-7 h-7"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="dark:hidden" width="18" height="18" fill="currentColor"><path d="M12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm0-10c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zM12 4c-.6 0-1-.4-1-1V1c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1zM12 24c-.6 0-1-.4-1-1v-2c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1zM5.6 6.6c-.3 0-.5-.1-.7-.3L3.5 4.9c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.1.2-.4.3-.7.3zM19.8 20.8c-.3 0-.5-.1-.7-.3l-1.4-1.4c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.2.2-.5.3-.7.3zM3 13H1c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1zM23 13h-2c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1zM4.2 20.8c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.4.3-.7.3zM18.4 6.6c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.5.3-.7.3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" class="hidden dark:block" width="18" height="18" fill="currentColor"><path d="M12.1 22h-.9c-5.5-.5-9.5-5.4-9-10.9.4-4.8 4.2-8.6 9-9 .4 0 .8.2 1 .5.2.3.2.8-.1 1.1-2 2.7-1.4 6.4 1.3 8.4 2.1 1.6 5 1.6 7.1 0 .3-.2.7-.3 1.1-.1.3.2.5.6.5 1-.2 2.7-1.5 5.1-3.6 6.8-1.9 1.4-4.1 2.2-6.4 2.2zM9.3 4.4c-2.9 1-5 3.6-5.2 6.8-.4 4.4 2.8 8.3 7.2 8.7 2.1.2 4.2-.4 5.8-1.8 1.1-.9 1.9-2.1 2.4-3.4-2.5.9-5.3.5-7.5-1.1-2.8-2.2-3.9-5.9-2.7-9.2z"></path></svg></div></div></div></div></div><div class="mobileNavMenu_f6cde"><div class="navScreen_457e8 " id="navScreen"><div class="container_457e8"><div class="navMenu_457e8"><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">小唐学习笔记</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/gitlab/gitlab-error.html"><div><div class="flex justify-center"><span>gitlab</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/java2/00_前言.html"><div><div class="flex justify-center"><span>java</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/mysql/01_MySQL概述.html"><div><div class="flex justify-center"><span>mysql</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/docker/Docker.html"><div><div class="flex justify-center"><span>docker</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/k8s/学习资料/command.html"><div><div class="flex justify-center"><span>k8s</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/Elasticsearch/01_Elasticsearch概述.html"><div><div class="flex justify-center"><span>Elasticsearch</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/Prometheus/1.html"><div><div class="flex justify-center"><span>Prometheus</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/Python/1.html"><div><div class="flex justify-center"><span>Python</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/Vue/1.html"><div><div class="flex justify-center"><span>Vue</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/server/CentOS7root账号免密登录.html"><div><div class="flex justify-center"><span>服务器环境安装</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/mservice/2.html"><div><div class="flex justify-center"><span>微服务</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/项目上线/xiaochengxu.html"><div><div class="flex justify-center"><span>项目上线</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/tang/IoTPlatform/jetlinks项目初体验.html"><div><div class="flex justify-center"><span>物联网项目</span></div></div></a></div></div></div></div></div></div></div><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">前端基础</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/es6/es6-1.html"><div><div class="flex justify-center"><span>ES6入门</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/youdontknowjs/part1.html"><div><div class="flex justify-center"><span>你不知道的Javascript</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/design/index.html"><div><div class="flex justify-center"><span>设计模式</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/JavaScript/typescript/ts-basic.html"><div><div class="flex justify-center"><span>typescript</span></div></div></a></div></div></div></div></div></div></div><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">框架</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/formwork/vue/vueyuanli.html"><div><div class="flex justify-center"><span>vue2</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/formwork/vue3/reactive/part1.html"><div><div class="flex justify-center"><span>vue3</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/formwork/harmony/part1.html"><div><div class="flex justify-center"><span>鸿蒙</span></div></div></a></div></div></div></div></div></div></div><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">计算机基础</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/end/c/data-contruction/part1.html"><div><div class="flex justify-center"><span>数据结构（严蔚敏）</span></div></div></a></div></div></div></div></div></div></div><div class="navMenuItem_457e8 w-full"><div class="mx-3 last:mr-0"><div class=" navScreenMenuGroup_457e8 relative"><button class="button_457e8"><span class="buttonSpan_457e8">随笔笔记</span><svg width="1em" height="1em" viewBox="0 0 32 32" class=" down_457e8 "><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></button><div><div class="items_457e8"><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/notes/JS/hwdj.html"><div><div class="flex justify-center"><span>JS相关</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/notes/CSS/css-selector.html"><div><div class="flex justify-center"><span>CSS相关</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/notes/browser/xmlhttprequest.html"><div><div class="flex justify-center"><span>浏览器相关</span></div></div></a></div></div><div><div class="py-1 font-medium"><a class="link_03735  cursor-pointer" target="" href="/notes/node/node.html"><div><div class="flex justify-center"><span>node相关</span></div></div></a></div></div></div></div></div></div></div></div><div class="flex-center flex-col gap-2"><div class="mt-2 navAppearance_457e8 flex justify-center"></div></div></div></div><button aria-label="mobile hamburger" class=" navHamburger_e7b06 text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="currentColor"><circle cx="8" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="24" cy="16" r="2" fill="currentColor"></circle></svg></button></div></div></div></div><section><div class="docLayout_edeb4 pt-0"><div class="rspress-sidebar-menu"><button class="flex-center mr-auto"><div class="text-md mr-2"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M4 6h24v2H4zm0 18h24v2H4zm0-12h24v2H4zm0 6h24v2H4z"></path></svg></div><span class="text-sm">Menu</span></button><button class="flex-center ml-auto"><span class="text-sm">ON THIS PAGE</span><div class="text-md mr-2" style="transform:rotate(0deg);transition:transform 0.2s ease-out;margin-top:2px"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></button><div class="rspress-local-toc-container "><ul><li><a href="#181-mysql800新特性概述" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">18.1 MySQL80.0新特性概述</span></a></li><li><a href="#1811-mysql80新增特性" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.1.1 MySQL8.0新增特性</span></a></li><li><a href="#1812-mysql80移除的就特性" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.1.2 MySQL8.0移除的就特性</span></a></li><li><a href="#182-新特性1-窗口函数" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">18.2 新特性1-窗口函数</span></a></li><li><a href="#1821-概述" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.2.1 概述</span></a></li><li><a href="#1822-语法" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.2.2 语法</span></a></li><li><a href="#1823-序号函数" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.2.3 序号函数</span></a></li><li><a href="#1824-分布函数" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.2.4 分布函数</span></a></li><li><a href="#1825-前后函数" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.2.5 前后函数</span></a></li><li><a href="#1826-首尾函数" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.2.6 首尾函数</span></a></li><li><a href="#1827-聚合函数" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.2.7 聚合函数</span></a></li><li><a href="#1828-其他函数" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.2.8 其他函数</span></a></li><li><a href="#1829--window语法的使用" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.2.9  WINDOW语法的使用</span></a></li><li><a href="#18210-小结-窗口函数的特点" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.2.10 小结-窗口函数的特点</span></a></li><li><a href="#1829-测试中用到的表及数据" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.2.9 测试中用到的表及数据</span></a></li><li><a href="#183-新特性2-公用表表达式" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:0"><span class="rspress-toc-link-text block">18.3 新特性2-公用表表达式</span></a></li><li><a href="#1831-普通公用表表达式" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.3.1 普通公用表表达式</span></a></li><li><a href="#1832-递归公用表表达式" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.3.2 递归公用表表达式</span></a></li><li><a href="#1833-小结" class="rspress-toc-link sm:text-normal text-sm" style="margin-left:12px"><span class="rspress-toc-link-text block">18.3.3 小结</span></a></li></ul></div></div><aside class="sidebar_71eca rspress-sidebar "><div class="navTitleMask_71eca"><div class="navBarTitle_f6cde"><a class="link_03735 flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60 cursor-pointer" target="" href="/index.html"><span>wenatie</span></a></div></div><div class="rspress-scrollbar sidebarContent_71eca"><nav class="pb-2"><section class="rspress-sidebar-section mt-0.5 block" style="margin-left:0"><div class="rspress-sidebar-collapse flex justify-between items-center menuItem_71eca" style="border-radius:0 var(--rp-radius) var(--rp-radius) 0;cursor:pointer"><h2 class="py-2 px-3 text-sm font-medium flex" style="font-size:14px;padding-left:24px;font-weight:bold"><span class="flex-center" style="font-size:14px">mysql基础查漏补缺</span></h2><div class="collapseContainer_71eca p-2 rounded-xl"><div style="cursor:pointer;transition:transform 0.2s ease-out;transform:rotate(90deg)"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M22 16 12 26l-1.4-1.4 8.6-8.6-8.6-8.6L12 6z"></path></svg></div></div></div><div class="transition-all duration-300 ease-in-out" style="overflow:hidden"><div class="rspress-sidebar-group transition-opacity duration-500 ease-in-out" style="opacity:1;margin-left:12px"><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/01_MySQL概述.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>1 MySQL数据库概述</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/02_关系型数据库与非关系型数据库.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>2 关系型数据库与非关系型数据库</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/03_关系型数据库设计原则.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>3 关系型数据库设计原则</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/04_MySQL的登录.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>4 MySQL的登录</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/05_MySQL一些常用命令.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>5 MySQL一些常用命令</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/06_MySQL图形化管理工具.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>6 MySQL图形化管理工具</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/07_运算符.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>7.4 位运算符</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/08_MySQL函数.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>8 MySQL函数</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/09_子查询.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>9 子查询</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/10_管理数据库和数据库表.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>10 数据库和数据库表的管理</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/11_数据的增删改.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>11 数据处理之增删改</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/12_MySQL中的数据类型.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>12.6 日期与时间</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/13_约束.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>13 约束</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/14_视图.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>14 视图</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/15_存储过程与存储函数.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>15 存储过程与存储函数</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/16_变量、流程控制与游标.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>16 变量、流程控制与游标</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/17_触发器.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>17 触发器</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/18_MySQL8.0新特性.html"><div class="menuItemActive_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>18 MySQL8.0新特性</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/19_表及其数据.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>19 附：表及其数据</span></div></a></div><div class="rspress-sidebar-item"><a class="link_03735 menuLink_71eca cursor-pointer" target="" href="/tang/mysql/99_MySQL常见问题的解决.html"><div class="menuItem_71eca mt-0.5 py-2 px-3 font-medium flex" style="font-size:13px;margin-left:18px;border-radius:0 var(--rp-radius) var(--rp-radius) 0"><span>99 MySQL常见问题的解决</span></div></a></div></div></div></section></nav></div></aside><div class="content_edeb4 rspress-doc-container flex flex-shrink-0 mx-auto"><div class="w-full flex-1"><div><div class="rspress-doc"><!--$--><h1 id="18-mysql80新特性" class="text-3xl mb-10 leading-10 tracking-tight title_3b154">18 MySQL8.0新特性<a class="link_3b154 header-anchor" aria-hidden="true" href="#18-mysql80新特性">#</a></h1>
<h2 id="181-mysql800新特性概述" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_3b154">18.1 MySQL80.0新特性概述<a class="link_3b154 header-anchor" aria-hidden="true" href="#181-mysql800新特性概述">#</a></h2>
<h3 id="1811-mysql80新增特性" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.1.1 MySQL8.0新增特性<a class="link_3b154 header-anchor" aria-hidden="true" href="#1811-mysql80新增特性">#</a></h3>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">更简便的NoSQL支持</strong>。从5.6版本开始，MySQL就开始支持简单的NoSQL存储功能。MySQL8.0对这一功能做了优化，以更灵活的方式实现NoSQL，不再依赖模式。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">更好的索引</strong>。新增<code>隐藏索引</code>和<code>降序索引</code>。<code>隐藏索引</code>可以用来测试去掉索引对查询性能的影响；在查询中混合存在多列索引时，使用<code>降序索引</code>可以提高查询性能。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">更完善的JSON支持</strong>。从5.7版本开始支持原生json数据的存储，8.0进行了优化。</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">增加了聚合函数<code>JSON_ARRAYGG</code>和<code>JSON_OBJECTAGG</code>，将参数聚合为JSON数组或对象；</li>
<li class="[&amp;:not(:first-child)]:mt-2">新增行内操作符<code>-&gt;&gt;</code>，是列路径运算符<code>-&gt;</code>的增强，对JSON排序做了提升；</li>
<li class="[&amp;:not(:first-child)]:mt-2">优化了JSON的更新操作</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">安全和账户管理</strong>。新增<code>caching_sha2_password</code>授权插件、角色、密码历史记录和FIPS模式支持。提高了数据库的安全性和性能，使数据库管理员能更灵活的进行账户管理工作。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">InnoDB的变化</strong>。<code>InnoDB是MySQL默认的存储引擎</code>，8.0在其自增、索引、加密、死锁、共享锁等方面做了大量的<code>改进和优化</code>，并且支持原子数据定义语言（DDL），提高了数据安全性，对事务提供更好的支持。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">数据字典</strong>。新增事务数据字典，用来存储数据库对象信息。数据字典存储在内部事务表中。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">原子数据定义语言</strong>，即<code>原子DDL</code>。目前只有InnoDB引擎支持。</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">定义：原子数据定义语句（DDL）将与DDL操作相关的数据字典更新、存储引擎操作、二进制日志写入结合到一个单独的原子事务中。</li>
<li class="[&amp;:not(:first-child)]:mt-2">好处：即使服务器崩溃，事务也会提交或回滚。</li>
<li class="[&amp;:not(:first-child)]:mt-2">具体表现：使用支持原子DDL的引擎所创建的表，在执行<code>DROP TABLE</code>、<code>CREATE TABLE</code>、<code>ALTER TABLE</code>、<code>RENAME TABLE</code>、<code>TRUNCATE TABLE</code>、<code>CREATE TABLESPACE</code>、<code>DROP TABLESPACE</code>等操作时，都支持原子操作，即<em>事务要么完全操作成功，要么失败后回滚，不再进行部分提交</em>。</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">资源管理</strong>。MySQL 8开始支持创建和管理<code>资源组</code>，允许将服务器内运行的线程分配给特定的分组，以便线程根据组内可用资源执行.</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">字符集支持</strong>。MySQL 8默认字符集改为<code>utf8mb4</code> ，并首次增加了日语所特定使用的集 合，utf8mb4_ja_0900_as_cs。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">优化器增强</strong>。MySQL优化器开始支持隐藏索引和降序索引。隐藏索引不会被优化器使用，验证索引的必 要性时不需要删除索引，先将索引隐藏，如果优化器性能无影响就可以真正地删除索引。降序索引允许 优化器对多个列进行排序，并且允许排序顺序不一致。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">公用表表达式</strong>。公用表表达式（Common Table Expressions）简称为CTE，MySQL现在支持<code>递归</code>和<code>非递归</code>两种形式的CTE。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">窗口函数</strong>。在之前的版本中已存在的大部分 聚合函数 在MySQL 8中也可以 作为窗口函数来使用。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">正则表达式支持</strong>。增加了<code>REGEXP_LIKE()</code>、<code> EGEXP_INSTR()</code>、<code>REGEXP_REPLACE()</code>和 <code>REGEXP_SUBSTR()</code>等函数来提升性能，另外，<code>regexp_stack_limit</code>和 <code>regexp_time_limit</code>系统变量能够通过匹配引擎来控制资源消耗。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">内部临时表</strong>。<code>TempTable存储引擎取代MEMORY存储引擎成为内部临时表的默认存储引擎 </code>。TempTable存储 引擎为VARCHAR和VARBINARY列提供高效存储。<code>internal_tmp_mem_storage_engine</code>会话变量定义了内部 临时表的存储引擎，可选的值有两个，<code>TempTable</code>和<code>MEMORY</code>，其中TempTable为默认的存储引擎。 <code>temptable_max_ram</code>系统配置项定义了TempTable存储引擎可使用的最大内存数量。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">日志记录</strong>。在MySQL 8中错误日志子系统由一系列MySQL组件构成。这些组件的构成由系统变量 log_error_services来配置，能够实现日志事件的过滤和写入。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2"></li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">增强的MySQL复制</strong>。MySQL 8复制支持对<code>JSON文档</code>进行<code>部分更新</code>的<code>二进制日志记录</code> ，该记录使用紧凑的二进制格式 ，从而<em>节省记录完整JSON文档的空间</em>。当使用基于语句的日志记录时，这种紧凑的日志记录会自动完成，并且可以通过将新的<code>binlog_row_value_options</code>系统变量值设置为PARTIAL_JSON来启用。</p>
</li>
</ul>
<h3 id="1812-mysql80移除的就特性" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.1.2 MySQL8.0移除的就特性<a class="link_3b154 header-anchor" aria-hidden="true" href="#1812-mysql80移除的就特性">#</a></h3>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">查询缓存</strong>。查询缓存已被移除 ，删除的项有：<!-- -->
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">语句：FLUSH QUERY CACHE和RESET QUERY CACHE。</li>
<li class="[&amp;:not(:first-child)]:mt-2">系统变量：query_cache_limit、query_cache_min_res_unit、query_cache_size、 query_cache_type、query_cache_wlock_invalidate。</li>
<li class="[&amp;:not(:first-child)]:mt-2">状态变量：Qcache_free_blocks、 Qcache_free_memory、Qcache_hits、Qcache_inserts、Qcache_lowmem_prunes、Qcache_not_cached、 Qcache_queries_in_cache、Qcache_total_blocks。</li>
<li class="[&amp;:not(:first-child)]:mt-2">线程状态：checking privileges on cached query、checking query cache for query、invalidating query cache entries、sending cached result to client、storing result in query cache、waiting for query cache lock。</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">加密相关</strong>。<!-- -->
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">删除的加密相关的内容有：ENCODE()、DECODE()、ENCRYPT()、DES_ENCRYPT()和 DES_DECRYPT()函数，配置项des-key-file，系统变量have_crypt，FLUSH语句的DES_KEY_FILE选项， HAVE_CRYPT CMake选项。</li>
<li class="[&amp;:not(:first-child)]:mt-2">对于移除的ENCRYPT()函数，考虑使用SHA2()替代，对于其他移除的函数，使 用AES_ENCRYPT()和AES_DECRYPT()替代。</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">空间函数相关</strong>。在MySQL 5.7版本中，多个空间函数已被标记为过时。这些过时函数在MySQL 8中都已被 移除，只保留了对应的ST_和MBR函数。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">\N和NULL</strong>。在SQL语句中，解析器不再将\N视为NULL，所以在SQL语句中应使用NULL代替\N。这项变化 不会影响使用LOAD DATA INFILE或者SELECT...INTO OUTFILE操作文件的导入和导出。在这类操作中，NULL 仍等同于\N。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">mysql_install_db</strong>。在MySQL分布中，已移除了mysql_install_db程序，数据字典初始化需要调用带着-- initialize或者--initialize-insecure选项的mysqld来代替实现。另外，--bootstrap和INSTALL_SCRIPTDIR CMake也已被删除。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">通用分区处理程序</strong>。通用分区处理程序已从MySQL服务中被移除。为了实现给定表分区，表所使用的存 储引擎需要自有的分区处理程序。 提供本地分区支持的MySQL存储引擎有两个，即InnoDB和NDB，而在 MySQL 8中只支持InnoDB。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">系统和状态变量信息</strong>。在INFORMATION_SCHEMA数据库中，对系统和状态变量信息不再进行维护。 GLOBAL_VARIABLES、SESSION_VARIABLES、GLOBAL_STATUS、SESSION_STATUS表都已被删除。另外，系 统变量show_compatibility_56也已被删除。被删除的状态变量有Slave_heartbeat_period、 Slave_last_heartbeat,Slave_received_heartbeats、Slave_retried_transactions、Slave_running。以上被删除 的内容都可使用性能模式中对应的内容进行替代。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">mysql_plugin工具</strong>。mysql_plugin工具用来配置MySQL服务器插件，现已被删除，可使用--plugin-load或- -plugin-load-add选项在服务器启动时加载插件或者在运行时使用INSTALL PLUGIN语句加载插件来替代该 工具</li>
</ul>
<h2 id="182-新特性1-窗口函数" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_3b154">18.2 新特性1-窗口函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#182-新特性1-窗口函数">#</a></h2>
<h3 id="1821-概述" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.2.1 概述<a class="link_3b154 header-anchor" aria-hidden="true" href="#1821-概述">#</a></h3>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">作用</strong>：类似于在查询中使用<code>GROUP BY</code>对数据进行分组，不同的是，分组操作会把分组的结果汇聚成一条记录，<em>窗口函数是将结果置于每一条数据记录中</em>。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">分类</strong>：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><code>静态窗口函数</code>：函数的窗口大小是固定的，不会因为记录的不同而不同</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>动态窗口函数</code>：函数的窗口大小会随着记录的不同而变化</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">概览</strong>：窗口函数总体上可以分为序号函数、分布函数、前后函数、首尾函数和其他函数，如下：</p>
<table class="block border-collapse text-base my-5 overflow-x-auto leading-7 border-gray-light-3 dark:border-divider">
<thead>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<th class="border border-solid px-4 py-2 text-text-1 text-base font-semibold border-gray-light-3 dark:border-divider">函数分类</th>
<th class="border border-solid px-4 py-2 text-text-1 text-base font-semibold border-gray-light-3 dark:border-divider">函数</th>
<th class="border border-solid px-4 py-2 text-text-1 text-base font-semibold border-gray-light-3 dark:border-divider">描述</th>
</tr>
</thead>
<tbody>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">序号函数</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">ROW_NUMBER()</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">顺序排序</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">序号函数</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">RANK()</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">并列排序，会跳过重复的序号，如1、1、3</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">序号函数</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">DENSE_RANK()</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">并列排序，不会跳过重复的序号，如1、1、2</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">分布函数</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">PERCENT_RANK</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">等级值百分比</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">分布函数</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">CUME_DIST()</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">累积分布值</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">前后函数</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">LAG(expr, n)</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">返回当前行的往前数第n行的expr的值。expr是表中字段名</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">前后函数</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">LEAD(expr, n)</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">返回当前行的往后数第n行的expr的值。expr是表中字段名</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">首尾函数</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">FIRST_VALUE(expr)</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">返回第一个expr的值。expr是表中字段名</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">首尾函数</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">LAST_VALUE(expr)</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">返回最后一个expr的值。expr是表中字段名</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">其他函数</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">NTH_VALUE(expr, n)</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">返回第n个expr的值。expr是表中字段名</td>
</tr>
<tr class="border border-solid transition-colors duration-500 even:bg-soft border-gray-light-3 dark:border-divider">
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">其他函数</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">NTILE(n)</td>
<td class="border border-solid px-4 py-2 border-gray-light-3 dark:border-divider">将分区中的有序数据分成n个桶，记录桶编号</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h3 id="1822-语法" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.2.2 语法<a class="link_3b154 header-anchor" aria-hidden="true" href="#1822-语法">#</a></h3>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>SELECT [列名1, 列名2, ...,] 函数 OVER ([PARTITION BY 字段名 ORDER BY 字段名 ASC|DESC])
</span></span><span style="display:block;padding:0 1.25rem">FROM ...
</span><span style="display:block;padding:0 1.25rem">...</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">或</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>SELECT [列名1, 列名2, ...,] 函数 OVER 窗口名
</span></span><span style="display:block;padding:0 1.25rem">FROM ...
</span><span style="display:block;padding:0 1.25rem">[WHERE ...]
</span><span style="display:block;padding:0 1.25rem">WINDOW 窗口名 AS ([PARTITION BY 字段名 ORDER BY 字段名 ASC|DESC])
</span><span style="display:block;padding:0 1.25rem">...</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><code>OVER</code>：指定窗口函数的范围。</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">如果省略括号中的内容（即<code>函数 OVER()</code>），则窗口会包含满足WHERE条件的所有记录，窗口函数会基于所有满足WHERE条件的记录并进行计算。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">如果OVER()中使用了ORDER BY，FROM后边建议不要使用ORDER BY了，否则结果出人意料：</p>
<p class="my-4 leading-7">当sql语句中的order by子句里的内容和窗口函数over()中的order by子句里的内容一样，那么sql语句中的排序将先执行,窗口函数在分析时就不必再排序；order by 字段两者不一致时，那么sql语句中的排序将最后在窗口函数分析结束后执行排序。所以如果在over中已经添加了order by…，就不建议在from后面再添加相同的order by。二者一致的话还好(效果一样，没有差别)，但不一致时结果有时就可能令人费解了。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><code>OVER ([PARTITION BY 字段名1 ORDER BY 字段名2 ASC|DESC])</code>表示根据字段名1进行分组，在分组内按照字段名2排序</p>
</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><code>PARTITION BY</code>：指定窗口函数按照哪些字段进行分组。</p>
<p class="my-4 leading-7">分组后，窗口函数可以在每个分组中分别执行。</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><code>ORDER BY</code>：指定窗口函数按照哪些字段进行排序。</p>
<p class="my-4 leading-7">执行排序操作使窗口函数按照排序后的数据记录的顺序进行编号</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><code>WINDOW 子句</code>：可以只用WINDOW子句为窗口函数命名，在窗口函数的OVER关键字后边直接使用窗口名即可</p>
</li>
</ul>
<h3 id="1823-序号函数" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.2.3 序号函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#1823-序号函数">#</a></h3>
<h5 id="-row_number" class="title_3b154">① ROW_NUMBER()<a class="link_3b154 header-anchor" aria-hidden="true" href="#-row_number">#</a></h5>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">语法：<code>ROW_NUMBER() OVER ([PARTITION BY 字段1 ORDER BY 字段名2 ASC|DESC])</code></p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">含义：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">按照字段1分组，分组内按照字段2排序，然后按照排好的顺序给<strong class="font-semibold">每个分组内</strong>的记录按照顺序编号。</li>
<li class="[&amp;:not(:first-child)]:mt-2"><strong class="font-semibold">每个分组内的编号是连续且唯一的</strong>。</li>
<li class="[&amp;:not(:first-child)]:mt-2">如果<code>PARTITION BY 字段1</code>省略，表示整个表是一个分组</li>
<li class="[&amp;:not(:first-child)]:mt-2">如果<code>ORDER BY 字段名2</code>省略，按照默认排序方式进行排序</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">举例：查询goods中商品信息，并给不用类型的服装以价格由高到低进行编号，且保持编号的唯一性。</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>mysql&gt; SELECT row_number() OVER (PARTITION BY category_id ORDER BY price DESC) AS num, id, category_id, `NAME`, price
</span></span><span style="display:block;padding:0 1.25rem">    -&gt; FROM goods;
</span><span style="display:block;padding:0 1.25rem">+-----+----+-------------+-----------------+---------+
</span><span style="display:block;padding:0 1.25rem">| num | id | category_id | NAME            | price   |
</span><span style="display:block;padding:0 1.25rem">+-----+----+-------------+-----------------+---------+
</span><span style="display:block;padding:0 1.25rem">|   1 |  7 |           1 | 呢绒外套        |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|   2 |  5 |           1 | 牛仔裤          |   89.90 |
</span><span style="display:block;padding:0 1.25rem">|   3 |  9 |           1 | 卫衣            |   89.90 |
</span><span style="display:block;padding:0 1.25rem">|   4 |  2 |           1 | 连衣裙          |   79.90 |
</span><span style="display:block;padding:0 1.25rem">|   5 |  1 |           1 | T恤             |   39.90 |
</span><span style="display:block;padding:0 1.25rem">|   6 | 11 |           1 | 百褶裙          |   29.90 |
</span><span style="display:block;padding:0 1.25rem">|   1 | 10 |           2 | 山地自行车      | 1399.90 |
</span><span style="display:block;padding:0 1.25rem">|   2 |  6 |           2 | 运动外套        |  799.90 |
</span><span style="display:block;padding:0 1.25rem">|   3 | 12 |           2 | 滑板            |  499.90 |
</span><span style="display:block;padding:0 1.25rem">|   4 |  4 |           2 | 骑行装备        |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|   5 |  8 |           2 | 自行车          |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|   6 |  3 |           2 | 登山杖          |   59.90 |
</span><span style="display:block;padding:0 1.25rem">+-----+----+-------------+-----------------+---------+
</span><span style="display:block;padding:0 1.25rem">12 rows in set (0.00 sec)</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul>
<h5 id="-rank函数" class="title_3b154">② RANK()函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#-rank函数">#</a></h5>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">语法：<code>RANK() OVER ([PARTITION BY 字段1 ]ORDER BY 字段名2 ASC|DESC)</code></p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">含义：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">按照字段1分组，分组内按照字段2排序，然后按照排好的顺序给<strong class="font-semibold">每个分组内</strong>的记录按照顺序编号。</li>
<li class="[&amp;:not(:first-child)]:mt-2">序号是可以重复的。</li>
<li class="[&amp;:not(:first-child)]:mt-2">会跳过重复序号，如1、2、2、4</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">说明：OVER()中必须使用ORDER BY 语句，否则排序序号全都为1</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">举例：查询goods中商品信息，并给不用类型的服装以价格由高到低进行编号，且跳过重复序号</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>mysql&gt; SELECT RANK() OVER (PARTITION BY category_id ORDER BY price DESC) AS num, id, category_id, `NAME`, price
</span></span><span style="display:block;padding:0 1.25rem">    -&gt; FROM goods;
</span><span style="display:block;padding:0 1.25rem">+-----+----+-------------+-----------------+---------+
</span><span style="display:block;padding:0 1.25rem">| num | id | category_id | NAME            | price   |
</span><span style="display:block;padding:0 1.25rem">+-----+----+-------------+-----------------+---------+
</span><span style="display:block;padding:0 1.25rem">|   1 |  7 |           1 | 呢绒外套        |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|   2 |  5 |           1 | 牛仔裤          |   89.90 |
</span><span style="display:block;padding:0 1.25rem">|   2 |  9 |           1 | 卫衣            |   89.90 |
</span><span style="display:block;padding:0 1.25rem">|   4 |  2 |           1 | 连衣裙          |   79.90 |
</span><span style="display:block;padding:0 1.25rem">|   5 |  1 |           1 | T恤             |   39.90 |
</span><span style="display:block;padding:0 1.25rem">|   6 | 11 |           1 | 百褶裙          |   29.90 |
</span><span style="display:block;padding:0 1.25rem">|   1 | 10 |           2 | 山地自行车      | 1399.90 |
</span><span style="display:block;padding:0 1.25rem">|   2 |  6 |           2 | 运动外套        |  799.90 |
</span><span style="display:block;padding:0 1.25rem">|   3 | 12 |           2 | 滑板            |  499.90 |
</span><span style="display:block;padding:0 1.25rem">|   4 |  4 |           2 | 骑行装备        |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|   4 |  8 |           2 | 自行车          |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|   6 |  3 |           2 | 登山杖          |   59.90 |
</span><span style="display:block;padding:0 1.25rem">+-----+----+-------------+-----------------+---------+
</span><span style="display:block;padding:0 1.25rem">12 rows in set (0.00 sec)</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul>
<h5 id="-dense_rank函数" class="title_3b154">③ DENSE_RANK()函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#-dense_rank函数">#</a></h5>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">语法：<code>DENSE_RANK() OVER ([PARTITION BY 字段1 ]ORDER BY 字段名2 ASC|DESC)</code></p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">含义：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">按照字段1分组，分组内按照字段2排序，然后按照排好的顺序给<strong class="font-semibold">每个分组内</strong>的记录按照顺序编号。</li>
<li class="[&amp;:not(:first-child)]:mt-2">序号是可以重复的。</li>
<li class="[&amp;:not(:first-child)]:mt-2">不会跳过重复序号，如1、2、2、3</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">说明：OVER()中必须使用ORDER BY 语句，否则排序序号全都为1</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">举例：查询goods中商品信息，并给不用类型的服装以价格由高到低进行编号，且不要跳过重复序号。</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>mysql&gt; SELECT DENSE_RANK() OVER (PARTITION BY category_id ORDER BY price DESC) AS num, id, category_id, `NAME`, price
</span></span><span style="display:block;padding:0 1.25rem">    -&gt; FROM goods;
</span><span style="display:block;padding:0 1.25rem">+-----+----+-------------+-----------------+---------+
</span><span style="display:block;padding:0 1.25rem">| num | id | category_id | NAME            | price   |
</span><span style="display:block;padding:0 1.25rem">+-----+----+-------------+-----------------+---------+
</span><span style="display:block;padding:0 1.25rem">|   1 |  7 |           1 | 呢绒外套        |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|   2 |  5 |           1 | 牛仔裤          |   89.90 |
</span><span style="display:block;padding:0 1.25rem">|   2 |  9 |           1 | 卫衣            |   89.90 |
</span><span style="display:block;padding:0 1.25rem">|   3 |  2 |           1 | 连衣裙          |   79.90 |
</span><span style="display:block;padding:0 1.25rem">|   4 |  1 |           1 | T恤             |   39.90 |
</span><span style="display:block;padding:0 1.25rem">|   5 | 11 |           1 | 百褶裙          |   29.90 |
</span><span style="display:block;padding:0 1.25rem">|   1 | 10 |           2 | 山地自行车      | 1399.90 |
</span><span style="display:block;padding:0 1.25rem">|   2 |  6 |           2 | 运动外套        |  799.90 |
</span><span style="display:block;padding:0 1.25rem">|   3 | 12 |           2 | 滑板            |  499.90 |
</span><span style="display:block;padding:0 1.25rem">|   4 |  4 |           2 | 骑行装备        |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|   4 |  8 |           2 | 自行车          |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|   5 |  3 |           2 | 登山杖          |   59.90 |
</span><span style="display:block;padding:0 1.25rem">+-----+----+-------------+-----------------+---------+
</span><span style="display:block;padding:0 1.25rem">12 rows in set (0.00 sec)</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul>
<h3 id="1824-分布函数" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.2.4 分布函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#1824-分布函数">#</a></h3>
<h5 id="-percent_rank函数" class="title_3b154">① PERCENT_RANK()函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#-percent_rank函数">#</a></h5>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">语法：<code>PERCENT_RANK() OVER ([PARTITION BY 字段1 ]ORDER BY 字段名2 ASC|DESC)</code></p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">含义：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">按照RANK()函数计算出来的编号，计算当前分组中每条记录的<strong class="font-semibold">等级值百分比</strong></li>
<li class="[&amp;:not(:first-child)]:mt-2">公式为<code>(rank-1)/(rows-1)</code>，其中rank为使用RANK()产生的序号，rows为当前分组中的总记录条数</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">说明：OVER()中必须使用ORDER BY语句，否则计算出来的值为0（因为rank=1）</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">举例：查询goods中商品信息，并计算不同类别的商品价格的等级百分比</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>mysql&gt; SELECT RANK() OVER (PARTITION BY category_id ORDER BY price DESC) AS r,
</span></span><span style="display:block;padding:0 1.25rem">    -&gt; PERCENT_RANK() OVER (PARTITION BY category_id ORDER BY price DESC) AS &#x27;pr_%&#x27;,
</span><span style="display:block;padding:0 1.25rem">    -&gt; id, category_id, category, NAME, price, stock
</span><span style="display:block;padding:0 1.25rem">    -&gt; FROM goods;
</span><span style="display:block;padding:0 1.25rem">+---+------+----+-------------+---------------------+-----------------+---------+-------+
</span><span style="display:block;padding:0 1.25rem">| r | pr_% | id | category_id | category            | NAME            | price   | stock |
</span><span style="display:block;padding:0 1.25rem">+---+------+----+-------------+---------------------+-----------------+---------+-------+
</span><span style="display:block;padding:0 1.25rem">| 1 |    0 |  7 |           1 | 女装/女士精品       | 呢绒外套        |  399.90 |  1200 |
</span><span style="display:block;padding:0 1.25rem">| 2 |  0.2 |  5 |           1 | 女装/女士精品       | 牛仔裤          |   89.90 |  3500 |
</span><span style="display:block;padding:0 1.25rem">| 2 |  0.2 |  9 |           1 | 女装/女士精品       | 卫衣            |   89.90 |  1500 |
</span><span style="display:block;padding:0 1.25rem">| 4 |  0.6 |  2 |           1 | 女装/女士精品       | 连衣裙          |   79.90 |  2500 |
</span><span style="display:block;padding:0 1.25rem">| 5 |  0.8 |  1 |           1 | 女装/女士精品       | T恤             |   39.90 |  1000 |
</span><span style="display:block;padding:0 1.25rem">| 6 |    1 | 11 |           1 | 女装/女士精品       | 百褶裙          |   29.90 |   500 |
</span><span style="display:block;padding:0 1.25rem">| 1 |    0 | 10 |           2 | 户外运动            | 山地自行车      | 1399.90 |  2500 |
</span><span style="display:block;padding:0 1.25rem">| 2 |  0.2 |  6 |           2 | 户外运动            | 运动外套        |  799.90 |   500 |
</span><span style="display:block;padding:0 1.25rem">| 3 |  0.4 | 12 |           2 | 户外运动            | 滑板            |  499.90 |  1200 |
</span><span style="display:block;padding:0 1.25rem">| 4 |  0.6 |  4 |           2 | 户外运动            | 骑行装备        |  399.90 |  3500 |
</span><span style="display:block;padding:0 1.25rem">| 4 |  0.6 |  8 |           2 | 户外运动            | 自行车          |  399.90 |  1000 |
</span><span style="display:block;padding:0 1.25rem">| 6 |    1 |  3 |           2 | 户外运动            | 登山杖          |   59.90 |  1500 |
</span><span style="display:block;padding:0 1.25rem">+---+------+----+-------------+---------------------+-----------------+---------+-------+
</span><span style="display:block;padding:0 1.25rem">12 rows in set (0.00 sec)</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul>
<h5 id="-cume_dist函数" class="title_3b154">② CUME_DIST()函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#-cume_dist函数">#</a></h5>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">语法：<code>CUME_DIST() OVER ([PARTITION BY 字段1 ]ORDER BY 字段名2 ASC|DESC)</code></p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">含义：计算每条记录在当前分组中所占百分比，公式如下：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">使用<code>ASC</code>升序排序：根据公式<code>当前分组中小于等于当前值的数据行数 / 该分组总行数totalrows</code>计算每条记录的百分比</li>
<li class="[&amp;:not(:first-child)]:mt-2">使用<code>DESC</code>降序排序：根据公式<code>当前分组中大于等于当前值的数据行数 / 该分组总行数totalrows</code>计算每条记录的百分比</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">说明：OVER()中必须使用ORDER BY语句，否则计算出来的值都为1</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">举例：查询goods中商品信息，并计算不同类别的商品价格小于等于当前商品价格的比例</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>mysql&gt; SELECT CUME_DIST() OVER (PARTITION BY category_id ORDER BY price ASC) AS &#x27;cd_%&#x27;,
</span></span><span style="display:block;padding:0 1.25rem">    -&gt; id, category, NAME, price
</span><span style="display:block;padding:0 1.25rem">    -&gt; FROM goods;
</span><span style="display:block;padding:0 1.25rem">+---------------------+----+---------------------+-----------------+---------+
</span><span style="display:block;padding:0 1.25rem">| cd_%                | id | category            | NAME            | price   |
</span><span style="display:block;padding:0 1.25rem">+---------------------+----+---------------------+-----------------+---------+
</span><span style="display:block;padding:0 1.25rem">| 0.16666666666666666 | 11 | 女装/女士精品       | 百褶裙          |   29.90 |
</span><span style="display:block;padding:0 1.25rem">|  0.3333333333333333 |  1 | 女装/女士精品       | T恤             |   39.90 |
</span><span style="display:block;padding:0 1.25rem">|                 0.5 |  2 | 女装/女士精品       | 连衣裙          |   79.90 |
</span><span style="display:block;padding:0 1.25rem">|  0.8333333333333334 |  5 | 女装/女士精品       | 牛仔裤          |   89.90 |
</span><span style="display:block;padding:0 1.25rem">|  0.8333333333333334 |  9 | 女装/女士精品       | 卫衣            |   89.90 |
</span><span style="display:block;padding:0 1.25rem">|                   1 |  7 | 女装/女士精品       | 呢绒外套        |  399.90 |
</span><span style="display:block;padding:0 1.25rem">| 0.16666666666666666 |  3 | 户外运动            | 登山杖          |   59.90 |
</span><span style="display:block;padding:0 1.25rem">|                 0.5 |  4 | 户外运动            | 骑行装备        |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|                 0.5 |  8 | 户外运动            | 自行车          |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|  0.6666666666666666 | 12 | 户外运动            | 滑板            |  499.90 |
</span><span style="display:block;padding:0 1.25rem">|  0.8333333333333334 |  6 | 户外运动            | 运动外套        |  799.90 |
</span><span style="display:block;padding:0 1.25rem">|                   1 | 10 | 户外运动            | 山地自行车      | 1399.90 |
</span><span style="display:block;padding:0 1.25rem">+---------------------+----+---------------------+-----------------+---------+
</span><span style="display:block;padding:0 1.25rem">12 rows in set (0.00 sec)</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul>
<h3 id="1825-前后函数" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.2.5 前后函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#1825-前后函数">#</a></h3>
<p class="my-4 leading-7">也称<!-- -->偏移量函数</p>
<h5 id="-lagexpr函数" class="title_3b154">① LAG(expr)函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#-lagexpr函数">#</a></h5>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">语法：<code>LAG(expr[,n, [default]]) OVER ([PARTITION BY 字段1 ORDER BY 字段名2 ASC|DESC])</code></p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">含义：查询当前记录的<strong class="font-semibold">往前数</strong>第n个expr的值。参数说明如下：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><code>expr</code>：必填。表示当前记录的哪个字段</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>n</code>：选填。默认为1</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>default</code>：选填。默认为null。表示当前行如果是当前分区内第一条则显示default值。</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">举例：查询商品id为1的商品销售额，并计算当天销售额与<em>前1天</em>销售额的差值</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>mysql&gt; SELECT g.id, g.`NAME`, g.category, t.sale_date, t.sales_sum,
</span></span><span style="display:block;padding:0 1.25rem">    -&gt; (t.sales_sum - LAG(t.sales_sum, 1, 0) OVER (PARTITION BY t.goods_id ORDER BY sale_date ASC)) diff_sales_num
</span><span style="display:block;padding:0 1.25rem">    -&gt; FROM goods g
</span><span style="display:block;padding:0 1.25rem">    -&gt; LEFT JOIN (
</span><span style="display:block;padding:0 1.25rem">    -&gt; SELECT goods_id, DATE_FORMAT(create_time, &#x27;%Y-%m-%d&#x27;) sale_date, SUM(sales) sales_sum
</span><span style="display:block;padding:0 1.25rem">    -&gt; FROM sale_log
</span><span style="display:block;padding:0 1.25rem">    -&gt; GROUP BY goods_id, DATE_FORMAT(create_time, &#x27;%Y-%m-%d&#x27;)
</span><span style="display:block;padding:0 1.25rem">    -&gt; ) t ON t.goods_id = g.id
</span><span style="display:block;padding:0 1.25rem">    -&gt; WHERE g.id = 1;
</span><span style="display:block;padding:0 1.25rem">+----+------+---------------------+------------+-----------+----------------+
</span><span style="display:block;padding:0 1.25rem">| id | NAME | category            | sale_date  | sales_sum | diff_sales_num |
</span><span style="display:block;padding:0 1.25rem">+----+------+---------------------+------------+-----------+----------------+
</span><span style="display:block;padding:0 1.25rem">|  1 | T恤  | 女装/女士精品       | 2020-11-10 |         5 |              5 |
</span><span style="display:block;padding:0 1.25rem">|  1 | T恤  | 女装/女士精品       | 2020-11-11 |         1 |             -4 |
</span><span style="display:block;padding:0 1.25rem">|  1 | T恤  | 女装/女士精品       | 2020-11-12 |         1 |              0 |
</span><span style="display:block;padding:0 1.25rem">|  1 | T恤  | 女装/女士精品       | 2020-11-13 |         3 |              2 |
</span><span style="display:block;padding:0 1.25rem">+----+------+---------------------+------------+-----------+----------------+
</span><span style="display:block;padding:0 1.25rem">4 rows in set (0.00 sec)</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul>
<h5 id="-leadexpr函数" class="title_3b154">② LEAD(expr)函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#-leadexpr函数">#</a></h5>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">语法：<code>LEAD(expr[,n, [default]]) OVER ([PARTITION BY 字段1 ORDER BY 字段名2 ASC|DESC])</code></li>
<li class="[&amp;:not(:first-child)]:mt-2">含义：查询当前记录的<strong class="font-semibold">往后数</strong>第n个expr的值。参数说明如下：<!-- -->
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><code>expr</code>：必填。表示当前记录的哪个字段</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>n</code>：选填。默认为1</li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>default</code>：选填。默认为null。表示当前行如果是当前分区内最后一条则显示default值。</li>
</ul>
</li>
</ul>
<h3 id="1826-首尾函数" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.2.6 首尾函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#1826-首尾函数">#</a></h3>
<h5 id="-first_valueexpr函数" class="title_3b154">① FIRST_VALUE(expr)函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#-first_valueexpr函数">#</a></h5>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">语法：<code>FIRST_VALUE(expr) OVER ([PARTITION BY 字段1 ORDER BY 字段名2 ASC|DESC])</code></p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">含义：返回当前分组（排序后）的<strong class="font-semibold">第一个值</strong></p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">举例：查询商品id为1的商品销售额，并计算当天销售额与<em>最大</em>销售额的差值</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>mysql&gt; SELECT g.id, g.`NAME`, g.category, t.sale_date, t.sales_sum,
</span></span><span style="display:block;padding:0 1.25rem">    -&gt; (FIRST_VALUE(t.sales_sum) OVER (PARTITION BY t.goods_id ORDER BY sales_sum DESC) - t.sales_sum) diff_sales_num
</span><span style="display:block;padding:0 1.25rem">    -&gt; FROM goods g
</span><span style="display:block;padding:0 1.25rem">    -&gt; LEFT JOIN (
</span><span style="display:block;padding:0 1.25rem">    -&gt; SELECT goods_id, DATE_FORMAT(create_time, &#x27;%Y-%m-%d&#x27;) sale_date, SUM(sales) sales_sum
</span><span style="display:block;padding:0 1.25rem">    -&gt; FROM sale_log
</span><span style="display:block;padding:0 1.25rem">    -&gt; GROUP BY goods_id, DATE_FORMAT(create_time, &#x27;%Y-%m-%d&#x27;)
</span><span style="display:block;padding:0 1.25rem">    -&gt; ) t ON t.goods_id = g.id
</span><span style="display:block;padding:0 1.25rem">    -&gt; WHERE g.id = 1;
</span><span style="display:block;padding:0 1.25rem">+----+------+---------------------+------------+-----------+----------------+
</span><span style="display:block;padding:0 1.25rem">| id | NAME | category            | sale_date  | sales_sum | diff_sales_num |
</span><span style="display:block;padding:0 1.25rem">+----+------+---------------------+------------+-----------+----------------+
</span><span style="display:block;padding:0 1.25rem">|  1 | T恤  | 女装/女士精品       | 2020-11-10 |         5 |              0 |
</span><span style="display:block;padding:0 1.25rem">|  1 | T恤  | 女装/女士精品       | 2020-11-13 |         3 |              2 |
</span><span style="display:block;padding:0 1.25rem">|  1 | T恤  | 女装/女士精品       | 2020-11-11 |         1 |              4 |
</span><span style="display:block;padding:0 1.25rem">|  1 | T恤  | 女装/女士精品       | 2020-11-12 |         1 |              4 |
</span><span style="display:block;padding:0 1.25rem">+----+------+---------------------+------------+-----------+----------------+
</span><span style="display:block;padding:0 1.25rem">4 rows in set (0.00 sec)</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul>
<h5 id="-last_valueexpr函数" class="title_3b154">② LAST_VALUE(expr)函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#-last_valueexpr函数">#</a></h5>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">语法：<code>LAST_VALUE(expr) OVER ([PARTITION BY 字段1 ORDER BY 字段名2 ASC|DESC])</code></li>
<li class="[&amp;:not(:first-child)]:mt-2">含义：返回当前分组（排序后）的<strong class="font-semibold">最后一个值</strong></li>
</ul>
<h3 id="1827-聚合函数" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.2.7 聚合函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#1827-聚合函数">#</a></h3>
<p class="my-4 leading-7">聚合函数：<code>SUM()</code>、<code>AVG()</code>、<code>COUNT()</code>、<code>MIN()</code>、<code>MAX()</code></p>
<p class="my-4 leading-7">举例：以SUM()为例，查询商品每天销售额</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>mysql&gt; SELECT DISTINCT sl.goods_id, g.`NAME`, DATE_FORMAT(sl.create_time, &#x27;%Y-%m-%d&#x27;) sale_date,
</span></span><span style="display:block;padding:0 1.25rem">    -&gt; SUM(sl.sales) OVER (PARTITION BY sl.goods_id, DATE_FORMAT(sl.create_time, &#x27;%Y-%m-%d&#x27;)) sales_sum
</span><span style="display:block;padding:0 1.25rem">    -&gt; FROM sale_log sl
</span><span style="display:block;padding:0 1.25rem">    -&gt; LEFT JOIN goods g ON g.id = sl.goods_id;
</span><span style="display:block;padding:0 1.25rem">+----------+-----------------+------------+-----------+
</span><span style="display:block;padding:0 1.25rem">| goods_id | NAME            | sale_date  | sales_sum |
</span><span style="display:block;padding:0 1.25rem">+----------+-----------------+------------+-----------+
</span><span style="display:block;padding:0 1.25rem">|        1 | T恤             | 2020-11-10 |         5 |
</span><span style="display:block;padding:0 1.25rem">|        1 | T恤             | 2020-11-11 |         1 |
</span><span style="display:block;padding:0 1.25rem">|        1 | T恤             | 2020-11-12 |         1 |
</span><span style="display:block;padding:0 1.25rem">|        1 | T恤             | 2020-11-13 |         3 |
</span><span style="display:block;padding:0 1.25rem">|        2 | 连衣裙          | 2020-11-10 |         1 |
</span><span style="display:block;padding:0 1.25rem">|        2 | 连衣裙          | 2020-11-11 |         1 |
</span><span style="display:block;padding:0 1.25rem">|       10 | 山地自行车      | 2020-11-15 |         2 |
</span><span style="display:block;padding:0 1.25rem">+----------+-----------------+------------+-----------+
</span><span style="display:block;padding:0 1.25rem">7 rows in set (0.00 sec)</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<h3 id="1828-其他函数" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.2.8 其他函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#1828-其他函数">#</a></h3>
<h5 id="-nth_valueexprn函数" class="title_3b154">① NTH_VALUE(expr,n)函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#-nth_valueexprn函数">#</a></h5>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">语法：<code>NTH_VALUE(expr,n) OVER ([PARTITION BY 字段1 ORDER BY 字段名2 ASC|DESC])</code></p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">含义：返回第n条记录的expr值</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">举例：查询goods中商品信息，并计算不同商品类型中排名第2高的价格信息</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>mysql&gt; SELECT id, category, NAME, price,
</span></span><span style="display:block;padding:0 1.25rem">    -&gt; NTH_VALUE(price,2) OVER (PARTITION BY category_id ORDER BY price DESC) AS second_price
</span><span style="display:block;padding:0 1.25rem">    -&gt; FROM goods;
</span><span style="display:block;padding:0 1.25rem">+----+---------------------+-----------------+---------+--------------+
</span><span style="display:block;padding:0 1.25rem">| id | category            | NAME            | price   | second_price |
</span><span style="display:block;padding:0 1.25rem">+----+---------------------+-----------------+---------+--------------+
</span><span style="display:block;padding:0 1.25rem">|  7 | 女装/女士精品       | 呢绒外套        |  399.90 |         NULL |
</span><span style="display:block;padding:0 1.25rem">|  5 | 女装/女士精品       | 牛仔裤          |   89.90 |        89.90 |
</span><span style="display:block;padding:0 1.25rem">|  9 | 女装/女士精品       | 卫衣            |   89.90 |        89.90 |
</span><span style="display:block;padding:0 1.25rem">|  2 | 女装/女士精品       | 连衣裙          |   79.90 |        89.90 |
</span><span style="display:block;padding:0 1.25rem">|  1 | 女装/女士精品       | T恤             |   39.90 |        89.90 |
</span><span style="display:block;padding:0 1.25rem">| 11 | 女装/女士精品       | 百褶裙          |   29.90 |        89.90 |
</span><span style="display:block;padding:0 1.25rem">| 10 | 户外运动            | 山地自行车      | 1399.90 |         NULL |
</span><span style="display:block;padding:0 1.25rem">|  6 | 户外运动            | 运动外套        |  799.90 |       799.90 |
</span><span style="display:block;padding:0 1.25rem">| 12 | 户外运动            | 滑板            |  499.90 |       799.90 |
</span><span style="display:block;padding:0 1.25rem">|  4 | 户外运动            | 骑行装备        |  399.90 |       799.90 |
</span><span style="display:block;padding:0 1.25rem">|  8 | 户外运动            | 自行车          |  399.90 |       799.90 |
</span><span style="display:block;padding:0 1.25rem">|  3 | 户外运动            | 登山杖          |   59.90 |       799.90 |
</span><span style="display:block;padding:0 1.25rem">+----+---------------------+-----------------+---------+--------------+
</span><span style="display:block;padding:0 1.25rem">12 rows in set (0.00 sec)</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul>
<h5 id="-ntilen函数" class="title_3b154">② NTILE(n)函数<a class="link_3b154 header-anchor" aria-hidden="true" href="#-ntilen函数">#</a></h5>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">语法：<code>NTILE(n) OVER ([PARTITION BY 字段1 ORDER BY 字段名2 ASC|DESC])</code></p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">含义：在每个分组中，将数据分为n个桶（组），并记录桶编号</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">举例：查询goods中商品信息，并将不同商品类型中的商品按照价格降序分为3个桶（组）</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>mysql&gt; select NTILE(3) OVER (PARTITION BY category_id ORDER BY price DESC) AS num,
</span></span><span style="display:block;padding:0 1.25rem">    -&gt; id, `NAME`, category, price
</span><span style="display:block;padding:0 1.25rem">    -&gt; FROM goods;
</span><span style="display:block;padding:0 1.25rem">+------+----+-----------------+---------------------+---------+
</span><span style="display:block;padding:0 1.25rem">| num  | id | NAME            | category            | price   |
</span><span style="display:block;padding:0 1.25rem">+------+----+-----------------+---------------------+---------+
</span><span style="display:block;padding:0 1.25rem">|    1 |  7 | 呢绒外套        | 女装/女士精品       |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|    1 |  5 | 牛仔裤          | 女装/女士精品       |   89.90 |
</span><span style="display:block;padding:0 1.25rem">|    2 |  9 | 卫衣            | 女装/女士精品       |   89.90 |
</span><span style="display:block;padding:0 1.25rem">|    2 |  2 | 连衣裙          | 女装/女士精品       |   79.90 |
</span><span style="display:block;padding:0 1.25rem">|    3 |  1 | T恤             | 女装/女士精品       |   39.90 |
</span><span style="display:block;padding:0 1.25rem">|    3 | 11 | 百褶裙          | 女装/女士精品       |   29.90 |
</span><span style="display:block;padding:0 1.25rem">|    1 | 10 | 山地自行车      | 户外运动            | 1399.90 |
</span><span style="display:block;padding:0 1.25rem">|    1 |  6 | 运动外套        | 户外运动            |  799.90 |
</span><span style="display:block;padding:0 1.25rem">|    2 | 12 | 滑板            | 户外运动            |  499.90 |
</span><span style="display:block;padding:0 1.25rem">|    2 |  4 | 骑行装备        | 户外运动            |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|    3 |  8 | 自行车          | 户外运动            |  399.90 |
</span><span style="display:block;padding:0 1.25rem">|    3 |  3 | 登山杖          | 户外运动            |   59.90 |
</span><span style="display:block;padding:0 1.25rem">+------+----+-----------------+---------------------+---------+
</span><span style="display:block;padding:0 1.25rem">12 rows in set (0.00 sec)</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul>
<h3 id="1829--window语法的使用" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.2.9  WINDOW语法的使用<a class="link_3b154 header-anchor" aria-hidden="true" href="#1829--window语法的使用">#</a></h3>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">18.2.8-②例子可改写为：</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>SELECT DISTINCT sl.goods_id, g.`NAME`, DATE_FORMAT(sl.create_time, &#x27;%Y-%m-%d&#x27;) sale_date, 
</span></span><span style="display:block;padding:0 1.25rem">	SUM(sl.sales) OVER w_sales_sum_cal sales_sum
</span><span style="display:block;padding:0 1.25rem">FROM sale_log sl
</span><span style="display:block;padding:0 1.25rem">LEFT JOIN goods g ON g.id = sl.goods_id
</span><span style="display:block;padding:0 1.25rem">WINDOW w_sales_sum_cal AS (PARTITION BY sl.goods_id, DATE_FORMAT(sl.create_time, &#x27;%Y-%m-%d&#x27;));</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">18.2.4-①例子可改写为：</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>SELECT RANK() OVER w_price_desc_rank AS r,
</span></span><span style="display:block;padding:0 1.25rem">	PERCENT_RANK() OVER w_price_desc_rank AS &#x27;pr_%&#x27;,
</span><span style="display:block;padding:0 1.25rem">	id, category_id, category, NAME, price, stock
</span><span style="display:block;padding:0 1.25rem">FROM goods
</span><span style="display:block;padding:0 1.25rem">-- WHERE category_id = 1 # 如果有where条件，where条件需要写在WINDOW语句之前
</span><span style="display:block;padding:0 1.25rem">WINDOW w_price_desc_rank AS (PARTITION BY category_id ORDER BY price DESC);</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul>
<h3 id="18210-小结-窗口函数的特点" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.2.10 小结-窗口函数的特点<a class="link_3b154 header-anchor" aria-hidden="true" href="#18210-小结-窗口函数的特点">#</a></h3>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">窗口函数可以对数据进行分组，并且可以在组内排序</li>
<li class="[&amp;:not(:first-child)]:mt-2">窗口函数不会因分组而减少原表中的行数</li>
</ul>
<h3 id="1829-测试中用到的表及数据" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.2.9 测试中用到的表及数据<a class="link_3b154 header-anchor" aria-hidden="true" href="#1829-测试中用到的表及数据">#</a></h3>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span># 创建goods表
</span></span><span style="display:block;padding:0 1.25rem">CREATE TABLE goods(
</span><span style="display:block;padding:0 1.25rem">	id INT PRIMARY KEY AUTO_INCREMENT,
</span><span style="display:block;padding:0 1.25rem">	category_id INT,
</span><span style="display:block;padding:0 1.25rem">	category VARCHAR(15),
</span><span style="display:block;padding:0 1.25rem">	NAME VARCHAR(30),
</span><span style="display:block;padding:0 1.25rem">	price DECIMAL(10,2),
</span><span style="display:block;padding:0 1.25rem">	stock INT,
</span><span style="display:block;padding:0 1.25rem">	upper_time DATETIME
</span><span style="display:block;padding:0 1.25rem">);
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">INSERT INTO goods(category_id,category,NAME,price,stock,upper_time)
</span><span style="display:block;padding:0 1.25rem">VALUES
</span><span style="display:block;padding:0 1.25rem">(1, &#x27;女装/女士精品&#x27;, &#x27;T恤&#x27;, 39.90, 1000, &#x27;2020-11-10 00:00:00&#x27;),
</span><span style="display:block;padding:0 1.25rem">(1, &#x27;女装/女士精品&#x27;, &#x27;连衣裙&#x27;, 79.90, 2500, &#x27;2020-11-10 00:00:00&#x27;),
</span><span style="display:block;padding:0 1.25rem">(2, &#x27;户外运动&#x27;, &#x27;登山杖&#x27;, 59.90, 1500, &#x27;2020-11-10 00:00:00&#x27;),
</span><span style="display:block;padding:0 1.25rem">(2, &#x27;户外运动&#x27;, &#x27;骑行装备&#x27;, 399.90, 3500, &#x27;2020-11-10 00:00:00&#x27;),
</span><span style="display:block;padding:0 1.25rem">(1, &#x27;女装/女士精品&#x27;, &#x27;牛仔裤&#x27;, 89.90, 3500, &#x27;2020-11-10 00:00:00&#x27;),
</span><span style="display:block;padding:0 1.25rem">(2, &#x27;户外运动&#x27;, &#x27;运动外套&#x27;, 799.90, 500, &#x27;2020-11-10 00:00:00&#x27;),
</span><span style="display:block;padding:0 1.25rem">(1, &#x27;女装/女士精品&#x27;, &#x27;呢绒外套&#x27;, 399.90, 1200, &#x27;2020-11-10 00:00:00&#x27;),
</span><span style="display:block;padding:0 1.25rem">(2, &#x27;户外运动&#x27;, &#x27;自行车&#x27;, 399.90, 1000, &#x27;2020-11-10 00:00:00&#x27;),
</span><span style="display:block;padding:0 1.25rem">(1, &#x27;女装/女士精品&#x27;, &#x27;卫衣&#x27;, 89.90, 1500, &#x27;2020-11-10 00:00:00&#x27;),
</span><span style="display:block;padding:0 1.25rem">(2, &#x27;户外运动&#x27;, &#x27;山地自行车&#x27;, 1399.90, 2500, &#x27;2020-11-10 00:00:00&#x27;),
</span><span style="display:block;padding:0 1.25rem">(1, &#x27;女装/女士精品&#x27;, &#x27;百褶裙&#x27;, 29.90, 500, &#x27;2020-11-10 00:00:00&#x27;),
</span><span style="display:block;padding:0 1.25rem">(2, &#x27;户外运动&#x27;, &#x27;滑板&#x27;, 499.90, 1200, &#x27;2020-11-10 00:00:00&#x27;);
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"># 创建销售记录表
</span><span style="display:block;padding:0 1.25rem">create table sale_log(
</span><span style="display:block;padding:0 1.25rem">	id int PRIMARY KEY auto_increment,
</span><span style="display:block;padding:0 1.25rem">	goods_id int,
</span><span style="display:block;padding:0 1.25rem">	sales int COMMENT &#x27;本次售出数量&#x27;,
</span><span style="display:block;padding:0 1.25rem">	create_time datetime
</span><span style="display:block;padding:0 1.25rem">);
</span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem">INSERT INTO `sale_log` VALUES (1, 1, 1, &#x27;2020-11-10 02:10:33&#x27;);
</span><span style="display:block;padding:0 1.25rem">INSERT INTO `sale_log` VALUES (2, 1, 4, &#x27;2020-11-10 12:10:33&#x27;);
</span><span style="display:block;padding:0 1.25rem">INSERT INTO `sale_log` VALUES (3, 1, 1, &#x27;2020-11-11 22:10:33&#x27;);
</span><span style="display:block;padding:0 1.25rem">INSERT INTO `sale_log` VALUES (4, 2, 1, &#x27;2020-11-10 22:10:33&#x27;);
</span><span style="display:block;padding:0 1.25rem">INSERT INTO `sale_log` VALUES (5, 2, 1, &#x27;2020-11-11 09:10:33&#x27;);
</span><span style="display:block;padding:0 1.25rem">INSERT INTO `sale_log` VALUES (6, 1, 1, &#x27;2020-11-12 11:11:13&#x27;);
</span><span style="display:block;padding:0 1.25rem">INSERT INTO `sale_log` VALUES (7, 1, 1, &#x27;2020-11-13 16:10:33&#x27;);
</span><span style="display:block;padding:0 1.25rem">INSERT INTO `sale_log` VALUES (8, 1, 2, &#x27;2020-11-13 17:50:33&#x27;);
</span><span style="display:block;padding:0 1.25rem">INSERT INTO `sale_log` VALUES (9, 10, 2, &#x27;2020-11-15 17:50:33&#x27;);</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<h2 id="183-新特性2-公用表表达式" class="mt-12 mb-6 pt-8 text-2xl tracking-tight border-t-[1px] border-divider-light title_3b154">18.3 新特性2-公用表表达式<a class="link_3b154 header-anchor" aria-hidden="true" href="#183-新特性2-公用表表达式">#</a></h2>
<blockquote class="border-l-2 border-solid border-divider pl-4 my-6 transition-colors duration-500 blockquote_3b154">
<p class="my-4 leading-7">概念</p>
</blockquote>
<blockquote class="border-l-2 border-solid border-divider pl-4 my-6 transition-colors duration-500 blockquote_3b154">
<p class="my-4 leading-7">分类</p>
</blockquote>
<p class="my-4 leading-7">按照<strong class="font-semibold">语法结构和执行方式</strong>的不同，可以分为两类：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><code>普通公用表表达式</code></li>
<li class="[&amp;:not(:first-child)]:mt-2"><code>递归公用表表达式</code></li>
</ul>
<h3 id="1831-普通公用表表达式" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.3.1 普通公用表表达式<a class="link_3b154 header-anchor" aria-hidden="true" href="#1831-普通公用表表达式">#</a></h3>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">语法：</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>WITH CTE名称
</span></span><span style="display:block;padding:0 1.25rem">AS (查询语句)
</span><span style="display:block;padding:0 1.25rem">SELECT|DELETE|UPDATE 语句;</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">举例：查询员工所在部门的详细信息。</p>
<p class="my-4 leading-7">因为有的部门没有员工，这些部门是不能显示的，所以不能直接返回部门表信息。</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>WITH cte_emps_dept_id
</span></span><span style="display:block;padding:0 1.25rem">AS (SELECT DISTINCT department_id FROM emps)
</span><span style="display:block;padding:0 1.25rem">SELECT d.*
</span><span style="display:block;padding:0 1.25rem">FROM depts d 
</span><span style="display:block;padding:0 1.25rem">LEFT JOIN cte_emps_dept_id c ON c.department_id = d.department_id</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul>
<h3 id="1832-递归公用表表达式" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.3.2 递归公用表表达式<a class="link_3b154 header-anchor" aria-hidden="true" href="#1832-递归公用表表达式">#</a></h3>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">语法：</p>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>WITH RECURSIVE CTE名称
</span></span><span style="display:block;padding:0 1.25rem">AS (查询语句①) 
</span><span style="display:block;padding:0 1.25rem">SELECT|DELETE|UPDATE 语句;</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><code>查询语句①</code>由两部分组成：</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><code>种子查询</code>：用来<strong class="font-semibold">获取递归的初始值</strong>。这个查询只运行一次，以创建初始数据集</p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><code>递归查询</code>：递归查询会一直执行，直到没有任何新的查询数据产生，递归返回。</p>
<p class="my-4 leading-7"><strong class="font-semibold">递归查询中，不用或慎用外连接，最好使用内连接（<code>[inner] join ... on</code>）</strong></p>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7"><strong class="font-semibold">二者通过关键字<code>UNION [ALL]</code>进行连接</strong></p>
</li>
</ul>
</li>
</ul>
</li>
<li class="[&amp;:not(:first-child)]:mt-2">
<p class="my-4 leading-7">举例：针对于我们常用的emps表，包含employee_id，last_name和manager_id三个字段。如果a是b 的管理者，那么，我们可以把b叫做a的下属，如果同时b又是c的管理者，那么c就是b的下属，是a的下下 属。 要求：使用递归公用表表达式查询出所有具有下下属身份的人员信息。</p>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">① 通过种子查询，获取公司最大领导，即第一层员工。使用n记录员工层级，第一层员工记n=1</li>
<li class="[&amp;:not(:first-child)]:mt-2">② 开始进行递归查询。查询出以公用表表达式中员工为领导的员工，并记录该层员工的n值为公用表表达式中的n值+1，递归返回</li>
<li class="[&amp;:not(:first-child)]:mt-2">③ 最后的查询，筛选出公用表表达式中属于下下属身份的员工，即n&gt;=3的员工</li>
</ul>
<div class="language-mysql"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-mysql" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>WITH RECURSIVE cte_emp
</span></span><span style="display:block;padding:0 1.25rem">AS (
</span><span style="display:block;padding:0 1.25rem">    -- 种子查询，获取第一层员工
</span><span style="display:block;padding:0 1.25rem">	SELECT employee_id, last_name, manager_id, 1 AS n FROM emps WHERE manager_id IS NULL 
</span><span style="display:block;padding:0 1.25rem">	UNION ALL 
</span><span style="display:block;padding:0 1.25rem">    -- 递归查询，获取每一层员工
</span><span style="display:block;padding:0 1.25rem">	SELECT e.employee_id, e.last_name, e.manager_id, cte_emp.n+1 
</span><span style="display:block;padding:0 1.25rem">    FROM emps e 
</span><span style="display:block;padding:0 1.25rem">    JOIN cte_emp ON cte_emp.employee_id = e.manager_id
</span><span style="display:block;padding:0 1.25rem">)
</span><span style="display:block;padding:0 1.25rem">SELECT * FROM cte_emp WHERE n &gt;= 3</span></code></pre></div><div class="code-button-group_15153"><button title="Toggle code wrap"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153" title="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
</li>
</ul>
<h3 id="1833-小结" class="mt-10 mb-2 leading-7 text-xl title_3b154">18.3.3 小结<a class="link_3b154 header-anchor" aria-hidden="true" href="#1833-小结">#</a></h3>
<p class="my-4 leading-7">公用表表达式的作用是可以替代子查询，而且可以被多次引用。递归公用表表达式对查询有一个共同根 节点的树形结构数据非常高效，可以轻松搞定其他查询方式难以处理的查询。</p><!--/$--></div><div class="rspress-doc-footer"><footer class="mt-8"><div class="xs:flex pb-5 px-2 justify-end items-center"></div><div class="flex flex-col"></div><div class="flex flex-col sm:flex-row sm:justify-around gap-4 pt-6"><div class="prev_e7091 flex flex-col"><a class="link_03735 pager-link_9b9a7 cursor-pointer" target="" href="/tang/mysql/17_触发器.html"><span class="desc_9b9a7">Previous Page</span><span class="title_9b9a7">17 触发器</span></a></div><div class="next_e7091 flex flex-col"><a class="link_03735 pager-link_9b9a7 next_9b9a7 cursor-pointer" target="" href="/tang/mysql/19_表及其数据.html"><span class="desc_9b9a7">Next Page</span><span class="title_9b9a7">19 附：表及其数据</span></a></div></div></footer></div></div></div><div class="aside-container_edeb4"><div><div class="flex flex-col"><div class="&lt;lg:hidden"><div id="aside-container" class="relative text-sm font-medium"><div class="leading-7 block text-sm font-semibold pl-3">ON THIS PAGE</div><nav class="mt-1"><ul class="relative"><li><a href="#181-mysql800新特性概述" title="18.1 MySQL80.0新特性概述" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">18.1 MySQL80.0新特性概述</span></a></li><li><a href="#1811-mysql80新增特性" title="18.1.1 MySQL8.0新增特性" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.1.1 MySQL8.0新增特性</span></a></li><li><a href="#1812-mysql80移除的就特性" title="18.1.2 MySQL8.0移除的就特性" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.1.2 MySQL8.0移除的就特性</span></a></li><li><a href="#182-新特性1-窗口函数" title="18.2 新特性1-窗口函数" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">18.2 新特性1-窗口函数</span></a></li><li><a href="#1821-概述" title="18.2.1 概述" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.2.1 概述</span></a></li><li><a href="#1822-语法" title="18.2.2 语法" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.2.2 语法</span></a></li><li><a href="#1823-序号函数" title="18.2.3 序号函数" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.2.3 序号函数</span></a></li><li><a href="#1824-分布函数" title="18.2.4 分布函数" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.2.4 分布函数</span></a></li><li><a href="#1825-前后函数" title="18.2.5 前后函数" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.2.5 前后函数</span></a></li><li><a href="#1826-首尾函数" title="18.2.6 首尾函数" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.2.6 首尾函数</span></a></li><li><a href="#1827-聚合函数" title="18.2.7 聚合函数" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.2.7 聚合函数</span></a></li><li><a href="#1828-其他函数" title="18.2.8 其他函数" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.2.8 其他函数</span></a></li><li><a href="#1829--window语法的使用" title="18.2.9  WINDOW语法的使用" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.2.9  WINDOW语法的使用</span></a></li><li><a href="#18210-小结-窗口函数的特点" title="18.2.10 小结-窗口函数的特点" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.2.10 小结-窗口函数的特点</span></a></li><li><a href="#1829-测试中用到的表及数据" title="18.2.9 测试中用到的表及数据" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.2.9 测试中用到的表及数据</span></a></li><li><a href="#183-新特性2-公用表表达式" title="18.3 新特性2-公用表表达式" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:0;font-weight:semibold"><span class="aside-link-text block">18.3 新特性2-公用表表达式</span></a></li><li><a href="#1831-普通公用表表达式" title="18.3.1 普通公用表表达式" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.3.1 普通公用表表达式</span></a></li><li><a href="#1832-递归公用表表达式" title="18.3.2 递归公用表表达式" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.3.2 递归公用表表达式</span></a></li><li><a href="#1833-小结" title="18.3.3 小结" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="margin-left:12px;font-weight:semibold"><span class="aside-link-text block">18.3.3 小结</span></a></li></ul></nav></div></div></div></div></div></div></div></section></div></div>
  <div id="search-container"></div>
</body>

</html>
