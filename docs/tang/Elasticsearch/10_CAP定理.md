# 10 CAP定理

## 10.1 概念

* CAP定理，又称布鲁尔定理

* C(Consistency)：一致性。指数据在多个副本之间能够保持一致的特性，在同一时刻是否具有同样的值。
    一致性，可以分为强一致性和弱一致性。
    * 强一致性：在任意时刻，所有节点中的数据都保持一致性。
    * 弱一致性：数据更新后，如果能容忍短时间内的访问只能访问到部分或者全部访问不到，就是弱一致性。最终一致性就属于弱一致性。
    
* A(Avaliablity)：可用性。指系统提供的服务必须一直处于可用状态。每次只要收到用户的请求，服务器就必须给出回应。在合理的时间内返回合理的相应（不是错误和超时的响应）。保证服务的可用性，就是搭建集群。
                
* P(Partition tolerance)：在分布式系统中，不同的节点分布在不同的子网络中，由于一些特殊的原因，这些子节点之间出现了网络不通的状态，但是他们的内部子网络是正常的。从而导致了整个系统的环境被切分成了若干个孤立的分区。分区容错的意思是，区间通信可能失败。

* CAP原则的精髓就是要么AP，要么CP，要么AC，但是不存在CAP

## 10.2 CAP取舍策略

**CAP原则的精髓就是要么AP，要么CP，要么AC，但是不存在CAP。**

| 策略 | 分析结果                                                     |
| ------- | ------------------------------------------------------------ |
| CA      | 满足一致性和可用性，放弃分区容错。说白了，就是一个整体应用，不是分布式应用 |
| CP      | 满足一致性和分区容错性，放弃可用性。当系统被分区，为了保证一致性，必须放弃可用性，让系统停掉。如银行系统 |
| AP      | 满足可用性和分区容错性，放弃一致性。当系统被分区，为了保证可用性，就必须让节点继续对外服务，这就意味着失去一致性。分布式系统中最常用策略。 |