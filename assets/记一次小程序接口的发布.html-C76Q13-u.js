import{_ as s,o as n,c as a,b as e}from"./app-CQavEA7Q.js";const l="/assets/aliyun_home-VCtVezM0.png",i="/assets/domain_buy-CebEC1vC.png",p="/assets/domain_list-CSmpRMEg.png",t="/assets/domain_list_analysis-BM-GGYJ_.png",c="/assets/domain_analysis-3xMq6NFY.png",r="/assets/domain_dv_apply-Bo832Eoc.png",o="/assets/ssl_creat-F-WEQPuX.png",d="/assets/ssl_apply-6AYmV7PY.png",u="/assets/ssl_download-q5tto1wV.png",m="/assets/ssl_project_path-CETKU14B.png",v="/assets/ssl_download_nginx-BeOHfVdN.png",b="/assets/ssl_project_path_nginx-B3svihw8.png",h="/assets/nginx_tar-BqMuIVQ8.png",g="/assets/nginx_install_path-C5UZyT-8.png",_="/assets/nginx_install_result-DqpSah8p.png",k="/assets/nginx_run_result-Dx8SS7gO.png",x={},q=e('<h1 id="记一次小程序接口的发布" tabindex="-1"><a class="header-anchor" href="#记一次小程序接口的发布"><span>记一次小程序接口的发布</span></a></h1><h2 id="_0-前言" tabindex="-1"><a class="header-anchor" href="#_0-前言"><span>0 前言</span></a></h2><p>本文是记录某个小程序后台接口的部署全过程。</p><p>因为小程序需要使用https的域名，所以，本文内容包括域名的申请、域名的解析、免费https证书的申请与配置。</p><h2 id="_1-申请域名" tabindex="-1"><a class="header-anchor" href="#_1-申请域名"><span>1 申请域名</span></a></h2><p>本文是在阿里云申请的域名，具体操作如下：</p><blockquote><p>Step1. 进入域名注册页面</p></blockquote><p>在阿里云官网搜索“域名”，在弹出框的下拉列表中点击“域名注册”，跳转到域名注册页面。</p><p>或者，直接通过网址进入<a href="https://wanwang.aliyun.com/domain?spm=5176.28055625.J_3207526240.11.1d01154acqHumI&amp;scm=20140722.S_function@@product@@999997._.ID_function@@product@@999997-RL_%E5%9F%9F%E5%90%8D-LOC_bar-OR_ser-V_2-P0_0" target="_blank" rel="noopener noreferrer">域名注册</a>页面。</p><p><img src="'+l+'" alt=""></p><blockquote><p>Step2. 选择域名，进行购买</p></blockquote><p><img src="'+i+'" alt=""></p><blockquote><p>Step3. 查看已购买的域名</p></blockquote><p><img src="'+p+'" alt=""></p><h2 id="_2-域名备案" tabindex="-1"><a class="header-anchor" href="#_2-域名备案"><span>2 域名备案</span></a></h2><p>因为我的域名和服务器都是阿里云的，所以在阿里云上备案，备案地址为：<a href="https://beian.aliyun.com/?spm=a2cmq.17630005.icp_beian.1.1fa579feAWYL4C" target="_blank" rel="noopener noreferrer">阿里云网站备案</a></p><p>具体操作按照按照网页上的表单填写即可。</p><h2 id="_3-域名解析" tabindex="-1"><a class="header-anchor" href="#_3-域名解析"><span>3 域名解析</span></a></h2><blockquote><p>Step1. 在域名列表页面，点击“解析”，进入域名解析页面</p></blockquote><p><img src="'+t+'" alt=""></p><blockquote><p>Step2. 解析域名</p></blockquote><p><img src="'+c+'" alt=""></p><h2 id="_4-申请免费https证书" tabindex="-1"><a class="header-anchor" href="#_4-申请免费https证书"><span>4 申请免费https证书</span></a></h2><p><strong>说明：</strong> 免费证书一般仅用于个人网站或测试使用，不建议业务成熟的企业类型网站使用。</p><p>每个经过实名认证的阿里云账号（主账号），在每一个自然年内，可以通过数字证书管理服务的免费证书购买页，免费获取20个DV单域名证书【免费试用】（<a href="https://help.aliyun.com/document_detail/205510.html?spm=a2c4g.365559.0.i1" target="_blank" rel="noopener noreferrer">参考文档</a>）。</p><p>因此，申请免费https证书，需要先申请20个DV单域名证书，然后在“数字证书管理服务”中创建证书、申请证书、下载证书等。</p><blockquote><p>Step1. 申请DV单域名证书</p></blockquote><p><a href="https://common-buy.aliyun.com/?spm=a2c4g.205510.0.0.15edae8aJJkb83&amp;commodityCode=cas_dv_public_cn&amp;request=%7B%22product%22%3A%22free_product%22%7D" target="_blank" rel="noopener noreferrer">申请DV单域名证书链接</a></p><p><img src="'+r+'" alt=""></p><blockquote><p>Step2. 创建证书</p></blockquote><p>在【数字证书管理服务】-【SSL证书】-【免费证书】标签中，创建证书。</p><p><img src="'+o+'" alt=""></p><blockquote><p>Step3. 证书申请</p></blockquote><p><img src="'+d+'" alt=""></p><blockquote><p>Step4. 证书审核</p></blockquote><p>官方说，证书审核需要1~2个工作日，但是我申请的两个10分钟之内就通过了，所以可以稍微耐心等待下。审核通过之后会有短信和邮件通知。</p><h2 id="_5-配置https证书" tabindex="-1"><a class="header-anchor" href="#_5-配置https证书"><span>5 配置https证书</span></a></h2><h3 id="_5-1-配置tomcat类型服务器的证书" tabindex="-1"><a class="header-anchor" href="#_5-1-配置tomcat类型服务器的证书"><span>5.1 配置Tomcat类型服务器的证书</span></a></h3><p><strong>说明：</strong> 因为小程序接口是SpringBoot项目，所以尝试配置一次Tomcat类型服务器的证书。</p><blockquote><p>Step1. 下载Tomcat服务器对应的证书</p></blockquote><p><img src="'+u+'" alt=""></p><blockquote><p>Step2. 将证书放到项目的resources文件夹下</p></blockquote><p><img src="'+m+`" alt=""></p><blockquote><p>Step3. 在项目的application.yaml配置文件中，添加如下配置</p></blockquote><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">7878</span> <span class="token comment"># 项目端口号</span></span>
<span class="line">  <span class="token key atrule">ssl</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">key-alias</span><span class="token punctuation">:</span> alias <span class="token comment">#证书别名</span></span>
<span class="line">    <span class="token key atrule">key-store-password</span><span class="token punctuation">:</span> 6es4fnd2 <span class="token comment">#证书密码，可以在pfx-password.txt文件中查看</span></span>
<span class="line">    <span class="token key atrule">key-store-type</span><span class="token punctuation">:</span> PKCS12</span>
<span class="line">    <span class="token key atrule">key-store</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>&lt;your domain<span class="token punctuation">&gt;</span>.pfx <span class="token comment"># 证书文件</span></span>
<span class="line">  <span class="token key atrule">servlet</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /drive</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>证书别名查看命令</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># 进入jre\\\\lib\\\\security文件夹</span></span>
<span class="line"><span class="token builtin class-name">cd</span> D:<span class="token punctuation">\\</span><span class="token punctuation">\\</span>soft<span class="token punctuation">\\</span><span class="token punctuation">\\</span>java8<span class="token punctuation">\\</span><span class="token punctuation">\\</span>jre<span class="token punctuation">\\</span><span class="token punctuation">\\</span>lib<span class="token punctuation">\\</span><span class="token punctuation">\\</span>security</span>
<span class="line"><span class="token comment"># 查看证书别名</span></span>
<span class="line">keytool <span class="token parameter variable">-list</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-keystore</span> 证书所在文件夹<span class="token punctuation">\\</span><span class="token punctuation">\\</span>证书名.pfx <span class="token parameter variable">-storepass</span> 6es4fnd2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Step4. 项目启动与测试</p></blockquote><p>将项目打包，上传至服务器并运行。项目运行成功后，浏览器访问 【 https://域名 】 。如果能有应答，表示https设置完成。</p><h3 id="_5-2-配置nginx类型服务器的证书" tabindex="-1"><a class="header-anchor" href="#_5-2-配置nginx类型服务器的证书"><span>5.2 配置nginx类型服务器的证书</span></a></h3><blockquote><p>Step1. 下载Nginx服务器对应的证书</p></blockquote><p><img src="`+v+'" alt=""></p><blockquote><p>Step2. 上传nginx证书到服务器</p></blockquote><p>在nginx安装路径下，新建cert文件夹，将nginx证书上传至该文件夹</p><p><img src="'+b+`" alt=""></p><blockquote><p>Step3. 配置nginx</p></blockquote><p>我的nginx版本号是1.22.0。低于1.15.0版本号的，需要将<code>listen 443 ssl;</code>替换成<code>listen 443; ssl on;</code>。</p><div class="language-conf line-numbers-mode" data-highlighter="prismjs" data-ext="conf" data-title="conf"><pre class="language-conf"><code><span class="line">server {</span>
<span class="line">        listen       80;</span>
<span class="line">        server_name api.drive.lyctth.top;</span>
<span class="line">        #将所有HTTP请求通过rewrite指令重定向到HTTPS。</span>
<span class="line">        rewrite ^(.*)$ https://$host$1 permanent;</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    server {</span>
<span class="line">        listen       443 ssl;</span>
<span class="line">        server_name  api.drive.lyctth.top;</span>
<span class="line"></span>
<span class="line">        ssl_certificate  /usr/nginx/1.22.0/cert/证书.pem;</span>
<span class="line">        ssl_certificate_key /usr/nginx/1.22.0/cert/证书.key;</span>
<span class="line"></span>
<span class="line">        ssl_session_cache    shared:SSL:1m;</span>
<span class="line">        ssl_session_timeout  5m;</span>
<span class="line"></span>
<span class="line">        ssl_ciphers  HIGH:!aNULL:!MD5;</span>
<span class="line">        ssl_prefer_server_ciphers  on;</span>
<span class="line"></span>
<span class="line">        location /drive/ {</span>
<span class="line">          proxy_pass http://127.0.0.1:7878/drive/;</span>
<span class="line">          proxy_http_version 1.1;</span>
<span class="line">    			proxy_set_header Upgrade $http_upgrade;</span>
<span class="line">    			proxy_set_header Connection &quot;upgrade&quot;;</span>
<span class="line">      }</span>
<span class="line">    }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Step4. 测试</p></blockquote><p>启动nginx，浏览器访问 【 https://域名 】 。如果能有应答，表示https设置完成</p><h2 id="附-nginx的安装" tabindex="-1"><a class="header-anchor" href="#附-nginx的安装"><span>附：nginx的安装</span></a></h2><blockquote><p>Step1. 下载nginx安装包</p></blockquote><p><a href="https://nginx.org/en/download.html" target="_blank" rel="noopener noreferrer">nginx下载地址</a></p><blockquote><p>Step2. 上传nginx安装包到服务器并解压</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># 解压命令</span></span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> nginx-1.22.0.tar.gz</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+h+`" alt=""></p><blockquote><p>Step3. 创建文件夹，作为nginx的安装路径</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">mkdir</span> /usr/nginx/1.22.0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+g+`" alt=""></p><blockquote><p>Step4. 安装</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># 进入/usr/tth/nginx-1.14.2/目录</span></span>
<span class="line"><span class="token builtin class-name">cd</span> /usr/nginx/nginx-1.22.0/</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 配置nginx</span></span>
<span class="line"><span class="token comment"># 注意：一定要加上--with-http_ssl_module选项，否则在配置https时，nginx配置文件校验不通过</span></span>
<span class="line">./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/nginx/1.22.0 --with-http_ssl_module</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 编译并安装</span></span>
<span class="line"><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Step5. 查看nginx安装结果</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># 注意：V大写。小写的v只能查看nginx版本号</span></span>
<span class="line">/usr/nginx/1.22.0/sbin/nginx <span class="token parameter variable">-V</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+_+`" alt=""></p><blockquote><p>Step6. 启动nginx，并访问</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">/usr/nginx/1.22.0/sbin/nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+k+`" alt=""></p><blockquote><p>Step7. nginx常用命令</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># nginx 配置文件修改后，可以使用-t命令校验配置文件是否正确(test is successful说明配置正确)</span></span>
<span class="line">/usr/nginx/1.22.0/sbin/nginx <span class="token parameter variable">-t</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动nginx</span></span>
<span class="line">/usr/nginx/1.22.0/sbin/nginx</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动nginx时指定配置文件</span></span>
<span class="line">/usr/nginx/1.22.0/sbin/nginx <span class="token parameter variable">-c</span> /usr/local/nginx/conf/nginx.conf</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 强制停止nginx</span></span>
<span class="line">/usr/nginx/1.22.0/sbin/nginx <span class="token parameter variable">-s</span> stop</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 处理完请求后停止nginx</span></span>
<span class="line">/usr/nginx/1.22.0/sbin/nginx <span class="token parameter variable">-s</span> quit</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 重新加载nginx配置文件</span></span>
<span class="line">/usr/nginx/1.22.0/sbin/nginx <span class="token parameter variable">-s</span> reload</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,79),f=[q];function y(S,E){return n(),a("div",null,f)}const A=s(x,[["render",y],["__file","记一次小程序接口的发布.html.vue"]]),j=JSON.parse('{"path":"/static/tang/%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%8F%91%E5%B8%83.html","title":"记一次小程序接口的发布","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"0 前言","slug":"_0-前言","link":"#_0-前言","children":[]},{"level":2,"title":"1 申请域名","slug":"_1-申请域名","link":"#_1-申请域名","children":[]},{"level":2,"title":"2 域名备案","slug":"_2-域名备案","link":"#_2-域名备案","children":[]},{"level":2,"title":"3 域名解析","slug":"_3-域名解析","link":"#_3-域名解析","children":[]},{"level":2,"title":"4 申请免费https证书","slug":"_4-申请免费https证书","link":"#_4-申请免费https证书","children":[]},{"level":2,"title":"5 配置https证书","slug":"_5-配置https证书","link":"#_5-配置https证书","children":[{"level":3,"title":"5.1 配置Tomcat类型服务器的证书","slug":"_5-1-配置tomcat类型服务器的证书","link":"#_5-1-配置tomcat类型服务器的证书","children":[]},{"level":3,"title":"5.2 配置nginx类型服务器的证书","slug":"_5-2-配置nginx类型服务器的证书","link":"#_5-2-配置nginx类型服务器的证书","children":[]}]},{"level":2,"title":"附：nginx的安装","slug":"附-nginx的安装","link":"#附-nginx的安装","children":[]}],"git":{"updatedTime":1720499771000,"contributors":[{"name":"文铁铁~","email":"1179131421@qq.com","commits":1}]},"filePathRelative":"static/tang/项目上线/记一次小程序接口的发布.md"}');export{A as comp,j as data};
